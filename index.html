
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Segwik Mobile – vCard → Download Journey Onboarding</title>
<style>
  :root{
    --bg:#f6f8fb; --ink:#243048; --muted:#667085; --line:#e6ebf2;
    --accent:#0F2D56; --blue:#2563eb; --blue-700:#1d4ed8; --blue-50:#eef2ff;
    --card:#fff; --radius:16px; --shadow:0 14px 38px rgba(0,0,0,.08);
    --phone-w:430px; --phone-h:800px; --footer-h:48px; --status-h:46px;
    --nav-safe: 140px; --green:#22c55e;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;display:grid;place-items:center;background:var(--bg);color:var(--ink);font-family:Segoe UI,system-ui,-apple-system,sans-serif}
  svg{stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}
  .phone{width:var(--phone-w);height:var(--phone-h);background:#fff;border-radius:36px;border:8px solid #111;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.12),0 8px 16px rgba(0,0,0,.08);position:relative}
  .notch{position:absolute;top:8px;left:50%;transform:translateX(-50%);width:180px;height:30px;background:#111;border-radius:20px 20px 28px 28px;z-index:10}
  .status{height:var(--status-h);display:flex;align-items:center;justify-content:center;border-bottom:1px solid var(--line);font-weight:800;color:var(--accent)}
  .screen{flex:1;position:relative;background:var(--bg);height:calc(100% - var(--status-h) - var(--footer-h));overflow:hidden}
  .tray{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;padding:8px;border-top:1px solid var(--line);background:#fff}
  .ibtn{padding:8px;border:1px solid var(--line);border-radius:12px;background:#f8fafc;display:grid;place-items:center}
.btn{appearance:none;border:1px solid var(--line);background:#fff;color:var(--accent);padding:10px 14px;border-radius:12px;font-weight:800;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px}
  .btn.blue{background:var(--blue);border-color:var(--blue);color:#fff}
.btn.blue:hover{background:var(--blue-700);border-color:var(--blue-700)}
/* New CTA variants */
.btn.orange{background:#f47a02;border-color:#f47a02;color:#fff}
.btn.orange:hover{filter:brightness(.96)}
.btn.gray{background:#e5e7eb;border-color:#e5e7eb;color:#374151}
.btn.green{background:var(--green);border-color:var(--green);color:#fff}
  .btn.ghost{background:#f8fafc}
  .btn.small{padding:8px 10px;border-radius:10px;font-size:12px}
  .btn.full{width:100%}
  .chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{border:1px solid var(--line);background:#fff;border-radius:999px;padding:8px 12px;font-weight:700;cursor:pointer}
  .chip.active{background:#eff6ff;border-color:#c7d2fe}

  /* ==== Brand Personality (new UI) ==== */
.group{display:flex;flex-direction:column;gap:8px}
.group h3{margin:0;font-size:14px;color:var(--accent);font-weight:900}
.group .help{font-size:12px;color:var(--muted)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.grid-1{display:grid;grid-template-columns:1fr;gap:8px}
/* Tone: fixed two-column grid */
.chips.twocol{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.chips.twocol .chip{width:100%; text-align:left}

/* Right-aligned small link under Tone chips */
.more{display:flex; justify-content:flex-end; margin-top:2px}
.more .btn.small{font-weight:700}


/* radio-style chip (single-select) */
.chip.radio{position:relative;padding-left:36px}
.chip.radio::before{
  content:""; position:absolute; left:12px; top:50%; transform:translateY(-50%);
  width:14px; height:14px; border:2px solid #cfd7e7; border-radius:50%; background:#fff;
}
.chip.radio.active::before{
  border-color:var(--blue); box-shadow:inset 0 0 0 4px #fff, 0 0 0 2px var(--blue);
}

/* scroll helper (only this step may be long) */
.bp-step .scroll{padding-bottom:calc(var(--nav-safe) + 8px); overflow:auto}


  .carousel{height:100%;display:flex;transition:transform .32s cubic-bezier(.22,.61,.36,1);will-change:transform}
  .slide{min-width:100%;height:100%;padding:14px;display:flex;flex-direction:column}
  .head{padding:6px 2px 8px}
  .h1{font-weight:900;color:var(--accent);font-size:18px}
  .p{font-size:13px;color:var(--muted);line-height:1.5}
  .scroll{flex:1;min-height:0;overflow:auto;display:flex;flex-direction:column;gap:12px;padding-bottom:var(--nav-safe)}
  .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px}
  .label{font-size:12px;color:var(--muted);font-weight:800;margin-bottom:6px}
  input[type="text"],input[type="email"],input[type="url"],textarea{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#f8fafc;font:inherit}
  /* On-brand selects */
select{
  width:100%;
  padding:10px 36px 10px 12px;
  border:1px solid var(--line);
  border-radius:12px;
  background:#f8fafc;
  font:inherit;
  appearance:none;
  -webkit-appearance:none;
  -moz-appearance:none;
  background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%23667085" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');
  background-repeat:no-repeat;
  background-position:right 10px center;
  background-size:18px;
}

/* Headline textarea should be ~2 lines tall (override global textarea min-height) */
textarea#headline{
  min-height:60px; /* ~2 lines */
}

  textarea{min-height:110px;resize:vertical}
  .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}

  .nav{position:absolute;left:0;right:0;bottom:var(--footer-h);display:flex;justify-content:space-between;gap:8px;padding:0 14px;z-index:5}
  .pager{position:absolute;left:0;right:0;bottom:calc(var(--footer-h) + 42px);display:flex;justify-content:center;gap:6px;pointer-events:auto;z-index:5}
  .dot{width:8px;height:8px;border-radius:50%;background:#c9d2e4;opacity:.9;cursor:pointer}
/* default active dot (except the Finish one) */
.dot.active:not(.finish){
  background: var(--accent);
}

/* Finish dot gets Segwik blue when active */
.dot.finish.active{
  background: var(--blue);
}
 

  /* vCard tiles in the inline/peek previews */
  .vcard{border:1px solid #e6ebf2;border-radius:18px;overflow:hidden}
  .v-banner{position:relative;height:180px;background:#dbe6ff url('https://images.unsplash.com/photo-1551817958-d33c6c9f24a1?q=80&w=1200&auto=format&fit=crop') center/cover}
  .v-banner::after{content:"";position:absolute;inset:0;background:linear-gradient(to bottom, rgba(0,0,0,.25), rgba(0,0,0,0) 50%)}
  .v-save{position:absolute;right:14px;bottom:-22px}
  .v-head{display:flex;gap:12px;align-items:flex-end;padding:28px 14px 12px}
  .v-photo{width:84px;height:84px;border-radius:50%;border:3px solid #fff;background:#e5edf8;background-size:cover;background-position:center;box-shadow:0 4px 12px rgba(0,0,0,.12)}
  .v-name{font-weight:900;font-size:20px;margin:6px 0 2px}
  .v-company{font-weight:700;color:#0b1220}
  .v-headline{color:#6a768f;margin-top:6px}
  .v-list{padding:8px 14px 16px;display:grid;gap:12px}
  .v-row{display:flex;gap:10px;align-items:flex-start}
  .vcard .v-row .ico{width:22px;height:22px;border-radius:50%;display:grid;place-items:center;background:#000;color:#fff;flex:0 0 22px}
  .vcard .v-row .ico svg,.vcard .v-row .ico svg *{stroke:#fff !important;fill:none !important;width:14px;height:14px;display:block}

  /* Phone-styled email preview */
  .phone-modal{ position:absolute; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:3200; }
  .phone-modal.show{ display:flex; }
  .phone-frame{ width:360px; max-width:92vw; background:#fff; border:1px solid #e5e7eb; border-radius:18px; box-shadow:0 20px 60px rgba(0,0,0,.18); overflow:hidden; }
  .phone-titlebar{ display:flex; gap:6px; align-items:center; padding:10px; background:#f9fafb; border-bottom:1px solid #eef1f6; }
  .dot-r{width:10px;height:10px;border-radius:50%;background:#ef4444}
  .dot-o{width:10px;height:10px;border-radius:50%;background:#f59e0b}
  .dot-g{width:10px;height:10px;border-radius:50%;background:#22c55e}
  .email-preview{ max-height:60vh; overflow:auto; }
  .mail-frame{border:0;border-radius:0;background:#fff}
  .mail-topbar{display:flex;justify-content:flex-start;align-items:center;padding:10px 12px;border-bottom:1px solid #eef1f6}
  .mail-topbar .subject{font-weight:800}
  .mail-body{padding:14px;line-height:1.55}
  .mail-body p{margin:0 0 10px 0}
  .sig{display:flex; gap:12px; align-items:flex-start; margin-top:14px; border-top:1px solid #eef1f6; padding-top:12px;}
  .sig img{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid #fff;box-shadow:0 2px 6px rgba(0,0,0,.06)}
  .sig .meta{font-size:13px;color:#334155}
  .sig .meta .name{font-weight:800;color:#111827}
  .sig .socials{display:flex;gap:8px;margin-top:6px}

  /* Upgrade modal */
  .modal-wrap{ position:absolute; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; z-index:3000; }
  .modal-wrap.show{ display:flex; }
  .modal{ background:#fff; border:1px solid var(--line); border-radius:16px; box-shadow:var(--shadow); width:92%; max-width:380px; padding:16px; }
  .modal h3{ margin:0 0 8px 0; font-size:16px; color:var(--accent); }
  .modal p{ margin:0 0 12px 0; color:var(--muted); }
  .modal .row{ display:flex; gap:8px; justify-content:flex-end; }

  .setup-image{ display:block; width:auto; height:360px; margin:0 auto 16px; border-radius:8px; object-fit:contain; }

/* Disable scrolling for the Journey Intro screen */
.slide[data-step="journeyIntro"] .scroll {
  overflow: hidden;
}
/* Disable scrolling for the Share screen */
.slide[data-step="share"] .scroll {
  overflow: hidden;
}
/* Company Details: trim bottom padding so content that fits doesn't trigger a scrollbar */
.slide[data-step="company"] .scroll {
  /* keep overflow:auto from the base .scroll so real overflow can still scroll */
  padding-bottom: 12px; /* was var(--nav-safe); prevents false overflow */
}


/* Bridge screen image (adjust size here) */
.bridge-image2{
  display:block;
  width:auto;
  height:300px;     /* ← adjust this height to change image size */
  margin:0 auto 16px;
  border-radius:8px;
  object-fit:contain;
}
/* Bridge screen image (adjust size here) */
.bridge-image{
  display:block;
  width:340px;
  height:auto;     /* ← adjust this height to change image size */
  margin:0 auto 16px;
  border-radius:8px;
  object-fit:contain;
}
/* Entry Confirm GIF (adjust size here) */
.entry-gif{
  display:block;
  width:auto;
  height:350px;   /* ← adjust this height to change the GIF size */
  object-fit:cover;
  border-radius:8px;
  margin:10px 0 8px;
}
/* Caption below GIF in modal */
#gifModal .gif-caption {
  margin-top: 12px;
  font-size: 14px;
  color: #4a5568;
  text-align: left;
  max-width: 90%;
  padding-left: 16px; 
  padding-top: 20px; 
}



/* ===== Fullscreen GIF modal overrides (centered, max screen usage) ===== */
#gifModal .phone-frame{
  width:100%;
  height:100%;
  max-width:none;
  border-radius:0;
  border:0;
  background:#fff;             /* match app background; no forced black */
}

#gifModal .phone-titlebar{
  background:#f9fafb;          /* match default titlebar */
  color:inherit;
  border-bottom:1px solid #eef1f6;
}

#gifModal .email-preview{
  height:calc(100% - 50px);    /* fill remaining height below titlebar */
  display:flex;
  align-items:center;
  justify-content:center;
  background:transparent;      /* no forced background color */
  overflow:hidden;              /* prevent scrollbars when centering */
}

#gifModal .entry-gif{
  max-width:92vw;               /* fit nicely within viewport */
  max-height:92vh;
  width:auto;
  height:auto;
  margin:0;                     /* let flex centering do its job */
  object-fit:contain;           /* show full GIF without cropping */
  border-radius:0;              /* edge-to-edge feel in fullscreen */
}

  .uploader{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .drop{ border:2px dashed #bfd3ff; background:#f5f8ff; color:#0F2D56; padding:14px; border-radius:14px; cursor:pointer; display:flex; gap:12px; align-items:center; transition:.18s ease; position:relative; min-height:74px; }
  .drop:hover{ background:#eef4ff; border-color:#9ab8ff; }
  .drop:active{ background:#e5eeff; }
  .drop .ico{ width:40px; height:40px; border-radius:10px; background:#fff; display:grid; place-items:center; border:1px solid #e6ebf2; }
  .drop .txt{ font-size:12px; line-height:1.35; }
  .drop .txt b{ display:block; font-size:13px; }
  .drop input[type="file"]{ position:absolute; inset:0; opacity:0; cursor:pointer; }
  .thumb{ position:absolute; right:10px; top:10px; width:48px; height:48px; border-radius:12px; border:1px solid #e6ebf2; background:#fff center/cover no-repeat; box-shadow:0 2px 6px rgba(0,0,0,.06); }

  .social-row{display:grid; grid-template-columns:160px 1fr 36px; gap:8px; align-items:center}
  .social-row select, .social-row input{padding:10px 12px; border:1px solid var(--line); background:#f8fafc; border-radius:10px; font:inherit}
  .social-row .remove{appearance:none; border:1px solid var(--line); background:#fff; border-radius:10px; width:36px; height:36px; display:grid; place-items:center; cursor:pointer}
  .social-add{margin-top:10px}
  .peek-trigger{display:inline-flex; align-self:flex-end}

  /* AI loader */
  .ai-overlay{position:absolute; inset:0; background:rgba(255,255,255,.8); display:none; align-items:center; justify-content:center; z-index:2500; font-weight:800; color:#0F2D56;}
  .ai-overlay.show{display:flex;}

/* Transition loader (between Summary → Share screen) */
.transition-loader{
  position:absolute;
  inset:0;
  background:rgba(255,255,255,.8);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2600;
}
.transition-loader.show{ display:flex; }
.transition-loader .spinner{
  width:56px; height:56px;
  border:4px solid #e5e7eb;
  border-top-color: var(--blue);
  border-radius:50%;
  animation: segwikSpin 1s linear infinite;
}
@keyframes segwikSpin { to { transform: rotate(360deg); } }


  /* Toggle */
  .switch{position:relative;width:56px;height:30px;background:#e5e7eb;border-radius:999px;cursor:pointer;transition:.18s ease;border:1px solid #d1d5db}
  .switch.on{background:var(--green);border-color:var(--green)}
  .knob{position:absolute;top:3px;left:3px;width:24px;height:24px;background:#fff;border-radius:50%;box-shadow:0 1px 3px rgba(0,0,0,.2);transition:.18s ease}
  .switch.on .knob{left:29px}

  /* ==== Peek sheet ==== */
  .peeksheet-wrap{ position:absolute; inset:0; background:rgba(15,45,86,.28); display:none; align-items:flex-end; z-index:2000; }
  .peeksheet-wrap.show{ display:flex; }
  .peeksheet{
    width:100%; height:calc(100% - 6px); max-height:100%;
    background:#fff; border-top:1px solid var(--line);
    border-radius:24px 24px 0 0; box-shadow:var(--shadow);
    padding:0; display:flex; flex-direction:column;
    transform:translateY(100%); animation:peekSlideUp .25s ease forwards;
  }
  @keyframes peekSlideUp{ to{ transform:translateY(0) } }
  .peeksheet-top{
    display:flex; align-items:center; justify-content:space-between; gap:8px;
    padding:14px 16px; border-bottom:1px solid var(--line); background:#fff;
    position:sticky; top:0; z-index:1;
  }
  .peeksheet-title{ font-weight:900; color:var(--accent); }
  .peeksheet-close{
    appearance:none; border:0; background:#f8fafc; border:1px solid var(--line);
    border-radius:10px; padding:6px 10px; cursor:pointer; font-size:18px; line-height:1;
  }
  .peeksheet-body{ flex:1; overflow:auto; -webkit-overflow-scrolling:touch; padding:14px 16px 22px; }

  /* Demo vCard inside the sheet (exact look) */
  .vcard-demo{ width:100%; border:1px solid #e6ebf2; border-radius:18px; overflow:hidden; background:#fff; box-shadow:var(--shadow); }
  .v-demo-banner{ height:180px; background:#eef2f7; background-size:cover; background-position:center; }
  .v-demo-headrow{ display:flex; align-items:flex-end; gap:12px; padding:18px 14px 8px; }
  .v-demo-photo{
    width:84px; height:84px; border-radius:50%; border:3px solid #fff;
    background:#e9edf3; display:grid; place-items:center; color:#9aa4b2;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
    background-size:cover; background-position:center;
  }
  .v-demo-photo svg{ width:30px; height:30px; }
  .v-demo-save{
    margin-left:auto; margin-bottom:6px; appearance:none; border:0;
    background:#2563eb; color:#fff; padding:10px 14px; border-radius:14px; font-weight:800;
  }
  .v-demo-id{ line-height:1.45; padding:0 14px 10px; }
  .v-demo-name{ font-weight:900; font-size:20px; color:#0b1220; }
  .v-demo-company{ color:#263043; font-weight:700; }
  .v-demo-title{ color:#111827; font-weight:800; }
  .v-demo-headline{ color:#6b7280; }

  .v-demo-list{ padding:10px 14px 18px; display:grid; gap:14px; }
  .v-demo-row{ display:flex; gap:10px; align-items:center; color:#1f2937; }
  .icon-pill{ width:28px; height:28px; border-radius:50%; background:#000; display:grid; place-items:center; }
  .icon-pill svg{ width:14px; height:14px; stroke:#fff; fill:none; stroke-width:2; }

  .peek-trigger{ display:inline-flex; align-self:flex-end; }
  /* Green badge used on the pause screen */
.badge {
  display:inline-flex; align-items:center; gap:8px;
  font-weight:900; color:#064e3b; background:#dcfce7;
  border:1px solid #bbf7d0; border-radius:999px; padding:6px 10px;
}
.badge .dot { width:8px; height:8px; border-radius:50%; background:var(--green); }

/* Stack chips one-per-row */
.chips.stacked{
  flex-direction:column;
  align-items:flex-start;
  justify-content:flex-start;
}
.chips.stacked .chip{
  width:100%;
  justify-content:flex-start;
  text-align:left;
}


#actionChips .chip { text-align: left; }


/* Form preview (inside peek sheet) */
.form-preview{ padding:6px 0 }
.form-preview .big-title{
  display:flex; align-items:center; gap:8px; font-weight:900; color:#0F2D56; margin-bottom:6px;
}
.form-preview .big-title .ok{ color:#22c55e; }
.form-preview .sub{ color:#667085; margin-bottom:12px; }
.form-preview .hint{ font-size:12px; color:#667085; margin:6px 0 10px; }
.form-preview .row{ display:grid; gap:8px; }
.form-preview .row .intl-phone{ display:grid; grid-template-columns:80px 1fr; gap:8px; }
.form-preview .submit{ width:100%; padding:12px 14px; border-radius:999px; border:0; font-weight:800; color:#fff; background:#d1d5db; cursor:not-allowed }
.form-preview a{ color:#2563eb; text-decoration:underline; cursor:pointer }


/* Email templates list */
.templates{display:grid; gap:8px}
.template-row{
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:8px 10px; border:1px solid var(--line); border-radius:10px; background:#fff;
}
.template-row .name{font-weight:400; color:var(--accent)}
.template-row .actions{display:flex; gap:6px}
.template-row .eye{appearance:none; border:1px solid var(--line); background:#f8fafc;
  border-radius:8px; padding:6px; display:grid; place-items:center; cursor:pointer}
.template-row.active{border-color:#9ab8ff; background:#f5f8ff}
.add-template{margin-top:12px; color:#2563eb; cursor:pointer; text-align:left; font-size:14px;}

/* CTA button (rendered before footer in email preview) */
.cta-btn{
  display:inline-block;
  padding:10px 16px;
  border-radius:999px;
  background:#3AAEE0;
  color:#fff;
  font-weight:500;
  text-decoration:none;
}
.cta-btn:hover{ background:#07AAF1 }


/* ===== Step 5 (Final Check) ===== */
/* Header row: label on left, button on right */
.label-row{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.label-row .label{ margin:0; }

/* Final Check header: allow label to wrap fully, prevent button from shrinking */
.label-row {
  display: flex;
  align-items: center;
  gap: 8px; /* adjust if needed */
}

.label-row .label {
  flex: 1 1 auto;   /* allow to expand and wrap */
  min-width: 0;     /* enables wrapping instead of overflow */
  white-space: normal; /* ensures multi-line wrapping */
}

#sendTestBtn {
  flex: 0 0 auto;       /* keep natural button width */
  white-space: nowrap;  /* prevents button from breaking into two lines */
}

/* Use the same phone look INSIDE the card */
.phone-frame.final {
  width:100%;
  max-width:100%;
  background:#fff;
  border:1px solid #e5e7eb;
  border-radius:14px;
  box-shadow:var(--shadow);
  overflow:hidden;
}
.phone-titlebar.final {
  display:flex; gap:6px; align-items:center;
  padding:10px; background:#f9fafb; border-bottom:1px solid #eef1f6;
}
.email-preview.final { max-height:420px; overflow:auto; }

/* push confirmation stays the same look */
.push {
  position:sticky; top:-14px; margin:-14px -14px 12px -14px;
  background:#ecfeff; color:#0f766e; border:1px solid #a5f3fc;
  border-radius:12px; padding:10px 12px; font-weight:800; display:none;
}
.push.show{ display:block; }

/* the button used beside the label */
#sendTestBtn{
  appearance:none; border:1px solid var(--line); background:#eef4ff;
  color:#0F2D56; border-radius:10px; padding:6px 10px; font-weight:700; cursor:pointer;
}

/* "+ Add more follow-ups" link (reuse same style as others) */
.add-template:hover{ text-decoration:underline; }

.label {
  font-weight: 400; /* normal weight, not bold */
}

.link-text{
  font-size:13px;
  color:var(--blue);
  cursor:pointer;
  text-decoration:underline;
  font-weight:600;
  user-select:none;
}
.link-text:hover{
  text-decoration:none;
}
/* Make textareas expand automatically when typing */
textarea {
  overflow: hidden;
  resize: none; /* optional: removes manual drag handle */
  min-height: 300px;
  transition: height 0.2s ease;
}

/* ===== Accordion (Choose Actions) ===== */
.accordion{display:grid; gap:8px}
.acc-item{border:1px solid var(--line); border-radius:12px; background:#fff}
.acc-header{
  width:100%; appearance:none; border:0; background:#fff;
  display:flex; align-items:center; justify-content:space-between; gap:10px;
  padding:12px 14px; font-weight:800; color:var(--accent); cursor:pointer;
  border-radius:12px;
}
.acc-header[aria-expanded="true"]{border-bottom:1px solid var(--line); border-radius:12px 12px 0 0}
.acc-title{display:flex; align-items:center; gap:8px}
.acc-arrow{
  width:18px; height:18px; display:grid; place-items:center;
  transition:transform .18s ease; flex:0 0 18px;
}
.acc-header[aria-expanded="true"] .acc-arrow{ transform:rotate(180deg) }
.acc-panel{
  display:none; padding:10px 14px 12px;
}
.acc-panel.show{ display:block }
.acc-locked .acc-header{ color:var(--accent); background:#fff; cursor:pointer }
.acc-locked .acc-panel{ background:#fff }
.placeholder-row{
  display:flex; align-items:center; justify-content:space-between; gap:8px;
  padding:8px 10px; border:1px dashed var(--line); border-radius:10px;
  color:#9aa4b2; background:#f8fafc;
}
.entry-heading {
  font-size: 13px;
  font-weight: 700;
  color: var(--muted);
  margin: 6px 0 4px 0;
}

.template-row .choose{
  appearance:none; border:1px solid var(--line); background:#2563eb; color:#fff;
  border-radius:8px; padding:6px 10px; font-weight:800; cursor:pointer;
}
.template-row.locked{ opacity:.6; filter:grayscale(0.3) }
.template-row.locked .name{ color:#94a3b8 }
.template-row.locked .actions .eye{ opacity:.5; cursor:not-allowed }

/* Bright, on-brand centered CTA */
.cta-center{ display:flex; justify-content:center; }
.btn.brand{
  background:var(--blue);
  border-color:var(--blue);
  color:#fff;
  font-weight:800;
  padding:12px 18px;
  border-radius:999px;
  box-shadow:0 8px 18px rgba(37,99,235,.25);
}
.btn.brand:hover{ background:var(--blue-700); border-color:var(--blue-700); }
.btn.brand:focus{ outline:2px solid #c7d2fe; outline-offset:2px; }

/* Adjustable Share Screen Image */
.share-image {
  height: 310px;           /* You can adjust this value */
  width: auto;             /* Automatically scales proportionally */
  display: block;
  margin: 0 auto;          /* Centers the image */
  object-fit: contain;     /* Keeps full image visible without distortion */
}
/* ===== EPV (Preview screen only) ===== */
#epvSection .epv-edit-row{ display:flex; align-items:center; gap:8px; }
#epvSection .epv-cell{ display:flex; align-items:center; gap:8px; flex:1 1 auto; }
#epvSection .epv-text{ display:inline-block; }

#epvSection .epv-pencil{
  appearance:none; border:0; background:transparent; color:#000;
  width:24px; height:24px;
  display:grid; place-items:center; cursor:pointer;
}
#epvSection .epv-pencil svg{
  fill:currentColor; stroke:none;
}


#epvSection .epv-pencil-upload{
  appearance:none; border:1px solid var(--line); background:#fff; color:#000;
  width:24px; height:24px; border-radius:50%;
  display:grid; place-items:center; cursor:pointer;
  position:absolute; right:8px; bottom:8px; transform:none;
  opacity:1; box-shadow:0 1px 2px rgba(0,0,0,.08);
}
#epvSection .epv-pencil-upload.epv-small{ width:22px; height:22px; }
#epvSection .epv-pencil-upload svg{ fill:currentColor; stroke:none; }
#epvSection .epv-pencil-upload:hover{ background:#f8fafc; }



#epvSection .v-demo-banner{ position:relative; }
#epvSection .v-demo-photo{ position:relative; }

#epvSection .epv-input{
  width:100%;
  padding:6px 8px;
  border-radius:8px;
  border:1px solid #dbe2ef;
  background:#fbfcff;
  font:inherit;
  font-size:13px;
  outline:none;
  box-shadow:none;
}
#epvSection .epv-input:focus{
  border-color:#c7d2fe;
  box-shadow:0 0 0 2px var(--blue-50);
}
/* Keep dual-name inputs compact and tidy */
#epvSection .epv-name-dual .epv-input{ min-width:0 }

/* While editing a row, hide the pencil */
#epvSection .epv-editing .epv-pencil{ display:none !important; }


/* Two inputs for first/last name */
#epvSection .epv-name-dual{
  display:grid; grid-template-columns:1fr 1fr; gap:8px; width:100%;
}

/* Social adder */
#epvSection .epv-social-adder{
  margin:8px 0 0;
  padding:10px;
  border:1px dashed var(--line);
  border-radius:10px;
  background:#f8fafc;
}
#epvSection .epv-social-row{
  display:grid;
  grid-template-columns:1fr;
  gap:8px;
  margin-top:6px;
}
#epvSection .epv-social-row select,
#epvSection .epv-social-row input{
  width:100%;
  padding:10px 12px;
  border:1px solid var(--line);
  background:#f8fafc;
  border-radius:10px;
  font:inherit;
}
#epvSection .epv-social-actions{
  display:flex;
  gap:16px;
  margin-top:8px;
  align-items:center;
}
#epvSection .epv-link{
  appearance:none;
  border:0;
  background:transparent;
  color:var(--blue);
  text-decoration:underline;
  font-weight:700;
  cursor:pointer;
  padding:0;
}

/* (Removed pill styles – socials now render as normal rows with black icon circles) */

/* Force headshot pencil to match banner size */
#epvSection #epvPhoto .epv-pencil-upload {
  width: 24px !important;
  height: 24px !important;
  right: 8px;
  bottom: 8px;
}

#epvSection #epvPhoto .epv-pencil-upload svg {
  width: 12px !important;
  height: 12px !important;
}

/* Journey infographic (Share screen) */
.journey-visual{
  background:#fff;
  border:1px solid var(--line);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:10px 12px;          /* compact to fit on one screen */
  margin-bottom:8px;
}

.jv{
  position:relative;
  display:grid;
  grid-template-columns:32px 1fr; /* icon column tighter */
  row-gap:6px;                    /* less space between rows */
  column-gap:10px;
  align-items:start;
  min-height:0;
}

/* Vertical rail that visually touches both icons */
.jv::before{
  content:"";
  position:absolute;
  left:16px;                     /* center of 32px icon column */
  top:18px;                      /* unchanged line height start */
  bottom:18px;                   /* unchanged line height end   */
  width:2px;
  background:#cfd7e7;
  z-index:0;                     /* ensure the rail is UNDER icons/masks */
}


/* Icons */
.jv-ico{
  width:32px; height:32px;
  display:grid; place-items:center;
  color:var(--accent);
  position:relative;  /* allow the mask to position inside the icon box */
  z-index:1;          /* above the rail */
}
/* White mask behind the icon so the rail never visually overlaps */
.jv-ico::after{
  content:"";
  position:absolute;
  inset:4px;           /* ~24px circle inside the 32px icon box */
  border-radius:50%;
  background:#fff;     /* same as card background */
  z-index:1;           /* sits above the rail, below the SVG */
}
/* keep the SVG above the mask */
.jv-ico svg{ position:relative; z-index:2; }

.jv-ico svg{ width:26px; height:26px; }

/* Content (compact) */
.jv-content{ min-width:0 }
.jv-title{ font-weight:900; color:var(--accent); font-size:13px; line-height:1.25; margin:0 0 2px 0; }
.jv-sub{ font-size:12px; color:#475569; line-height:1.35; }
.jv-content .p{ font-size:12px; color:var(--muted); line-height:1.4; }

/* Share grid: QR image left, content right */
.share-grid{
  display:grid;
  grid-template-columns:128px 1fr;  /* square image + content */
  gap:12px;
  align-items:center;
}

/* Square QR image */
.qr-thumb{
  width:auto;
  height:230px;
  border-radius:12px;
  border:1px solid var(--line);
  object-fit:cover;
  background:#f8fafc;
  display:block;         /* ensures margin works properly */
  margin:0 auto;         /* <-- Centers the QR image horizontally */
}


/* Tighten the share heading to save space */
.share-grid .h1{
  font-size:16px;
  text-align:center;   /* Centers the heading */
}


/* Safety: on very narrow widths, stack to keep everything visible */
@media (max-width: 390px){
  .share-grid{
  display:grid;
  grid-template-columns:1fr;  /* single column so the QR can sit centered */
  gap:12px;
  align-items:start;
  justify-items:center;       /* center the QR horizontally */
}

}


/* Share screen: two-column layout for image (left) and actions (right) */
.share-grid{display:grid;grid-template-columns:1fr 1fr;gap:14px;align-items:center}
@media (max-width:520px){
  .share-grid{grid-template-columns:1fr;gap:10px}
}

/* ===== Automation Step (new screen) ===== */
.card.disabled{
  opacity:.55;
  filter:grayscale(.15);
}

.card.disabled .row, 
.card.disabled .box-sub {
  pointer-events:none; /* Blocks only buttons and other actions */
}



.card .row.two{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
}

.card .box-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:6px;
}
.card .box-title{
  font-weight:900;
  color:var(--accent);
  font-size:16px;
}
.card .box-sub{
  color:var(--muted);
  font-size:13px;
}

.plus-ico{
  appearance:none;
  border:1px solid var(--line);
  background:#fff;
  width:28px; height:28px; border-radius:8px;
  display:grid; place-items:center; cursor:pointer;
  transition:transform .12s ease, box-shadow .12s ease;
}
.plus-ico:hover{ box-shadow:0 1px 6px rgba(0,0,0,.08) }
.plus-ico:active{ transform:scale(.96) }
.plus-ico svg{ width:16px; height:16px; }

/* Fullscreen modal for EPV and generic previews */
#epvFullModal .phone-frame,
#autoGenericModal .phone-frame{
  width:100%; height:100%;
  max-width:none;
  border-radius:0; border:0; background:#fff;
}
#epvFullModal .email-preview,
#autoGenericModal .email-preview{
  height:calc(100% - 50px);
  display:flex; align-items:center; justify-content:center;
  background:transparent; overflow:auto;
}
#epvFullModal .epv-modal-host,
#autoGenericModal .auto-generic-host{
  width:100%; max-width:460px; margin:0 auto; padding:14px;
}

</style>
</head>
<body>
  <div class="phone">
    <div class="notch"></div>
    <div class="status"></div>

    <div class="screen">
      <div id="carousel" class="carousel">

        <!-- Step 0: Welcome -->
        <section class="slide">
          <div class="head">
            <div class="h1">Let’s build your account profile.</div>
            <div class="p">This profile helps personalize your Segwik experience and keeps your information consistent across your journeys and automations</div>
          </div>

          <div class="scroll" style="overflow:hidden">

            <div class="card">
              <img src="https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1760702903557.png" alt="vCard setup preview" class="setup-image"/>
              <div class="p" style="margin-bottom:12px">
                Please snap a pic of your business card, front and back.

              </div>
              <div class="row">
                <button id="skip" class="btn">Skip</button>
                <button id="startCard" class="btn blue" style="margin-left:auto">Save & Continue</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Step: vCard — Profile -->
        <section class="slide">
          <div class="head">
            <div class="h1">Confirm User Profile Details</div>
            <div class="p">Double-check your information so you always present yourself clearly and professionally.</div>
          </div>
          <div class="scroll">
            <div class="card">
              <div class="split">
                <div>
                  <div class="label">First Name</div>
                  <input id="firstName" type="text" placeholder="">
                </div>
                <div>
                  <div class="label">Last Name</div>
                  <input id="lastName" type="text" placeholder="">
                </div>
              </div>
              <div style="margin-top:10px">
  <div class="label">Title / Role</div>
  <input id="title" type="text" placeholder="">
</div>


              <!-- NEW: Industry / Sub Industry -->
<div class="split" style="margin-top:10px">
  <div>
    <div class="label">Industry</div>
    <select id="industry">
      <option value="">--Select--</option>
      <option>Technology</option>
      <option>Real Estate</option>
      <option>Financial Services</option>
      <option>Healthcare</option>
      <option>Marketing & Advertising</option>
      <option>Education</option>
      <option>Legal</option>
      <option>Hospitality</option>
      <option>Construction</option>
      <option>Manufacturing</option>
      <option>Retail & E-commerce</option>
      <option>Nonprofit</option>
      <option>Other</option>
    </select>
  </div>
  <div>
    <div class="label">Sub Industry</div>
    <select id="subIndustry">
      <option value="">--Select--</option>
      <option>Consulting</option>
      <option>SaaS</option>
      <option>Insurance</option>
      <option>Mortgage</option>
      <option>Residential</option>
      <option>Commercial</option>
      <option>Medical Devices</option>
      <option>Therapy & Wellness</option>
      <option>Coaching</option>
      <option>Agency</option>
      <option>Training</option>
      <option>Services</option>
      <option>Other</option>
    </select>
  </div>
</div>



            </div>

          

            <!-- Bottom of step: peek trigger <button class="btn peek-trigger" data-peek>👁 Where will this appear?</button> -->
          </div>
        </section>

        <!-- Step: vCard — Contact -->
<section class="slide">
  <div class="head">
    <div class="h1">Confirm User Contact Details</div>
    <div class="p">These details help you present yourself professionally and make a great impression whenever you connect with new people.</div>
  </div>
  <div class="scroll">

    <div class="card">
      <div class="label">Phones</div>
      <div class="split">
        <div><input id="phoneBiz" type="text" placeholder="Business Phone"></div>
        <div><input id="phonePersonal" type="text" placeholder="Personal Phone"></div>
      </div>
      <div class="label" style="margin-top:10px">Emails</div>
      <div class="split">
        <div><input id="emailBiz" type="email" placeholder="Business Email"></div>
        <div><input id="emailPersonal" type="email" placeholder="Personal Email"></div>
      </div>
      <!-- Company Website moved to Confirm Company Details -->

    </div>

    <!-- Bottom of step: peek trigger <button class="btn peek-trigger" data-peek>👁 Where will this appear?</button>-->
    
  </div>
</section>

<!-- Step: Headshot upload (NEW, moved from Images & Social Links) -->
<section class="slide" data-step="headshot">
  <div class="head">
    <div class="h1">Do you have a Professional Headshot or Mark?</div>
    <div class="p">Your headshot helps personalize your profile and makes it easier for people to recognize you.</div>
  </div>
  <div class="scroll">
    <div class="card">
      <div class="uploader" style="grid-template-columns:1fr">
        <!-- CUT from Images & Social Links (keep IDs the same) -->
        <label class="drop" id="photoDrop">
          <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg></span>
          <span class="txt"><b>Upload Headshot</b>PNG or JPG, square works best</span>
          <input id="photo" type="file" accept="image/*">
          <span class="thumb" id="photoThumb" aria-hidden="true" style="display:none"></span>
        </label>
      </div>
    </div>
  </div>
</section>


<!-- Step: Company Details (NEW) -->
<section class="slide" data-step="company">
  <div class="head">
    <div class="h1">Confirm Company Details</div>
    <div class="p">Make sure your organization’s information is accurate so it appears correctly on your vCard and communications.</div>
  </div>
  <div class="scroll">
    <div class="card">
      <!-- Company Name (CUT from Confirm User Profile Details) -->
      <div style="margin-top:0">
        <div class="label">Company Name</div>
        <input id="company" type="text" placeholder="">
      </div>

      <!-- Company Email -->
      <div style="margin-top:10px">
        <div class="label">Company Email</div>
        <input id="companyEmail" type="email" placeholder="">
      </div>

      <!-- Company Phone -->
      <div style="margin-top:10px">
        <div class="label">Company Phone</div>
        <input id="companyPhone" type="text" placeholder="">
      </div>

      <!-- Company Website (CUT from Confirm User Contact Details) -->
      <div style="margin-top:10px">
        <div class="label">Company Website</div>
        <input id="website" type="url" placeholder="https://">
      </div>

      <!-- Company Address (single label; rest are placeholders) -->
      <!-- Company Address (single label; placeholders for structure) -->
<div style="margin-top:10px">
  <div class="label">Company Address</div>
  <input id="companyAddress1" type="text" placeholder="Address">
</div>
<div style="margin-top:10px">
  <input id="companyAddress2" type="text" placeholder="Address 2 (optional)">
</div>
<div class="split" style="grid-template-columns:2fr 1fr 1fr; gap:10px; margin-top:10px">
  <div><input id="companyCity" type="text" placeholder="City"></div>
  <div><input id="companyState" type="text" placeholder="State"></div>
  <div><input id="companyZip" type="text" placeholder="ZIP"></div>
</div>

    </div>
  </div>
</section>

<!-- Step: Logo upload -->
<section class="slide" data-step="logo">
  <div class="head">
    <div class="h1">Do you have a logo?</div>
    <div class="p">Your logo helps people instantly recognize your brand.</div>
  </div>
  <div class="scroll">
    <div class="card">
      <div class="uploader" style="grid-template-columns:1fr">
        <label class="drop" id="logoDrop">
          <span class="ico"><svg width="20" height="20" viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg></span>
          <span class="txt"><b>Upload Logo</b>PNG with transparent background works best</span>
          <input id="logo" type="file" accept="image/*">
          <span class="thumb" id="logoThumb" aria-hidden="true" style="display:none"></span>
        </label>
      </div>
    </div>
  </div>
</section>


    <!-- Step: Brand Personality (ONE SCREEN – MULTISELECT) -->
<section class="slide bp-step" data-step="bp-all">
  <div class="head">
    <div class="h1">How do you see yourself in the market?</div>
    <div class="p">Select all that describe your brand personality.</div>
  </div>
  <div class="scroll">
    <div class="card" id="brandPersonalityAll">
      <div class="group">
        <h3>1) Sincerity</h3>
        <div class="help">Select all that apply</div>
        <div class="chips twocol" id="bpSincerity"></div>
      </div>
      <div class="group" style="margin-top:12px">
        <h3>2) Excitement</h3>
        <div class="help">Select all that apply</div>
        <div class="chips twocol" id="bpExcitement"></div>
      </div>
      <div class="group" style="margin-top:12px">
        <h3>3) Competence</h3>
        <div class="help">Select all that apply</div>
        <div class="chips twocol" id="bpCompetence"></div>
      </div>
      <div class="group" style="margin-top:12px">
        <h3>4) Sophistication</h3>
        <div class="help">Select all that apply</div>
        <div class="chips twocol" id="bpSophistication"></div>
      </div>
      <div class="group" style="margin-top:12px">
        <h3>5) Ruggedness</h3>
        <div class="help">Select all that apply</div>
        <div class="chips twocol" id="bpRuggedness"></div>
      </div>
    </div>
  </div>
</section>



      

<!-- PHASE 1 → PHASE 2 BRIDGE (no back/next/pager) -->
<section class="slide" data-step="bridge">
  <div class="head">
    <div class="h1">Congratulations! Your profile and company details are all set.</div>
  </div>
  <div class="scroll">
    <div class="card">
      <img
        src="https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1760737883979.png"
        alt="Segwik setup complete"
        class="bridge-image"
      />
    </div>

    <!-- Keep only the right-aligned Continue button -->
    <div class="row" style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <button id="bridgeContinue" class="btn blue" style="margin-left:auto">Continue</button>
    </div>
  </div>
</section>

<!-- New screen: Journey Intro (moved content + new image) -->
<section class="slide" data-step="journeyIntro">
  <div class="head">
    <div class="h1">Lets start building your first customer journey</div>
    <div class="p">Set up the steps that will guide your prospects automatically from the moment they connect with you.</div>
  </div>
  <div class="scroll">
    <div class="card">
      <img
        src="https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1760980532973.png"
        alt="Customer journey intro"
        class="bridge-image2"
      />
    </div>

    <div class="row" style="margin-top:12px;display:flex;gap:8px;align-items:center">
      <button id="journeySkip" class="btn">Skip</button>
      <button id="journeyContinue" class="btn blue" style="margin-left:auto">Continue</button>
    </div>
  </div>
</section>


<!-- Step: Entry Confirm -->
<section class="slide" data-step="entryConfirm">
  <div class="head">
    <div class="h1">Define Your Journey Goal</div>
    <div class="p">Where does this journey lead? What’s the outcome you want to achieve at the end of this flow?</div>
  </div>

  <div class="scroll">
    <div class="card">
      <!-- New: Journey Goal accordion (mirrors existing fold/unfold behavior) -->
      <div id="goalAccordion" class="accordion" aria-label="Choose a journey goal to expand and select an item"></div>

      <!-- Locked, hyperlinked text (no modal wiring per spec) -->
      <div style="margin-top:8px">
        <a id="goalCustomLink" class="add-template locked" role="button">+ Custom Journey Goal 🔒</a>
      </div>
    </div>
  </div>
</section>









<!-- Step: Decide Entry -->
<section class="slide" data-step="entry">
  <div class="head">
    <div class="h1">Where will your customer start this journey?</div>
    <div class="p">Select from common starting points to see how contacts enter your journey.</div>
  </div>
  <div class="scroll">
    <div class="card">
      <!-- NEW: Accordion that mirrors the Actions screen behavior -->
      <div id="entryAccordion" class="accordion" aria-label="Choose an entry point to expand and select an item"></div>

      <!-- Keep custom link unchanged (still locked link) -->
      <div style="margin-top:8px">
        <a id="entryCustomLink" class="add-template" role="button">+ Create Custom Entry Point 🔒</a>
      </div>
    </div>
  </div>
</section>



<section class="slide" data-step="images" id="epvSection">
  <div class="head">
    <div class="h1">Preview & Update Your Digital Business Card</div>
    <div class="p">Review your details below. Click ✏️ to edit.</div>
  </div>

  <div class="scroll">
    <!-- Hidden file inputs (scoped IDs so we don't touch other screens) -->
    <input id="epvBannerFile" type="file" accept="image/*" hidden>
    <input id="epvPhotoFile"  type="file" accept="image/*" hidden>

    <div class="card">
      <!-- Inline vCard (keeps same visual style as modal, no "Where this info appears…") -->
      <div class="vcard-demo" id="epvCard">
        <div class="v-demo-banner" id="epvBanner">
          <!-- Center black pencil to upload banner -->
          <button class="epv-pencil-upload" data-epv-upload="banner" aria-label="Upload banner" title="Upload banner">
            <svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>


          </button>
        </div>

        <div class="v-demo-headrow">
          <div class="v-demo-photo" id="epvPhoto">
            <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>
            <button class="epv-pencil-upload epv-small" data-epv-upload="headshot" aria-label="Upload headshot" title="Upload headshot">
              <svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

            </button>
          </div>
          <button class="v-demo-save" type="button">Save Contact</button>
        </div>

        <div class="v-demo-id">
          <div class="epv-edit-row">
            <div class="v-demo-name" id="epvName">Your Name</div>
            <button class="epv-pencil" data-epv-edit="name" aria-label="Edit name" title="Edit name">
              <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

            </button>
          </div>

          <div class="epv-edit-row">
            <div class="v-demo-company" id="epvCompany">Your Company</div>
            <button class="epv-pencil" data-epv-edit="company" aria-label="Edit company" title="Edit company">
              <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

            </button>
          </div>

          <div class="epv-edit-row">
            <div class="v-demo-title" id="epvTitle">Your Title</div>
            <button class="epv-pencil" data-epv-edit="title" aria-label="Edit title" title="Edit title">
             <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

            </button>
          </div>

          <div class="epv-edit-row">
            <div class="v-demo-headline" id="epvHeadline">Your Headline</div>
            <button class="epv-pencil" data-epv-edit="headline" aria-label="Edit headline" title="Edit headline">
              <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

            </button>
          </div>
        </div>

        <!-- Contact rows below headline -->
        <div class="v-demo-list" id="epvList">
          <!-- Business Email -->
          <div class="v-demo-row">
            <span class="icon-pill" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 7l9 6 9-6"/></svg>
            </span>
            <div class="epv-cell">
              <span id="epvEmailBiz" class="epv-text" data-epv-field="emailBiz">Your Business Email</span>
              <button class="epv-pencil" data-epv-edit="emailBiz" aria-label="Edit business email" title="Edit business email">
               <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

              </button>
            </div>
          </div>

          <!-- Personal Email -->
          <div class="v-demo-row">
            <span class="icon-pill" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 7l9 6 9-6"/></svg>
            </span>
            <div class="epv-cell">
              <span id="epvEmailPersonal" class="epv-text" data-epv-field="emailPersonal">Your Personal Email</span>
              <button class="epv-pencil" data-epv-edit="emailPersonal" aria-label="Edit personal email" title="Edit personal email">
                <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

              </button>
            </div>
          </div>

          <!-- Business Phone -->
          <div class="v-demo-row">
            <span class="icon-pill" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24"><path d="M22 16.9v3a2 2 0 0 1-2.2 2A19.8 19.8 0 0 1 3.1 5.3 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.7c.1.8.3 1.6.6 2.4a2 2 0 0 1-.5 2L8.1 9.9a16 16 0 0 0 6 6l1.5-1.1a2 2 0 0 1 2.1-.5c.8.3 1.6.5 2.4.6A2 2 0 0 1 22 16.9z"/></svg>
            </span>
            <div class="epv-cell">
              <span id="epvPhoneBiz" class="epv-text" data-epv-field="phoneBiz">Your Business Phone</span>
              <button class="epv-pencil" data-epv-edit="phoneBiz" aria-label="Edit business phone" title="Edit business phone">
               <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

              </button>
            </div>
          </div>

          <!-- Personal Phone -->
          <div class="v-demo-row">
            <span class="icon-pill" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24"><path d="M22 16.9v3a2 2 0 0 1-2.2 2A19.8 19.8 0 0 1 3.1 5.3 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.7c.1.8.3 1.6.6 2.4a2 2 0 0 1-.5 2L8.1 9.9a16 16 0 0 0 6 6l1.5-1.1a2 2 0 0 1 2.1-.5c.8.3 1.6.5 2.4.6A2 2 0 0 1 22 16.9z"/></svg>
            </span>
            <div class="epv-cell">
              <span id="epvPhonePersonal" class="epv-text" data-epv-field="phonePersonal">Your Personal Phone</span>
              <button class="epv-pencil" data-epv-edit="phonePersonal" aria-label="Edit personal phone" title="Edit personal phone">
                <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

              </button>
            </div>
          </div>

          <!-- Website -->
          <div class="v-demo-row">
            <span class="icon-pill" aria-hidden="true">
              <svg width="14" height="14" viewBox="0 0 24 24">
                <path d="M8.5 14.5l-1 1a4.5 4.5 0 1 1-6.4-6.4l1-1a4.5 4.5 0 0 1 6.4 0"/>
                <path d="M15.5 9.5l1-1a4.5 4.5 0 1 1 6.4 6.4l-1 1a4.5 4.5 0 0 1-6.4 0"/>
                <path d="M9 12h6"/>
              </svg>
            </span>
            <div class="epv-cell">
              <span id="epvWebsite" class="epv-text" data-epv-field="website">Your Website</span>
              <button class="epv-pencil" data-epv-edit="website" aria-label="Edit website" title="Edit website">
                <svg width="14" height="14" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>

              </button>
            </div>
          </div>

                    <!-- Social items render here (as rows) -->
          <div id="epvSocialRows"></div>

          <!-- + Social Media trigger -->
          <div class="v-demo-row">
            <span style="width:28px;height:28px;"></span>
            <div class="epv-cell" style="display:flex;align-items:center;gap:10px">
              <button class="epv-link" id="epvSocialToggle" data-epv-action="social-open">+ Social Media</button>
            </div>
          </div>

          <!-- Social adder (stacked: dropdown row, url row, then link-style actions) -->
          <div id="epvSocialAdder" class="epv-social-adder" style="display:none">
            <div class="epv-social-row">
              <select id="epvSocialPlatform">
                <option value="linkedin_personal">LinkedIn (Personal)</option>
                <option value="linkedin_business">LinkedIn (Business)</option>
                <option value="facebook">Facebook</option>
                <option value="instagram">Instagram</option>
                <option value="pinterest">Pinterest</option>
                <option value="x">X (Twitter)</option>
                <option value="google">Google</option>
                <option value="youtube">YouTube</option>
                <option value="tiktok">TikTok</option>
              </select>
            </div>
            <div class="epv-social-row">
              <input id="epvSocialUrl" type="url" placeholder="https://…" />
            </div>
            <div class="epv-social-actions">
              <button class="epv-link" data-epv-action="social-add">+ Add</button>
              <button class="epv-link" data-epv-action="social-cancel">Cancel</button>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</section>

<!-- Step: Automation (AFTER EPV) -->
<section class="slide" data-step="automation">
  <div class="head">
    <div class="h1">Add Automation to Your Journey Step</div>
  </div>

  <div class="scroll">

    <!-- BOX 1: Visit Page -->
    <div class="card" id="autoVisitCard">
      <div class="box-head">
        <div class="box-title">Visit Page</div>
      </div>
      <div class="box-sub">Filter: Digital Card Page</div>

      <div class="row two" style="margin-top:10px">
        <button id="autoVisitPreview" class="btn full">Preview</button>
        <button id="autoVisitAdd" class="btn blue full">Add Touchpoint</button>
      </div>
    </div>

    <!-- Recommended label (disappears when + is clicked) -->
    <div id="autoRecLabel" style="font-weight:700; color:var(--accent); margin:12px 0 6px 0">Recommended&nbsp;Next&nbsp;Step</div>

    <!-- BOX 2: Download File (grayed) -->
    <div class="card disabled" id="autoRecCard" aria-disabled="true">
      <div class="box-head">
        <div class="box-title">Download File</div>
        <button id="autoRecEnable" class="plus-ico" title="Enable step" aria-label="Enable step">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14"/></svg>
        </button>
      </div>
      <div class="box-sub">Filter: Digital Card Document Type</div>

      <div class="row two" style="margin-top:10px">
        <button id="autoRecPreview" class="btn full">Preview</button>
        <button id="autoRecAdd" class="btn blue full">Add Touchpoint</button>
      </div>
    </div>

  </div>
</section>

 <!-- Step: Journey — Choose actions -->
        <section class="slide" data-step="actions">
          <div class="head">
            <div class="h1">What should happen after the customer journey starts?</div>
            <div class="p">Select an action you want Segwik to do after the journey starts.</div>
          </div>
          <div class="scroll">
            <div class="card">
  <div id="actionsAccordion" class="accordion" aria-label="Choose an action to expand and select a template"></div>
</div>
          </div>
        </section>


      <!-- Step: Content + AI generate (SPLIT INTO 4 SCREENS) -->
<!-- Screen 1: Overview -->
<section class="slide" data-step="content1">
  <div class="head">
    <div class="h1">Let’s Introduce Your Business</div>
    <div class="p">Your chosen email template includes a section introducing your business.</div>
  </div>
  <div class="scroll" style="position:relative">
    <div class="ai-overlay" id="aiOverlay">Generating your copy…</div>

    <div class="row" style="display:flex;gap:8px;flex-wrap:wrap;align-self:flex-start">
      <button data-regen class="btn">Regenerate with Segwik AI</button>
    </div>

    <div class="card">
      <div class="label">Is this a good overview of your business?</div>
      <textarea id="coOverview" placeholder="Describe what your company does…"></textarea>
    </div>
  </div>
</section>

<!-- Screen 2: Mission -->
<section class="slide" data-step="content2">
  <div class="head">
    <div class="h1">Share Your Mission</div>
    <div class="p">Your chosen email template includes a mission statement section.</div>
  </div>
  <div class="scroll" style="position:relative">
    <div class="ai-overlay" id="aiOverlay">Generating your copy…</div>

    <div class="row" style="display:flex;gap:8px;flex-wrap:wrap;align-self:flex-start">
      <button data-regen class="btn">Regenerate with Segwik AI</button>
    </div>

    <div class="card">
      <div class="label">Does this describe your mission accurately?</div>
      <textarea id="coMission" placeholder="State your mission…"></textarea>
    </div>
  </div>
</section>

<!-- Screen 3: Values -->
<section class="slide" data-step="content3">
  <div class="head">
    <div class="h1">Show What You Stand For</div>
    <div class="p">Your chosen email template includes a section that highlights your organization’s values.</div>
  </div>
  <div class="scroll" style="position:relative">
    <div class="ai-overlay" id="aiOverlay">Generating your copy…</div>

    <div class="row" style="display:flex;gap:8px;flex-wrap:wrap;align-self:flex-start">
      <button data-regen class="btn">Regenerate with Segwik AI</button>
    </div>

    <div class="card">
      <div class="label">Do you agree with this value statement?</div>
      <textarea id="coValues" placeholder="List a few core values…"></textarea>
    </div>
  </div>
</section>

<!-- Screen 4 (LAST of Phase 1): Differentiation -->
<section class="slide" data-step="content4">
  <div class="head">
    <div class="h1">Highlight What Sets You Apart</div>
    <div class="p">Your chosen email template includes a section about what makes you stand out.</div>
  </div>
  <div class="scroll" style="position:relative">
    <div class="ai-overlay" id="aiOverlay">Generating your copy…</div>

    <div class="row" style="display:flex;gap:8px;flex-wrap:wrap;align-self:flex-start">
      <button data-regen class="btn">Regenerate with Segwik AI</button>
    </div>

    <div class="card">
      <div class="label">Is this a good way to differentiate your business?</div>
      <textarea id="coDiff" placeholder="What makes you different…"></textarea>
    </div>
  </div>
</section>



        
<!-- Step: Final Check (full-screen email preview + add follow-ups) -->
<section class="slide" data-step="finalcheck">
  <div class="head">
    <div class="h1">Final Check Before Activation</div>
    <div class="p">Take a moment to preview everything and make sure it looks just right.</div>
  </div>
  <div class="scroll">
    <div class="card">
  <div class="label-row">
    <div class="label"><b>Trigger:</b> Downloaded My Personal Card<br><b>Timing:</b> Immediately</div>
    <button id="sendTestBtn">Test Journey Trigger</button>
  </div><br>

  <!-- Push confirmation (shown after clicking Send me a Test Email) -->
  <div id="testPush" class="push">Test email sent to your address.</div>

  <!-- Phone-styled preview (IDENTICAL look to the 👁 modal) -->
  <div class="phone-frame final">
    <div class="phone-titlebar final">
      <div class="dot-r"></div><div class="dot-o"></div><div class="dot-g"></div>
      <div id="fullPhoneTitle" style="margin-left:8px;font-weight:800;color:#0F2D56">It’s great to be connected!</div>
    </div>
    <div class="email-preview final">
      <div class="mail-frame" id="mailPreviewFull"></div>
    </div>
  </div>

<!-- Add Another Touchpoint (bright, centered) -->
<div class="cta-center" style="margin-top:14px">
  <button id="addAnotherTouchpointBtn" class="btn brand">+ Add Another Touchpoint</button>
</div>


  </div>
</section>

      
 



        <!-- Step: Summary with toggle -->
        <section class="slide" data-step="summary">
  <div class="head">
    <div class="h1">Your journey configuration is nearly complete</div>
    <div class="p">You’re ready to test this journey internally. <b><i>It’s not live yet</i></b> — try it first and make sure everything feels right.</div>
  </div>
  <div class="scroll">
    <!-- Push confirmation (appears above on actions below) -->
    <div id="summaryPush" class="push" role="status" aria-live="polite"></div>

    <!-- Box: Test with Myself -->
    <div class="card">
      <div style="font-weight:900; color:var(--accent); margin-bottom:6px;">Test with Myself</div>
      <div style="color:var(--muted); font-size:13px; line-height:1.5; margin-bottom:10px;">
        Send a test to your own email and experience the journey like a contact.
      </div>
<button id="goToMyVcardBtn" class="btn blue">Go to my vCard</button>
    </div>

    <!-- Box: Test with a Person -->
    <div class="card">
      <div style="font-weight:900; color:var(--accent); margin-bottom:6px;">Test with a Person</div>
      <div style="color:var(--muted); font-size:13px; line-height:1.5; margin-bottom:10px;">
        Send a test link to someone you trust. They’ll receive a link to your private vCard, fill out your vCard download form, and experience the journey as if they were a real contact — so you can see exactly how it flows.
      </div>
      <input id="testInviteEmail" type="email" placeholder="Enter email address" />
<button id="sendTestInviteBtn" class="btn blue" style="margin-top:8px;">Send Test Invite</button>
    </div>

    <!-- Big full-width Activate button -->
    <button id="activateJourneyBtn" class="btn full orange" style="justify-content:center; font-size:15px; font-weight:900; padding:14px 16px;">
      Activate Journey — Go Live
    </button>
  </div>
</section>


<!-- New Step: Share vCard -->
<section class="slide" data-step="share">
  <div class="head">
    <div class="h1">This Is the Beginning of Your Journey🎉</div>
    <div class="p">You’ve built it — now share it and let your journey do the work.</div>
  </div>
  <div class="scroll" style="align-items:stretch">

    <!-- Journey Infographic (inserted above the image card) -->
<div class="journey-visual" aria-label="Journey overview">
  <div class="jv">
    <!-- Row 1: Starting Point -->
    <div class="jv-ico" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path d="M12 22s7-4.35 7-11a7 7 0 1 0-14 0c0 6.65 7 11 7 11z"></path>
        <circle cx="12" cy="11" r="2.5"></circle>
      </svg>
    </div>
    <div class="jv-content">
      <div class="jv-title">Starting Point</div>
      <div class="jv-sub"><b>Entry Trigger:</b> Downloaded My Personal Digital Card</div>
      <div class="p" style="margin:4px 0 0">
        This is where your journey begins — when someone connects with you through this entry point, Segwik takes it from there.
      </div>
    </div>

    <!-- Row 2: Goal -->
    <div class="jv-ico" aria-hidden="true">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <circle cx="12" cy="12" r="9"></circle>
        <circle cx="12" cy="12" r="5"></circle>
        <circle cx="12" cy="12" r="1.5"></circle>
      </svg>
    </div>
    <div class="jv-content">
      <div class="jv-title">Goal</div>
      <div class="jv-sub"><b>End Action:</b> Schedule a Meeting</div>
      <div class="p" style="margin:4px 0 0">
        This is the destination — your journey leads here when someone completes this action.
      </div>
    </div>
  </div>
</div>
<!-- END: Journey Infographic -->

<div class="card share-grid">
  <!-- LEFT: square QR image -->
  <img
    class="qr-thumb"
    src="https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1761084416951.png"
    alt="QR preview"
    width="128" height="128"
    loading="lazy"
  />

  <!-- RIGHT: heading + buttons -->
  <div>
    <div class="h1" style="margin:0 0 10px 0">Start Sharing Your vCard</div>
    <div style="display:grid;grid-template-columns:1fr;gap:10px">
      <button class="btn full" id="copyLinkBtn" style="justify-content:center">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" style="margin-right:6px">
          <rect x="9" y="9" width="13" height="13" rx="2"></rect>
          <rect x="2" y="2" width="13" height="13" rx="2"></rect>
        </svg>
        Copy Link
      </button>
      <button class="btn full" id="shareLinkBtn" style="justify-content:center">
        <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true" style="margin-right:6px">
          <circle cx="18" cy="5" r="3"></circle>
          <circle cx="6" cy="12" r="3"></circle>
          <circle cx="18" cy="19" r="3"></circle>
          <path d="M8.7 10.9l6.6-3.8M8.7 13.1l6.6 3.8"></path>
        </svg>
        Share Link
      </button>
    </div>
  </div>
</div>




       
</section>


      </div>
      <!-- Transitional loader overlay (shown between screens) -->
      <div id="transitionLoader" class="transition-loader" aria-hidden="true">
        <div class="spinner" aria-label="Loading"></div>
      </div>

      <!-- Back/Next + pager (Phase 1) -->
<div id="nav1" class="nav" style="display:none">
  <button id="backBtn1" class="btn small ghost">Back</button>
  <button id="nextBtn1" class="btn small">Next</button>
</div>
<div id="pager1" class="pager" style="display:none"></div>

<!-- Back/Next + pager (Phase 2) -->
<div id="nav2" class="nav" style="display:none">
  <button id="backBtn2" class="btn small ghost">Back</button>
  <button id="nextBtn2" class="btn small">Next</button>
</div>
<div id="pager2" class="pager" style="display:none"></div>


      <!-- Upgrade modal -->
      <div id="upgradeModal" class="modal-wrap" role="dialog" aria-modal="true" aria-labelledby="upgTitle">
        <div class="modal">
          <h3 id="upgTitle">Unlock more automations</h3>
          <p>Upgrade to <strong>Segwik Grow</strong> to enable additional CTAs and more automations.</p>
          <div class="row">
            <button class="btn ghost" id="upgClose">Not now</button>
            <button class="btn blue" id="upgGo">See plans</button>
          </div>
        </div>
      </div>

            <!-- Activate Journey modal -->
<div id="activateModal" class="modal-wrap" role="dialog" aria-modal="true" aria-labelledby="activateTitle" aria-describedby="activateDesc" style="display:none">
  <div class="modal">
    <h3 id="activateTitle">Activate this journey now?</h3>
    <p id="activateDesc">This will start the automation for matching triggers.</p>
    <div class="row">
      <button class="btn ghost" id="activateCancel">Cancel</button>
      <button class="btn blue" id="activateConfirm">Confirm</button>
    </div>
  </div>
</div>

<!-- Plain Meeting Preview popup (no phone chrome; shows raw text) -->

      <div id="meetingPreviewModal" class="modal-wrap" role="dialog" aria-modal="true" aria-labelledby="meetingPrevTitle" style="display:none">
        <div class="modal">
          <h3 id="meetingPrevTitle">Preview: Meeting Details</h3>
          <pre id="meetingPrevBody" style="margin:0; white-space:pre-wrap">[meeting.agenda_items]</pre>
          <div class="row" style="margin-top:12px">
            <button class="btn ghost" id="meetingPrevClose">Close</button>
          </div>
        </div>
      </div>


      <!-- vCard peek sheet (steps 1–2) -->
      <div id="peekProfileSheet" class="peeksheet-wrap" aria-hidden="true" onclick="if(event.target.id==='peekProfileSheet'){togglePeek(false)}">
        <div class="peeksheet" role="dialog" aria-modal="true" aria-label="vCard field preview" onclick="event.stopPropagation()">
          <div class="peeksheet-top">
            <div class="peeksheet-title">Where this info appears on your vCard</div>
            <button id="peekProfileClose" class="peeksheet-close" aria-label="Close">×</button>
          </div>
          <div class="peeksheet-body">
            <div class="vcard-demo">
              <div class="v-demo-banner" id="peekDemoBanner"></div>
              <div class="v-demo-headrow">
                <div class="v-demo-photo" id="peekDemoPhoto">
                  <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>
                </div>
                <button class="v-demo-save">Save Contact</button>
              </div>
              <div class="v-demo-id">
                <div class="v-demo-name" id="peekName">Your Name</div>
                <div class="v-demo-company" id="peekCompany">Your Company</div>
                <div class="v-demo-title" id="peekTitle">Your Title</div>
                <div class="v-demo-headline" id="peekHeadline">Your Headline</div>
              </div>
              <div class="v-demo-list" id="peekList"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Phone-styled email preview -->
      <div id="phonePreview" class="phone-modal" aria-hidden="true" onclick="if(event.target.id==='phonePreview'){togglePhone(false)}">
        <div class="phone-frame" onclick="event.stopPropagation()">
          <div class="phone-titlebar">
            <div class="dot-r"></div><div class="dot-o"></div><div class="dot-g"></div>
            <div id="phoneTitle" style="margin-left:8px;font-weight:800;color:#0F2D56">It’s great to be connected!</div>
            <button id="phoneClose" class="btn small ghost" style="margin-left:auto">Close</button>
          </div>
          <div class="email-preview">
            <div class="mail-frame" id="mailPreview"></div>
          </div>
        </div>
      </div>
    </div>

<!-- Form Preview sheet -->
<div id="formPreviewSheet" class="peeksheet-wrap" aria-hidden="true" onclick="if(event.target.id==='formPreviewSheet'){toggleFormPreview(false)}">
  <div class="peeksheet" role="dialog" aria-modal="true" aria-label="Form preview" onclick="event.stopPropagation()">
    <div class="peeksheet-top">
      <div class="peeksheet-title">Download My Digital Card — Contact Form</div>
      <button id="formPreviewClose" class="peeksheet-close" aria-label="Close">×</button>
    </div>
    <div class="peeksheet-body">
      <div class="form-preview">
        <div class="big-title">
          <span class="ok">✔</span> Please Share Your Information
        </div>
        <div class="sub">To help stay in touch, please share your information back.</div>

        <div class="row">
          <div class="label">Your First Name*</div>
          <input type="text" placeholder="">
          <div class="label">Your Last Name*</div>
          <input type="text" placeholder="">
          <div class="label">Your Email*</div>
          <input type="email" placeholder="">
          <div class="label">Your Phone*</div>
          <div class="intl-phone">
            <select>
              <option>+1</option>
              <option>+44</option>
              <option>+61</option>
            </select>
            <input type="text" placeholder="Enter phone number">
          </div>
          <div class="label">Your Company</div>
          <input type="text" placeholder="">
          <div><a>Add Note...</a></div>
          <textarea placeholder="Enter note..."></textarea>
          <div class="hint">* Required fields</div>
          <button class="submit" disabled>Submit And Save Contact</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- GIF Modal (reuses phone modal look for consistency) -->
<div id="gifModal" class="phone-modal" aria-hidden="true" onclick="if(event.target.id==='gifModal'){toggleGif(false)}">
  <div class="phone-frame" onclick="event.stopPropagation()">
    <div class="phone-titlebar">
      <div class="dot-r"></div><div class="dot-o"></div><div class="dot-g"></div>
      <div style="margin-left:8px;font-weight:800;color:#0F2D56">vCard Download Example Preview</div>
      <button id="gifClose" class="btn small ghost" style="margin-left:auto">Close</button>
    </div>
    <div class="email-preview">
      <img
        id="gifImage"
        src="https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1760747575341.gif"
        alt="Journey Entry Flow GIF"
        class="entry-gif"
      />
      
    </div>
    <div id="gifCaption" class="gif-caption"><b>Here’s how your customer journey begins</b><br><br>When someone downloads your digital card and completes the vCard form, it kicks off your follow-up journey—no manual work needed.</div>
  </div>
</div>

<!-- EPV Fullscreen Modal -->
<div id="epvFullModal" class="phone-modal" aria-hidden="true" onclick="if(event.target.id==='epvFullModal'){toggleEpvFull(false)}">
  <div class="phone-frame" onclick="event.stopPropagation()">
    <div class="phone-titlebar">
      <div class="dot-r"></div><div class="dot-o"></div><div class="dot-g"></div>
      <div style="margin-left:8px;font-weight:800;color:#0F2D56">Digital Card Preview</div>
      <button id="epvFullClose" class="btn small ghost" style="margin-left:auto">Close</button>
    </div>
    <div class="email-preview">
      <div class="epv-modal-host" id="epvModalHost"></div>
    </div>
  </div>
</div>

<!-- Generic Fullscreen Modal (Download File preview placeholder) -->
<div id="autoGenericModal" class="phone-modal" aria-hidden="true" onclick="if(event.target.id==='autoGenericModal'){toggleAutoGeneric(false)}">
  <div class="phone-frame" onclick="event.stopPropagation()">
    <div class="phone-titlebar">
      <div class="dot-r"></div><div class="dot-o"></div><div class="dot-g"></div>
      <div style="margin-left:8px;font-weight:800;color:#0F2D56">Preview</div>
      <button id="autoGenericClose" class="btn small ghost" style="margin-left:auto">Close</button>
    </div>
    <div class="email-preview">
      <div class="auto-generic-host" id="autoGenericHost">
        <!-- Placeholder content; we’ll refine later -->
        <div class="card">
          <div class="h1">Digital Business Card Form</div>
          <div class="p">Show the Digital Business Card Form here</div>
        </div>
      </div>
    </div>
  </div>
</div>


    <!-- Bottom icon tray -->
    <div class="tray" id="footer-tray">
      <div class="ibtn" data-icon="home"></div>
      <div class="ibtn" data-icon="card"></div>
      <div class="ibtn" data-icon="flow"></div>
      <div class="ibtn" data-icon="mail"></div>
      <div class="ibtn" data-icon="user"></div>
    </div>
  </div>

<script>
  
/* ========= Carousel / Pager ========= */
const carousel = document.getElementById('carousel');
const slides = Array.from(carousel.querySelectorAll('.slide'));
let idx = 0;
let personaSeeded = false;            // seed persona once (first time entering any content screen)
const contentSeen = new Set();        // track which content screens have already shown the loader
let chosenPersona = 'professional';
let dummyIdx = 0;


function goTo(i){
    idx = Math.max(0, Math.min(slides.length-1, i));
  carousel.style.transform = `translateX(-${idx*100}%)`;
    // ALWAYS refresh Step 5 preview when landing there
    if (i === IDX.finalcheck) {
    syncPhoneTitle();
    renderMail();
  }
  // Ensure the "Preview & Update Your Digital Business Card" screen reflects the latest inputs
  if (i === IDX.images) {
    if (window && typeof window.__segwikRenderEPV === 'function') {
      window.__segwikRenderEPV();
    }
  }

  // One-time regen button attention (per screen)
  const currentStep = slides[idx]?.dataset?.step || null;
  maybeAutoAnimateRegenOnEnter(currentStep);


  renderDots(); updateNav();
  // Phase-specific nav/pagers
  const nav1   = document.getElementById('nav1');
  const pager1 = document.getElementById('pager1');
  const nav2   = document.getElementById('nav2');
  const pager2 = document.getElementById('pager2');

  // Hide all by default
  nav1.style.display = 'none';
  pager1.style.display = 'none';
  nav2.style.display = 'none';
  pager2.style.display = 'none';

const inP1 = idx <= IDX.personality;        // Phase 1 = welcome .. ends at Brand Personality
const inP2 = idx >= IDX.entryConfirm;             // Phase 2 = entry .. end


  if (inP1) {
    // Hide on very first welcome screen, show otherwise
    if (idx !== 0) {
      nav1.style.display = '';
      pager1.style.display = '';
    }
   } else if (inP2) {
    // Default: show Phase 2 nav + pager
    nav2.style.display = '';
    pager2.style.display = '';

    // EXCEPTION: hide both on the Share screen
    if (idx === IDX.share) {
      nav2.style.display = 'none';
      pager2.style.display = 'none';
    }
  }




  if (idx === IDX.preview) { renderStatus(); renderInlineVcardFromInputs(); }
 if (idx >= IDX.content1 && idx <= IDX.contentLast) {
  const step = slides[idx]?.dataset?.step || null;

  // Seed persona once (first time entering any of the content screens)
  if (!personaSeeded) {
    chosenPersona = inferChosenPersona();
    dummyIdx = 0;
    personaSeeded = true;
  }

  // Show the fake loader ONLY once for each individual content screen
  if (step && !contentSeen.has(step)) {
    contentSeen.add(step);
    setTimeout(()=> withLoader(fillFromDummy, step), 50);
  }
}



}

function stepIndex(name){
  return slides.findIndex(s => s.dataset && s.dataset.step === name);
}
const IDX = {
  preview:       stepIndex('preview'),
  personality:   stepIndex('bp-all'), // single-screen brand personality
  actions:       stepIndex('actions'),

  // NEW: first/last content screens
  content1:      stepIndex('content1'),
  contentLast:   stepIndex('content4'),

  // PHASE 1 → PHASE 2 bridge screens
  bridge:        stepIndex('bridge'),
  journeyIntro:  stepIndex('journeyIntro'),

  // NEW: inserted screens before logo
  headshot:      stepIndex('headshot'),
  company:       stepIndex('company'),

  logo:          stepIndex('logo'),
  handoff:       stepIndex('handoff'),
  entry:         stepIndex('entry'),
  images:        stepIndex('images'),
  automation:    stepIndex('automation'),   // ← INSERTED NEW SCREEN
  entryConfirm:  stepIndex('entryConfirm'),
  finalcheck:    stepIndex('finalcheck'),
  summary:       stepIndex('summary'),
  share:         stepIndex('share')   // ← NEW
};




/* ===== One-time "Regenerate with Segwik AI" animation control ===== */
const regenAnimState = {}; // step -> { autoShown: true, clickShown: true }

function stepNameForElement(el){
  const slide = el.closest('.slide');
  return slide?.dataset?.step || null;
}

function animateRegenButtonsOnce(step, reason /* 'auto' | 'click' */){
  if(!step) return;
  regenAnimState[step] = regenAnimState[step] || {};
  const key = reason === 'click' ? 'clickShown' : 'autoShown';
  if (regenAnimState[step][key]) return;

  const slide = slides.find(s => s.dataset && s.dataset.step === step);
  if(!slide) return;

  slide.querySelectorAll('[data-regen]').forEach(b=>{
    b.classList.add('regen-animate');
    b.addEventListener('animationend', ()=> b.classList.remove('regen-animate'), { once:true });
  });

  regenAnimState[step][key] = true;
}

function maybeAutoAnimateRegenOnEnter(step){
  // Show ONCE on first visit ONLY for the first content screen ("overview").
  // No auto animation for mission/values/diff screens.
  if(step === 'content1'){
    animateRegenButtonsOnce(step, 'auto');
  }
}



function renderDots(){
  const pager1 = document.getElementById('pager1');
  const pager2 = document.getElementById('pager2');
  if (!pager1 || !pager2) return;

  // Clear both
  pager1.innerHTML = '';
  pager2.innerHTML = '';

  const inP1 = idx <= IDX.personality;
  const inP2 = idx >= IDX.entryConfirm;


;

  if (inP1) {
    // Phase 1 dots: indices 0 .. IDX.personality
    for (let i = 0; i <= IDX.personality; i++){

      const d = document.createElement('div');
      d.classList.add('dot');
      // Mark Brand Personality as the "finish" of Phase 1
      if (slides[i].dataset && slides[i].dataset.step === 'bp-all') d.classList.add('finish');
      if (i === idx) d.classList.add('active');
      d.onclick = () => goTo(i);
      pager1.appendChild(d);
    }
    } else if (inP2) {
    // Phase 2 dots: indices IDX.entry .. slides.length-1
for (let i = IDX.entryConfirm; i < slides.length; i++) {
      const d = document.createElement('div');
      d.classList.add('dot');
      if (i === idx) d.classList.add('active');
      d.onclick = () => goTo(i);
      pager2.appendChild(d);
    }
  }

}

function updateNav(){
  const inP1 = idx <= IDX.personality;
  const inP2 = idx >= IDX.entryConfirm;


  // Pick the active phase's buttons
  const back = document.getElementById(inP1 ? 'backBtn1' : 'backBtn2');
  const next = document.getElementById(inP1 ? 'nextBtn1' : 'nextBtn2');

  if (!back || !next) return;

  // Back button ghosted at the start of each phase
const isPhaseStart = inP1 ? (idx === 0) : (idx === IDX.entryConfirm);
  back.classList.toggle('ghost', isPhaseStart);

  // Next text:
  // - Phase 1: "Finish" on last content screen, otherwise "Next"
  // - Phase 2: "Done" on very last slide, otherwise "Next"
    if (inP1) {
  next.textContent = (idx === IDX.personality) ? 'Finish' : 'Next';
} else {

    // Show "Done" on the Summary screen and on the very last slide
    next.textContent = (idx === IDX.summary || idx === slides.length - 1) ? 'Done' : 'Next';
  }

}

// Phase 1 buttons
document.getElementById('backBtn1')?.addEventListener('click', ()=> goTo(idx-1));
document.getElementById('nextBtn1')?.addEventListener('click', ()=>{
  if (idx === IDX.personality) {
    // Finish Phase 1: go to the bridge screen first
    goTo(IDX.bridge);
  } else {
    goTo(idx+1);
  }
});


// Phase 2 buttons
const transitionLoader = document.getElementById('transitionLoader');
function showLoaderThenGo(targetIdx){
  if(!transitionLoader){ goTo(targetIdx); return; }
  transitionLoader.classList.add('show');
  setTimeout(()=>{ transitionLoader.classList.remove('show'); goTo(targetIdx); }, 1200);
}
document.getElementById('backBtn2')?.addEventListener('click', ()=> goTo(idx-1));
document.getElementById('nextBtn2')?.addEventListener('click', ()=>{
  // When leaving the Summary screen, show a fake loader, then continue to Share screen
  if (idx === IDX.summary) {
    showLoaderThenGo(IDX.share);
  } else {
    goTo(idx+1);
  }
});


renderDots(); updateNav();

/* quick nav */
document.getElementById('startCard')?.addEventListener('click', ()=>{
  goTo(1);
document.getElementById('nav1').style.display = '';
document.getElementById('pager1').style.display = '';

});
document.getElementById('skip')?.addEventListener('click', ()=>{
  goTo(1);
  document.getElementById('nav1').style.display = '';
document.getElementById('pager1').style.display = '';

});
// Bridge screen actions → go to new Journey Intro screen
document.getElementById('bridgeContinue')?.addEventListener('click', ()=> goTo(IDX.journeyIntro));

// Journey Intro screen → proceed to Phase 2 entry
document.getElementById('journeySkip')?.addEventListener('click', ()=> goTo(IDX.entryConfirm));
document.getElementById('journeyContinue')?.addEventListener('click', ()=> goTo(IDX.entryConfirm));






/* ========= Global inputs/state ========= */
const S = {
  firstName: document.getElementById('firstName'),
  lastName : document.getElementById('lastName'),
  title    : document.getElementById('title'),
  company  : document.getElementById('company'),
  headline : document.getElementById('headline'),
  photo    : document.getElementById('photo'),
  banner   : document.getElementById('banner'),
  phoneBiz : document.getElementById('phoneBiz'),
  phonePersonal: document.getElementById('phonePersonal'),
  emailBiz : document.getElementById('emailBiz'),
  emailPersonal: document.getElementById('emailPersonal'),
  website  : document.getElementById('website'),
    ctaDest  : document.getElementById('ctaDest'),

  subject  : document.getElementById('subjectLine'),
  logo     : document.getElementById('logo'),
    industry : document.getElementById('industry'),
  subIndustry : document.getElementById('subIndustry'),

};
Object.values(S).forEach(el=>{ if(el) el.addEventListener('input', ()=>updatePreviews()); });

/* ========= Social builder ========= */
const socialOptions = [
  {key:'linkedin_personal', label:'LinkedIn (Personal)'},
  {key:'linkedin_business', label:'LinkedIn (Business)'},
  {key:'facebook', label:'Facebook'},
  {key:'instagram', label:'Instagram'},
  {key:'pinterest', label:'Pinterest'},
  {key:'x', label:'X (Twitter)'},
  {key:'google', label:'Google'},
  {key:'youtube', label:'YouTube'},
  {key:'tiktok', label:'TikTok'}
];
const socials = [];
const socialList = document.getElementById('socialList');
document.getElementById('addSocial')?.addEventListener('click', ()=>{
  socials.push({platform:'linkedin_business', url:''});
  renderSocialRows(); updatePreviews();
});
function renderSocialRows(){
  socialList.innerHTML = '';
  socials.forEach((row, idx)=>{
    const wrap = document.createElement('div');
    wrap.className = 'social-row';
    wrap.innerHTML = `
      <select aria-label="Social platform">
        ${socialOptions.map(opt=>`<option value="${opt.key}" ${opt.key===row.platform?'selected':''}>${opt.label}</option>`).join('')}
      </select>
      <input type="url" placeholder="https://..." value="${row.url || ''}">
      <button class="remove" title="Remove"><svg width="16" height="16" viewBox="0 0 24 24"><path d="M18 6L6 18M6 6l12 12"/></svg></button>
    `;
    const sel = wrap.querySelector('select');
    const input = wrap.querySelector('input');
    const btn = wrap.querySelector('button.remove');
    sel.addEventListener('change', (e)=>{ socials[idx].platform = e.target.value; updatePreviews(); });
    input.addEventListener('input', (e)=>{ socials[idx].url = e.target.value.trim(); updatePreviews(); });
    btn.addEventListener('click', ()=>{ socials.splice(idx,1); renderSocialRows(); updatePreviews(); });
    socialList.appendChild(wrap);
  });
}

/* ========= Image uploads → data URLs ========= */
let photoUrl='', bannerUrl='', logoUrl='';
const photoThumb = document.getElementById('photoThumb');
const bannerThumb = document.getElementById('bannerThumb');
const logoThumb  = document.getElementById('logoThumb');
function readToDataURL(file, cb){ const r=new FileReader(); r.onload = e => cb(e.target.result); r.readAsDataURL(file); }
S.photo?.addEventListener('change', ()=>{
  const f=S.photo.files?.[0]; if(!f) return;
  readToDataURL(f, url=>{ photoUrl = url; if(photoThumb){ photoThumb.style.display='block'; photoThumb.style.backgroundImage = `url('${url}')`; } updatePreviews(); });
});
S.banner?.addEventListener('change', ()=>{
  const f=S.banner.files?.[0]; if(!f) return;
  readToDataURL(f, url=>{ bannerUrl = url; if(bannerThumb){ bannerThumb.style.display='block'; bannerThumb.style.backgroundImage = `url('${url}')`; } updatePreviews(); });
});
S.logo?.addEventListener('change', ()=>{
  const f=S.logo.files?.[0]; if(!f) return;
  readToDataURL(f, url=>{ logoUrl = url; if(logoThumb){ logoThumb.style.display='block'; logoThumb.style.backgroundImage = `url('${url}')`; } if(phoneModalOpen) renderMail(); });
});

/* ========= Icons & helpers ========= */
function i16(name){
  switch (name) {


case 'phone': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <path d="M22 16.9v3a2 2 0 0 1-2.2 2A19.8 19.8 0 0 1 3.1 5.3 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.7c.1.8.3 1.6.6 2.4a2 2 0 0 1-.5 2L8.1 9.9a16 16 0 0 0 6 6l1.5-1.1a2 2 0 0 1 2.1-.5c.8.3 1.6.5 2.4.6A2 2 0 0 1 22 16.9z"/>
  </svg>`;

case 'mail': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <rect x="3" y="5" width="18" height="14" rx="2"/>
    <path d="M3 7l9 6 9-6"/>
  </svg>`;

case 'link': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <!-- left chain -->
    <path d="M8.5 14.5l-1 1a4.5 4.5 0 1 1-6.4-6.4l1-1a4.5 4.5 0 0 1 6.4 0"/>
    <!-- right chain -->
    <path d="M15.5 9.5l1-1a4.5 4.5 0 1 1 6.4 6.4l-1 1a4.5 4.5 0 0 1-6.4 0"/>
    <!-- connector -->
    <path d="M9 12h6"/>
  </svg>`;

case 'linkedin': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <path d="M4 9h4v11H4z"/>
    <circle cx="6" cy="5" r="2"/>
    <path d="M10 9h4v2a4 4 0 0 1 8 0v9h-4v-8a2 2 0 0 0-4 0v8h-4z"/>
  </svg>`;

case 'youtube': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <!-- body -->
    <path d="M22 12s0-3-.4-4.5A3 3 0 0 0 19.5 5C17.3 4.8 12 4.8 12 4.8s-5.3 0-7.5.2A3 3 0 0 0 2.4 7.5C2 9 2 12 2 12s0 3 .4 4.5A3 3 0 0 0 4.5 19c2.2.2 7.5.2 7.5.2s5.3 0 7.5-.2a3 3 0 0 0 2.1-2.5C22 15 22 12 22 12z"/>
    <!-- centered play triangle as stroke geometry -->
    <path d="M10 9l5 3-5 3z"/>
  </svg>`;

case 'x': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <path d="M4 4l16 16M20 4L4 20"/>
  </svg>`;

case 'instagram': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <rect x="3" y="3" width="18" height="18" rx="5"/>
    <circle cx="12" cy="12" r="4"/>
    <circle cx="17" cy="7" r="1"/>
  </svg>`;

case 'facebook': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <path d="M18 2h-3a4 4 0 0 0-4 4v3H8v4h3v9h4v-9h3l1-4h-4V6a1 1 0 0 1 1-1h3z"/>
  </svg>`;

case 'pinterest': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <circle cx="12" cy="12" r="10"/>
    <path d="M11 19c.5-3.8 1.8-6 1.8-8 0-1.6-1.2-2.7-2.8-2.7S7.2 9.2 7.2 10.8c0 1.1.6 2.1 1.8 2.5"/>
  </svg>`;

case 'google': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <!-- cleaner G: outer circle arc + crossbar -->
    <path d="M20 12a8 8 0 1 1-2.34-5.66"/>
    <path d="M12 12h8"/>
  </svg>`;

case 'tiktok': return `
  <svg width="16" height="16" viewBox="0 0 24 24">
    <path d="M14 6a5 5 0 0 0 5 5"/>
    <path d="M10 7v8.5a3.5 3.5 0 1 1-3-3.45"/>
  </svg>`;



}

}
function socialIconKey(platform){
  if(platform && platform.startsWith('linkedin')) return 'linkedin';
  return { facebook:'facebook', instagram:'instagram', pinterest:'pinterest', x:'x', google:'google', youtube:'youtube', tiktok:'tiktok' }[platform] || 'link';
}
function safe(v,fallback=''){ return (v||'').trim()||fallback; }
function oxfordList(arr){
  if(arr.length<=1) return arr.join('');
  if(arr.length===2) return `${arr[0]} and ${arr[1]}`;
  return `${arr.slice(0,-1).join(', ')}, and ${arr[arr.length-1]}`;
}

/* ========= Inline vCard (Step 3) & Status ========= */
function inlineRow(iconName, text){
  if(!text) return '';
  return `<div class="v-demo-row"><span class="icon-pill" aria-hidden="true">${i16(iconName)}</span><span>${text}</span></div>`;
}
function renderInlineVcardFromInputs(){
  const host = document.getElementById('vcardInline');
  if(!host) return;
  const name = `${safe(S.firstName.value,'Your')} ${safe(S.lastName.value,'Name')}`.trim();
  const company = safe(S.company.value,'Your Company');
  const title = safe(S.title.value,'Your Title');
  const headline = safe(S.headline.value,'Your Headline');
  const phoneA = safe(S.phoneBiz.value,'');
  const phoneB = safe(S.phonePersonal.value,'');
  const emailA = safe(S.emailBiz.value,'');
  const emailB = safe(S.emailPersonal.value,'');
  const website = safe(S.website.value,'');
  const socialRows = socials.filter(s=>s.url).map(s => inlineRow(socialIconKey(s.platform), s.url)).join('');
  host.innerHTML = `
    <div class="v-demo-banner" id="inlineBanner" style="${bannerUrl?`background-image:url('${bannerUrl}')`:''}"></div>
    <div class="v-demo-headrow">
      <div class="v-demo-photo" id="inlinePhoto" style="${photoUrl?`background-image:url('${photoUrl}');background-size:cover;background-position:center;background-repeat:no-repeat;`:''}">
        ${photoUrl?'':'<svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>'}
      </div>

      <button class="v-demo-save">Save Contact</button>
    </div>
    <div class="v-demo-id">
      <div class="v-demo-name" id="inlineName">${name||'Your Name'}</div>
      <div class="v-demo-company" id="inlineCompany">${company}</div>
      <div class="v-demo-title" id="inlineTitle">${title}</div>
      <div class="v-demo-headline" id="inlineHeadline">${headline}</div>
    </div>
    <div class="v-demo-list" id="inlineList">
      ${inlineRow('phone', phoneA)}
      ${inlineRow('phone', phoneB)}
      ${inlineRow('mail',  emailA)}
      ${inlineRow('mail',  emailB)}
      ${inlineRow('link',  website)}
      ${socialRows}
    </div>
  `;
}
function renderStatus(){
  const socialValid = socials.filter(s=>s.url);
  const missing = [];
  if(!(S.firstName.value && S.lastName.value)) missing.push('first & last name');
  if(!(S.phoneBiz.value || S.phonePersonal.value)) missing.push('at least one phone');
  if(!(S.emailBiz.value || S.emailPersonal.value)) missing.push('at least one email');
  if(!photoUrl) missing.push('headshot');
  if(!bannerUrl) missing.push('background image');
  if(!S.title.value) missing.push('title/role');
  if(!S.headline.value) missing.push('headline');
  if(!(S.website.value || socialValid.length>0)) missing.push('website or at least one social link');

  const complete = missing.length===0;

  const missingList = missing.length
    ? `<ul style="margin:6px 0; padding-left:20px;">${missing.map(item => `<li>${item}</li>`).join('')}</ul>`
    : '';

  const status = complete
    ? `✅ <span class="ok">Your digital card is complete</span>`
    : `⚠️ <span class="warn">Your public profile isn’t ready yet. Please add:</span><br>${missingList}Completing your profile helps your vcard look complete and professional.`;

  const statusEl = document.getElementById('cardStatus');
  if(statusEl) statusEl.innerHTML = status;

  const fillBtn = document.getElementById('btnFillInfo');
  if(fillBtn) fillBtn.style.display = complete ? 'none' : 'inline-flex';

  const sum = document.getElementById('sumCard');
  if(sum) sum.textContent = complete ? 'Digital card complete' : 'Digital card incomplete';
}


/* Keep everything live */
function updatePreviews(){
  if (idx === IDX.preview) { 
    renderStatus(); 
    renderInlineVcardFromInputs(); 
  }

  // Keep the peek sheet in sync, if it’s open
  if(sheet.classList.contains('show')) fillPeekFromInputs();

  // ALWAYS update the email previews (phone modal + Step 5 full preview)
  renderMail();

  // NEW: also refresh the "Preview & Update Your Digital Business Card" screen in real time
  if (window && typeof window.__segwikRenderEPV === 'function') {
    window.__segwikRenderEPV();
  }
}



/* ========= Peek sheet ========= */
const sheet = document.getElementById('peekProfileSheet');
const btnClose = document.getElementById('peekProfileClose');
function togglePeek(show){
  sheet.classList.toggle('show', !!show);
  sheet.setAttribute('aria-hidden', show ? 'false' : 'true');
  if(show) fillPeekFromInputs();
}
btnClose?.addEventListener('click', ()=>togglePeek(false));
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && sheet.classList.contains('show')) togglePeek(false); });
document.querySelectorAll('[data-peek]').forEach(b=> b.addEventListener('click', ()=>togglePeek(true)));

function peekRow(iconName, text){
  if(!text) return '';
  return `<div class="v-demo-row"><span class="icon-pill" aria-hidden="true">${i16(iconName)}</span><span>${text}</span></div>`;
}
function fillPeekFromInputs(){
  const name = `${safe(S.firstName.value,'Your')} ${safe(S.lastName.value,'Name')}`.trim();
  document.getElementById('peekName').textContent     = name || 'Your Name';
  document.getElementById('peekCompany').textContent  = safe(S.company.value,'Your Company');
  document.getElementById('peekTitle').textContent    = safe(S.title.value,'Your Title');
  document.getElementById('peekHeadline').textContent = safe(S.headline.value,'Your Headline');

  const bannerDiv = document.getElementById('peekDemoBanner');
const photoDiv  = document.getElementById('peekDemoPhoto');
bannerDiv.style.backgroundImage = bannerUrl ? `url('${bannerUrl}')` : '';
bannerDiv.style.backgroundSize = bannerUrl ? 'cover' : '';
bannerDiv.style.backgroundPosition = bannerUrl ? 'center' : '';
bannerDiv.style.backgroundRepeat = bannerUrl ? 'no-repeat' : '';

if (photoUrl){
  photoDiv.style.backgroundImage = `url('${photoUrl}')`;
  photoDiv.style.backgroundSize = 'cover';
  photoDiv.style.backgroundPosition = 'center';
  photoDiv.style.backgroundRepeat = 'no-repeat';
  photoDiv.innerHTML='';
} else {
  photoDiv.style.backgroundImage='';
  photoDiv.style.backgroundSize='';
  photoDiv.style.backgroundPosition='';
  photoDiv.style.backgroundRepeat='';
  if(!photoDiv.querySelector('svg')) photoDiv.innerHTML='<svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>';
}


  const phoneA = safe(S.phoneBiz.value,''), phoneB = safe(S.phonePersonal.value,'');
  const emailA = safe(S.emailBiz.value,''), emailB = safe(S.emailPersonal.value,'');
  const website = safe(S.website.value,'');
  const socialRows = socials.filter(s=>s.url).map(s => peekRow(socialIconKey(s.platform), s.url)).join('');
  document.getElementById('peekList').innerHTML = `
    ${peekRow('phone', phoneA)}
    ${peekRow('phone', phoneB)}
    ${peekRow('mail',  emailA)}
    ${peekRow('mail',  emailB)}
    ${peekRow('link',  website)}
    ${socialRows}
  `;
}
/* ========= Email Template Definitions (must exist before Accordion renders) ========= */
const templateDefs = [
  {key:'book',  name:'vCard Downloaded – Book a Call'},
  {key:'email', name:'vCard Downloaded – Send an Email'},
  {key:'call',  name:'vCard Downloaded – Call Me'}
];
let chosenTemplate = 'email';


/* ========= Actions & upgrade modal (Accordion) ========= */
const upg = document.getElementById('upgradeModal');
document.getElementById('upgClose')?.addEventListener('click', ()=>upg.classList.remove('show'));
document.getElementById('upgGo')?.addEventListener('click', ()=>{ upg.classList.remove('show'); alert('Navigate to pricing'); });

/* Single-open accordion behavior + template lists */
const actionsAccordionHost = document.getElementById('actionsAccordion');

/* Reuse existing templateDefs and chosenTemplate variables (defined above) */

function renderActionsAccordion(){
  if(!actionsAccordionHost) return;
actionsAccordionHost.innerHTML = `
  <div class="add-template" id="timingImmediate">Timing: Immediate 🔒</div>
`;
  const arrowSvg = `
    <span class="acc-arrow" aria-hidden="true">
      <svg width="18" height="18" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
    </span>
  `;

  // ===== 1) EMAIL (unlocked) =====
  const emailItem = document.createElement('div');
  emailItem.className = 'acc-item';
  emailItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Send the Contact an Email</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended email templates">
      <div class="templates">
        ${templateDefs.map(t => `
          <div class="template-row" data-tkey="${t.key}">
            <div class="name">${t.name}</div>
            <div class="actions">
              <button class="eye" title="Preview" aria-label="Preview">
                <svg width="18" height="18" viewBox="0 0 24 24">
                  <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
                  <circle cx="12" cy="12" r="3"/>
                </svg>
              </button>
              <button class="choose">Choose</button>
            </div>
          </div>
        `).join('')}

        <div class="add-template locked" id="addCustomEmailLink">+ Add Custom Email Template 🔒</div>


  `;
  actionsAccordionHost.appendChild(emailItem);

  // helper to make locked lists
  const lockedList = (names) => names.map(n => `
    <div class="template-row locked" data-locked="true">
      <div class="name">${n}</div>
      <div class="actions">
        <button class="eye" title="Upgrade required" aria-label="Upgrade required">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
            <circle cx="12" cy="12" r="3"/>
          </svg>
        </button>
        <button class="choose">Choose</button>
      </div>
    </div>
  `).join('');

  // ===== 2) TEXT (locked) =====
  const textItem = document.createElement('div');
  textItem.className = 'acc-item';
  textItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Send the Contact a Text Message 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended text templates">
      <div class="templates">
        ${lockedList(['Text Template 1','Text Template 2','Text Template 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(textItem);


// ===== 3) TASK (locked) =====
  const visitorItem = document.createElement('div');
  visitorItem.className = 'acc-item';
  visitorItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Capture Visitor Information 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended task templates">
      <div class="templates">
        ${lockedList(['Details 1','Details 2','Details 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(visitorItem);


  // ===== 3) TASK (locked) =====
  const taskItem = document.createElement('div');
  taskItem.className = 'acc-item';
  taskItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Assign a Task to Me 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended task templates">
      <div class="templates">
        ${lockedList(['Task Template 1','Task Template 2','Task Template 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(taskItem);
  

  // ===== 4) JOURNEY (locked) =====
  const journeyItem = document.createElement('div');
  journeyItem.className = 'acc-item';
  journeyItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Add to a Journey 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended journeys">
      <div class="templates">
        ${lockedList(['Journey 1','Journey 2','Journey 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(journeyItem);

  // ===== 5) UPDATE ATTRIBUTES (locked) =====
  const attrsItem = document.createElement('div');
  attrsItem.className = 'acc-item';
  attrsItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Update Attribute(s) 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended attribute updates">
      <div class="templates">
        ${lockedList(['Attribute 1','Attribute 2','Attribute 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(attrsItem);

  // ===== 6) GENERATE TRANSACTION (locked) =====
  const txnItem = document.createElement('div');
  txnItem.className = 'acc-item';
  txnItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Generate a Transaction 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended transactions">
      <div class="templates">
        ${lockedList(['Transaction 1','Transaction 2','Transaction 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(txnItem);

  // ===== 7) ASSIGN WORKFLOW (locked) =====
  const wfItem = document.createElement('div');
  wfItem.className = 'acc-item';
  wfItem.innerHTML = `
    <button class="acc-header" type="button" aria-expanded="false">
      <span class="acc-title">Assign a Workflow 🔒</span>${arrowSvg}
    </button>
    <div class="acc-panel" role="region" aria-label="Recommended workflows">
      <div class="templates">
        ${lockedList(['Workflow 1','Workflow 2','Workflow 3'])}
      </div>
    </div>
  `;
  actionsAccordionHost.appendChild(wfItem);

  // ===== Accordion behavior (single-open) =====
  const items = Array.from(actionsAccordionHost.querySelectorAll('.acc-item'));
  items.forEach(item=>{
    const header = item.querySelector('.acc-header');
    const panel  = item.querySelector('.acc-panel');
    header.addEventListener('click', ()=>{
      items.forEach(it=>{
        if(it!==item){
          it.querySelector('.acc-header')?.setAttribute('aria-expanded','false');
          it.querySelector('.acc-panel')?.classList.remove('show');
        }
      });
      const isOpen = header.getAttribute('aria-expanded') === 'true';
      header.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
      panel.classList.toggle('show', !isOpen);
    });
  });

  // ===== Email panel wiring (preview + choose) =====
  emailItem.querySelectorAll('.template-row[data-tkey]').forEach(row=>{
    const key = row.getAttribute('data-tkey');
    row.querySelector('.eye')?.addEventListener('click', (e)=>{
      e.stopPropagation();
      const t = templateDefs.find(t=>t.key===key);
      if(t){
        document.getElementById('phoneTitle').textContent = t.name;
        togglePhone(true, key);
      }
    });
    row.querySelector('.choose')?.addEventListener('click', (e)=>{
  e.stopPropagation();
  chosenTemplate = key;
  syncPhoneTitle();
  renderMail();
  goTo(idx + 1); // proceed to whatever the next screen is
});

  });

// ===== Locked custom email template (opens upgrade modal) =====
document.getElementById('addCustomEmailLink')?.addEventListener('click', (e)=>{
  e.preventDefault();
  const title = document.getElementById('upgTitle');
  if (title) title.textContent = 'Unlock custom email templates';
  const msg = document.querySelector('#upgradeModal .modal p');
  if (msg) msg.innerHTML = 'Adding a custom email template is available on paid plans.';
  upg.classList.add('show');
});

// ===== Timing: Immediate (opens upgrade modal with specific copy) =====
document.getElementById('timingImmediate')?.addEventListener('click', (e)=>{
  e.preventDefault();
  const title = document.getElementById('upgTitle');
  if (title) title.textContent = 'Unlock more automations';
  const msg = document.querySelector('#upgradeModal .modal p');
  if (msg) msg.innerHTML = 'Setting custom timing is available on paid plans.';
  upg.classList.add('show');
});


  // ===== All locked recommendations (eye/choose) → show upgrade modal =====
  actionsAccordionHost.querySelectorAll('.template-row.locked').forEach(row=>{
    row.querySelectorAll('.eye, .choose').forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const title = document.getElementById('upgTitle');
        if(title) title.textContent = 'Unlock more automations';
        const msg = document.querySelector('#upgradeModal .modal p');
        if(msg) msg.innerHTML = 'These recommended items are available on paid plans.';
        upg.classList.add('show');
      });
    });
  });
}



// Initial render (all collapsed, none preselected)
renderActionsAccordion();




/* ========= Brand Personality (ONE SCREEN — MULTISELECT) ========= */
/* Data: Five-Dimension Brand Personality Sets */
const PERSONA_OPTS = {
  sincerity: [
    "Honest","Cheerful","Wholesome","Genuine","Family-oriented","Friendly","Caring"
  ],
  excitement: [
    "Daring","Trendy","Imaginative","Spirited","Exciting","Up-to-date","Youthful"
  ],
  competence: [
    "Reliable","Efficient","Successful","Expert","Intelligent","Responsible","Trustworthy"
  ],
  sophistication: [
    "Upper-class","Charming","Glamorous","Stylish","Refined","Luxurious","Elegant"
  ],
  ruggedness: [
    "Outdoorsy","Rugged","Masculine","Tough","Durable","Strong","Adventurous"
  ]
};

/* State: all multiselect */
const Persona = {
  sincerity: new Set(),
  excitement: new Set(),
  competence: new Set(),
  sophistication: new Set(),
  ruggedness: new Set()
};

/* Generic chip renderer (multi) */
function renderPersonaChips(hostId, setRef, opts){
  const host = document.getElementById(hostId);
  if(!host) return;
  host.innerHTML = '';
  opts.forEach(label=>{
    const b = document.createElement('button');
    b.className = 'chip' + (setRef.has(label)?' active':'');
    b.textContent = label;
    b.addEventListener('click', ()=>{
      if(setRef.has(label)) setRef.delete(label); else setRef.add(label);
      renderPersona(); // re-render this screen only
    });
    host.appendChild(b);
  });
}

/* Render ALL five groups */
function renderPersona(){
  renderPersonaChips('bpSincerity',     Persona.sincerity,     PERSONA_OPTS.sincerity);
  renderPersonaChips('bpExcitement',    Persona.excitement,    PERSONA_OPTS.excitement);
  renderPersonaChips('bpCompetence',    Persona.competence,    PERSONA_OPTS.competence);
  renderPersonaChips('bpSophistication',Persona.sophistication,PERSONA_OPTS.sophistication);
  renderPersonaChips('bpRuggedness',    Persona.ruggedness,    PERSONA_OPTS.ruggedness);
}

/* Initial render for the single-screen personality step */
renderPersona();



/* Map selections to existing AI persona buckets (for generator) */
function inferChosenPersona(){
  // Count selections per dimension
  const counts = {
    sincerity:     Persona.sincerity.size,
    excitement:    Persona.excitement.size,
    competence:    Persona.competence.size,
    sophistication:Persona.sophistication.size,
    ruggedness:    Persona.ruggedness.size
  };

  // Quick helpers to see if certain key traits were chosen
  const hasAny = (setRef, arr) => arr.some(t => setRef.has(t));

  // Priority heuristics → map to existing DUMMY keys:
  //   'friendly','bold','innovative','reliable','professional','thoughtful'
  // 1) If Excitement or Ruggedness dominates → bold
  if (counts.excitement >= Math.max(counts.sincerity, counts.competence, counts.sophistication) ||
      counts.ruggedness  >= Math.max(counts.sincerity, counts.competence, counts.sophistication)) {
    // If Excitement leans more on "Imaginative/Up-to-date" → innovative
    if (hasAny(Persona.excitement, ["Imaginative","Up-to-date","Trendy","Exciting","Youthful"])) {
      return 'innovative';
    }
    return 'bold';
  }

  // 2) If Competence dominates → reliable (professional-ish)
  if (counts.competence > counts.sincerity && counts.competence >= counts.sophistication) {
    return 'reliable';
  }

  // 3) If Sincerity dominates → friendly / thoughtful
  if (counts.sincerity >= Math.max(counts.competence, counts.sophistication)) {
    if (hasAny(Persona.sincerity, ["Caring","Genuine","Honest","Friendly"])) return 'friendly';
    return 'thoughtful';
  }

  // 4) If Sophistication is strong → professional (reliable tone)
  if (counts.sophistication > 0) {
    return 'professional';
  }

  // Default fallback
  return 'professional';
}








/* ========= AI Generate (dummy) ========= */
const coOverview = document.getElementById('coOverview');
const coMission  = document.getElementById('coMission');
const coValues   = document.getElementById('coValues');
const coDiff     = document.getElementById('coDiff');
const DUMMY = {
  professional: [
    {
      overview: "Segwik is a human-centered Relationship Operating System built to bring structure, clarity, and efficiency to how small teams manage connections. We help businesses unify their contacts, communication, and workflows into one seamless environment that drives consistent growth and meaningful relationships.",
      mission: "Our mission is to simplify the way professionals operate by removing unnecessary friction in daily tasks. We empower teams to focus their time and energy on serving clients, closing deals, and nurturing long-term relationships instead of juggling disconnected tools.",
      values: "We value clarity in communication, reliability in our systems, and empathy for the customer experience. Through continuous improvement, we make sure our platform evolves with the needs of modern professionals.",
      diff: "Unlike traditional CRMs that require complex setup and maintenance, Segwik offers an all-in-one, AI-assisted workspace designed for immediate usability. We streamline every touchpoint so teams can operate efficiently from day one."
    },
    {
      overview: "At Segwik, we help ambitious professionals and small teams gain full visibility into their pipelines, projects, and communications. Our platform connects every interaction—from first contact to final follow-up—so nothing falls through the cracks.",
      mission: "We aim to help teams work smarter, not harder. By combining automation, analytics, and collaboration tools, Segwik creates a single hub that keeps your business organized and responsive to client needs.",
      values: "Professionalism, accountability, and precision guide everything we do. We believe that attention to detail builds trust and that consistency creates success.",
      diff: "Segwik eliminates the chaos of scattered spreadsheets and disconnected apps. With built-in automation and intuitive design, we help teams adapt quickly without requiring months of onboarding or tech setup."
    },
    {
      overview: "Segwik serves as the operating foundation for professionals who value organization and efficiency. We help teams centralize their data, streamline operations, and maintain high standards in client communication.",
      mission: "Our goal is to create reliable digital infrastructure that scales with your business. Whether you’re managing a few clients or hundreds, Segwik provides the tools to keep your work consistent, clear, and professional.",
      values: "Integrity, dependability, and excellence define our culture. We take pride in delivering stable technology that professionals can count on every day.",
      diff: "Segwik stands out by offering a structured, professional experience built for results-driven teams. Our tools don’t just manage data—they elevate the quality of every client relationship."
    }
  ],

  innovative: [
    {
      overview: "Segwik redefines how small teams build relationships by merging automation, intelligence, and design. We combine the science of workflow with the art of personalization to help businesses communicate better and scale faster.",
      mission: "Our mission is to push boundaries in customer engagement by blending cutting-edge AI with real human insight. We create technology that feels intuitive, adaptive, and empowering—never complicated.",
      values: "Innovation, creativity, and progress drive us forward. We believe in staying curious, challenging conventions, and building tools that inspire people to work smarter every day.",
      diff: "Segwik delivers forward-thinking automation that evolves with your business. Our platform adapts dynamically to your workflow, offering next-generation capabilities without the enterprise-level complexity."
    },
    {
      overview: "We help businesses innovate the way they connect with clients. Through AI-driven insights and automation, Segwik transforms ordinary interactions into opportunities for deeper engagement and lasting relationships.",
      mission: "We strive to make innovation accessible. By simplifying advanced technology, we allow small businesses to leverage the same intelligent systems that power large organizations.",
      values: "We value curiosity, experimentation, and the courage to try new ideas. Every update and feature we build reflects our belief in constant learning and innovation.",
      diff: "Unlike traditional CRMs, Segwik continuously learns from your activity. It predicts needs, automates responses, and helps your business stay ahead of the curve."
    },
    {
      overview: "Segwik was designed for forward-thinking teams that see technology as a partner, not a burden. We empower modern professionals to work more creatively and adaptively using smart, flexible automation.",
      mission: "To bridge the gap between technology and human connection. We want innovation to enhance, not replace, authentic relationships in business.",
      values: "Innovation, responsiveness, and authenticity guide everything we do. We believe the best solutions are both intelligent and human-centered.",
      diff: "Segwik sets itself apart with adaptable tools that grow with you. Our intelligent automation anticipates next steps and removes barriers so your ideas can move faster."
    }
  ],

  reliable: [
    {
      overview: "Segwik is the dependable backbone for relationship-driven businesses. We provide tools that help teams operate with consistency, accuracy, and confidence every day.",
      mission: "Our mission is to give professionals peace of mind by creating systems that simply work. We handle the technical complexity so you can focus on building meaningful human connections.",
      values: "Trust, dependability, and consistency are at the heart of Segwik. We believe in long-term reliability over short-term trends.",
      diff: "Segwik distinguishes itself by providing a stable, secure platform built to last. Our performance and uptime ensure your operations never skip a beat."
    },
    {
      overview: "At Segwik, reliability means everything. We support small teams and growing businesses with tools that are intuitive, predictable, and dependable—no surprises, just results.",
      mission: "We’re committed to helping our users deliver consistent experiences to their clients. When your tools work flawlessly, your relationships thrive.",
      values: "Honesty, responsibility, and service guide how we build and support our technology. We take pride in earning the trust of our users every day.",
      diff: "Segwik stands apart for its simplicity and dependability. Every feature is designed to work smoothly, ensuring you never lose data or momentum."
    },
    {
      overview: "Segwik helps businesses operate with confidence through technology they can trust. From communication to workflow tracking, every component is built for reliability and consistency.",
      mission: "Our purpose is to give users a system that just works—every time. We want you to spend less time troubleshooting and more time connecting with your clients.",
      values: "We believe in transparency, stability, and follow-through. Our users depend on us, and we take that responsibility seriously.",
      diff: "While other platforms chase trends, Segwik focuses on dependable performance. We’re the quiet engine that keeps your business running smoothly behind the scenes."
    }
  ],

  friendly: [
    {
      overview: "Segwik is your friendly home for keeping track of every conversation, task, and relationship. We make organization feel approachable and easy, so following up doesn’t feel like a chore.",
      mission: "We want to make growing your business feel personal and fun again. By combining smart tools with a warm user experience, we help you stay connected effortlessly.",
      values: "Kindness, transparency, and helpfulness guide everything we do. We believe technology should feel supportive, not stressful.",
      diff: "Segwik stands out for its human touch. Our tools are designed for real people—not just power users—so you can enjoy building relationships instead of managing systems."
    },
    {
      overview: "Segwik helps you stay in touch with clients in a genuine, friendly way. We simplify organization so you can focus on what truly matters—people.",
      mission: "Our mission is to help you communicate with ease and warmth. Whether it’s a reminder, follow-up, or introduction, we make every interaction feel natural.",
      values: "We value approachability, empathy, and positivity. Every feature we design supports real human connection.",
      diff: "Segwik keeps technology simple and human. We make complex tasks feel easy, so you can focus on nurturing relationships instead of wrestling with software."
    },
    {
      overview: "Segwik brings friendliness and simplicity to your daily workflow. We help businesses build long-lasting relationships by keeping communication open and approachable.",
      mission: "To make every digital interaction feel like a real conversation. We believe business can be warm, personable, and still professional.",
      values: "Joy, empathy, and clarity are our guiding principles. We design experiences that make people smile and feel understood.",
      diff: "Segwik delivers an experience that feels light and approachable while still being powerful. We make relationship management feel natural and enjoyable."
    }
  ],

  bold: [
    {
      overview: "Segwik is the command center for businesses that move fast and aim high. We cut through noise, speed up follow-up, and turn daily chaos into organized momentum.",
      mission: "We’re on a mission to eliminate busywork and give power back to the people doing the work. We help bold thinkers move faster and smarter with clarity and control.",
      values: "Momentum, ownership, and candor drive us forward. We believe in taking decisive action and celebrating results.",
      diff: "Segwik stands apart with lightning-fast automation and a clean, intuitive design that keeps teams focused on winning—not managing systems."
    },
    {
      overview: "For those who like to make things happen, Segwik provides the platform to do it. We help you lead with energy, clarity, and control over every client touchpoint.",
      mission: "Our goal is to supercharge follow-up and accelerate growth. We believe that when communication moves fast, business follows.",
      values: "Drive, courage, and focus are the foundation of our work. We encourage decisive action and direct communication.",
      diff: "Segwik is built for bold professionals who want speed without losing precision. We help you make an impression—quickly and effectively."
    },
    {
      overview: "Segwik helps high-energy teams stay sharp and unstoppable. We turn follow-up from a chore into a competitive advantage with tools built for speed and impact.",
      mission: "To give ambitious teams the tools to act fast and stay organized. We believe growth comes from confidence, clarity, and action.",
      values: "Determination, excellence, and forward motion define us. We move with purpose and help our users do the same.",
      diff: "Segwik delivers an edge to high-performance professionals. Our streamlined interface and automation tools keep you two steps ahead."
    }
  ],

  thoughtful: [
    {
      overview: "Segwik brings thoughtful structure to relationship management. We help professionals organize their communication and workflows with clarity and empathy so every interaction feels intentional.",
      mission: "Our mission is to elevate the quality and consistency of every customer experience. We believe great relationships come from genuine care backed by reliable systems.",
      values: "Empathy, rigor, and continuous learning are the foundation of our work. We aim to build technology that supports human thoughtfulness, not replaces it.",
      diff: "Segwik differentiates itself by offering calm, structured automation that complements your natural workflow. We help teams work smarter while maintaining a human touch."
    },
    {
      overview: "Segwik provides clarity and organization for teams who value precision and purpose. Every feature is built to make client communication smoother and more thoughtful.",
      mission: "We’re here to help professionals lead with empathy and consistency. Our tools make it easy to show clients that their experience truly matters.",
      values: "Stewardship, intentionality, and respect guide our development. We build tools that support meaningful, long-term relationships.",
      diff: "Segwik’s design philosophy is quiet and deliberate. We enhance your workflow without overwhelming it, offering support exactly where you need it."
    },
    {
      overview: "Segwik is built for professionals who believe relationships deserve care and attention. We help you bring structure and thoughtfulness to every step of the client journey.",
      mission: "To simplify operations without losing the personal touch. We create tools that balance automation with authenticity, making every interaction meaningful.",
      values: "Consideration, honesty, and precision define us. We design with empathy to make organization feel intuitive and calm.",
      diff: "Segwik’s difference lies in balance—we automate what helps and leave room for the human moments that matter most."
    }
  ]
};

function fillFromDummy(){
  const set = DUMMY[chosenPersona][dummyIdx % DUMMY[chosenPersona].length];
  coOverview.value=set.overview; coMission.value=set.mission; coValues.value=set.values; coDiff.value=set.diff; dummyIdx++;
}
function withLoader(fn, step=null){
  const slide = step ? slides[stepIndex(step)] : slides[idx];
  const ov = slide ? slide.querySelector('.ai-overlay') : null;
  if (ov) ov.classList.add('show');
  setTimeout(()=>{ fn(); if (ov) ov.classList.remove('show'); renderMail(); }, 800);
}

// Attach regenerate handler to all buttons with data-regen
document.querySelectorAll('[data-regen]').forEach(btn=>{
  const step = stepNameForElement(btn);
  btn.addEventListener('click', ()=>{
    // Show the attention animation only once when the user clicks
    animateRegenButtonsOnce(step, 'click');
    withLoader(fillFromDummy, step); // use the overlay inside THIS screen
  });
});




/* ========= Subject / Logo step nav ========= */

document.getElementById('handoffPreviewCard')?.addEventListener('click', ()=>{
  // Use the same behavior as your other preview button (mock or real)
  // If you want to match your existing mock preview:
  alert('Mock: Opening public vCard link');
  // Or call the same function you use for #btnPreviewCard if you have one.
});


/* ========= Entry (how automation begins) — New Accordion ========= */
/* IMPORTANT: Mirrors look/behavior of the Actions accordion */
/* Updated list per spec (no default selection): */
const entryDefs = [
  { key:'download',  label:'Visited a Page', locked:false, items:[
    { key:'heading', name:'What Page?', isHeading:true }, // not clickable
    { key:'vcard-form', name:'Download Digital Business Card Page', locked:false, type:'form', isVcard:true },
    { key:'any-page', name:'Any Page', locked:true, type:'page' },
    { key:'page-1', name:'Page 1', locked:true, type:'page' },
    { key:'page-2', name:'Page 2', locked:true, type:'page' },
    { key:'page-3', name:'Page 3', locked:true, type:'page' }
]},

  { key:'contact',   label:'Submitted a Contact Form 🔒', locked:true, items:[
    { key:'form-1', name:'Form 1', locked:true, type:'form' },
    { key:'form-2', name:'Form 2', locked:true, type:'form' },
    { key:'form-3', name:'Form 3', locked:true, type:'form' }
  ]},
  { key:'meeting',   label:'Booked a Meeting 🔒', locked:true, items:[
    { key:'meet-1', name:'Meeting Type 1', locked:true, type:'meeting' },
    { key:'meet-2', name:'Meeting Type 2', locked:true, type:'meeting' },
    { key:'meet-3', name:'Meeting Type 3', locked:true, type:'meeting' }
  ]},
  { key:'event',     label:'Registered for an Event 🔒', locked:true, items:[
    { key:'event-1', name:'Event A', locked:true, type:'event' },
    { key:'event-2', name:'Event B', locked:true, type:'event' },
    { key:'event-3', name:'Event C', locked:true, type:'event' }
  ]},
  { key:'order',     label:'Checked-out an Order 🔒', locked:true, items:[
    { key:'order-1', name:'Order Source 1', locked:true, type:'order' },
    { key:'order-2', name:'Order Source 2', locked:true, type:'order' },
    { key:'order-3', name:'Order Source 3', locked:true, type:'order' }
  ]},
  { key:'project',   label:'Started a Project 🔒', locked:true, items:[
    { key:'proj-1', name:'Project Type 1', locked:true, type:'project' },
    { key:'proj-2', name:'Project Type 2', locked:true, type:'project' },
    { key:'proj-3', name:'Project Type 3', locked:true, type:'project' }
  ]}
];


/* At screen open: nothing selected by default */
let chosenEntry = null;

/* GIF modal controls (shared GIF from Entry Confirm screen) */
const gifModal = document.getElementById('gifModal');
const gifImage = document.getElementById('gifImage');
function toggleGif(show){
  if(!gifModal) return;
  gifModal.classList.toggle('show', !!show);
  gifModal.setAttribute('aria-hidden', show ? 'false' : 'true');
}
document.getElementById('gifClose')?.addEventListener('click', ()=>toggleGif(false));

/* Render Entry accordion with single-open behavior, same as Actions */
function renderEntryAccordion(){
  const host = document.getElementById('entryAccordion');
  if(!host) return;

  host.innerHTML = '';

  const arrowSvg = `
    <span class="acc-arrow" aria-hidden="true">
      <svg width="18" height="18" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
    </span>
  `;

  // Build each accordion item
  entryDefs.forEach(def=>{
    const item = document.createElement('div');
    item.className = 'acc-item' + (def.locked ? ' acc-locked' : '');
    item.setAttribute('data-ep', def.key);

    item.innerHTML = `
      <button class="acc-header" type="button" aria-expanded="false">
        <span class="acc-title">${def.label}</span>${arrowSvg}
      </button>
      <div class="acc-panel" role="region" aria-label="${def.label}">
                <div class="templates">
          ${
            def.items.map(it => it.isHeading
              ? `
  <div class="entry-heading">${it.name}</div>
`

              : `
                <div class="template-row ${it.locked ? 'locked' : ''}" data-ep-item="${it.key}">
                  <div class="name">${it.name}</div>
                  <div class="actions">
                    <button class="eye" title="${it.locked ? 'Upgrade required' : 'Preview'}" aria-label="${it.locked ? 'Upgrade required' : 'Preview'}">
                      <svg width="18" height="18" viewBox="0 0 24 24">
                        <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                    </button>
                    <button class="choose">Choose</button>
                  </div>
                </div>
              `
            ).join('')
          }
        </div>

      </div>
    `;

    host.appendChild(item);
  });

  // Single-open behavior (match Actions)
  const items = Array.from(host.querySelectorAll('.acc-item'));
  items.forEach(it=>{
    const header = it.querySelector('.acc-header');
    const panel  = it.querySelector('.acc-panel');

    // NOTE: Even locked headers expand (no upgrade modal on headers)
    header.addEventListener('click', ()=>{
      items.forEach(other=>{
        if(other!==it){
          other.querySelector('.acc-header')?.setAttribute('aria-expanded','false');
          other.querySelector('.acc-panel')?.classList.remove('show');
        }
      });
      const isOpen = header.getAttribute('aria-expanded') === 'true';
      header.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
      panel.classList.toggle('show', !isOpen);
    });

    // Wire up eye/choose actions inside the panel
    panel.querySelectorAll('.template-row:not(.is-heading)').forEach(row=>{
      const isLocked = row.classList.contains('locked');
      const rowKey   = row.getAttribute('data-ep-item');
      const epKey    = it.getAttribute('data-ep');

      // Eye behavior
      row.querySelector('.eye')?.addEventListener('click', (e)=>{
        e.stopPropagation();
        if(isLocked){
          // Items under locked entries trigger upgrade modal
          const title = document.getElementById('upgTitle');
          if(title) title.textContent = 'Unlock this journey entry point';
          const msg = document.querySelector('#upgradeModal .modal p');
          if (msg) msg.innerHTML = 'Selecting or previewing this action is available on paid plans.';
          upg.classList.add('show');
          return;
        }

        // For the unlocked "vCard Download Form", open the GIF
        toggleGif(true);
      });

      // Choose behavior
      row.querySelector('.choose')?.addEventListener('click', (e)=>{
        e.stopPropagation();
        if(isLocked){
          const title = document.getElementById('upgTitle');
          if(title) title.textContent = 'Unlock this journey entry point';
          const msg = document.querySelector('#upgradeModal .modal p');
          if (msg) msg.innerHTML = 'Choosing this action is available on paid plans.';
          upg.classList.add('show');
          return;
        }

        // Set selection (unlocked)
        chosenEntry = epKey;           // 'download'
        // ALWAYS go to the next screen
        goTo(idx + 1);
      });
    });
  });
}

// Initial render: all collapsed; nothing preselected
renderEntryAccordion();

/* ===== Goal (Define Journey Goal) Accordion ===== */
const goalDefs = [
  {
    key: 'schedule',
    label: 'Schedule a Meeting',
    locked: false,
    items: [
      { key:'meet-1', name:'Meeting Type 1', locked:false },
      { key:'meet-2', name:'Meeting Type 2', locked:false },
      { key:'meet-3', name:'Meeting Type 3', locked:false }
    ]
  },
  {
    key: 'event',
    label: 'Register for an Event 🔒',
    locked: true,
    items: [
      { key:'event-1', name:'Event Type 1', locked:true },
      { key:'event-2', name:'Event Type 2', locked:true },
      { key:'event-3', name:'Event Type 3', locked:true }
    ]
  },
  {
    key: 'task',
    label: 'Assign a Task 🔒',
    locked: true,
    items: [
      { key:'task-1', name:'Task 1', locked:true },
      { key:'task-2', name:'Task 2', locked:true },
      { key:'task-3', name:'Task 3', locked:true }
    ]
  }
];

let chosenGoal = null;

// Plain meeting preview modal controls
const meetingPrevModal = document.getElementById('meetingPreviewModal');
const meetingPrevBody  = document.getElementById('meetingPrevBody');
const meetingPrevClose = document.getElementById('meetingPrevClose');
function toggleMeetingPreview(show, text='[meeting.agenda_items]'){
  if(meetingPrevBody) meetingPrevBody.textContent = text;
  if(meetingPrevModal){
    meetingPrevModal.style.display = show ? 'flex' : 'none';
  }
}
meetingPrevClose?.addEventListener('click', ()=> toggleMeetingPreview(false));
meetingPrevModal?.addEventListener('click', (e)=>{ if(e.target.id==='meetingPreviewModal') toggleMeetingPreview(false); });

function renderGoalAccordion(){
  const host = document.getElementById('goalAccordion');
  if(!host) return;
  host.innerHTML = '';

  const arrowSvg = `
    <span class="acc-arrow" aria-hidden="true">
      <svg width="18" height="18" viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
    </span>
  `;

  goalDefs.forEach(def=>{
    const item = document.createElement('div');
    item.className = 'acc-item' + (def.locked ? ' acc-locked' : '');
    item.setAttribute('data-goal', def.key);

    item.innerHTML = `
      <button class="acc-header" type="button" aria-expanded="false">
        <span class="acc-title">${def.label}</span>${arrowSvg}
      </button>
      <div class="acc-panel" role="region" aria-label="${def.label}">
        <div class="templates">
          ${def.items.map(it => `
            <div class="template-row ${it.locked ? 'locked' : ''}" data-goal-item="${it.key}">
              <div class="name">${it.name}</div>
              <div class="actions">
                <button class="eye" title="${it.locked ? 'Upgrade required' : 'Preview'}" aria-label="${it.locked ? 'Upgrade required' : 'Preview'}">
                  <svg width="18" height="18" viewBox="0 0 24 24">
                    <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12z"/>
                    <circle cx="12" cy="12" r="3"/>
                  </svg>
                </button>
                <button class="choose">Choose</button>
              </div>
            </div>
          `).join('')}
        </div>
      </div>
    `;

    host.appendChild(item);
  });

  // Single-open behavior (mirrors other accordions)
  const items = Array.from(host.querySelectorAll('.acc-item'));
  items.forEach(it=>{
    const header = it.querySelector('.acc-header');
    const panel  = it.querySelector('.acc-panel');
    header.addEventListener('click', ()=>{
      items.forEach(other=>{
        if(other!==it){
          other.querySelector('.acc-header')?.setAttribute('aria-expanded','false');
          other.querySelector('.acc-panel')?.classList.remove('show');
        }
      });
      const isOpen = header.getAttribute('aria-expanded') === 'true';
      header.setAttribute('aria-expanded', isOpen ? 'false' : 'true');
      panel.classList.toggle('show', !isOpen);
    });

    // Wire up eye / choose inside each panel row
panel.querySelectorAll('.template-row:not(.is-heading)').forEach(row=>{
      const isLocked = row.classList.contains('locked');

      // Eye: unlocked = show plain popup with raw text; locked = upgrade modal
      row.querySelector('.eye')?.addEventListener('click', (e)=>{
        e.stopPropagation();
        if(isLocked){
          const title = document.getElementById('upgTitle');
          if(title) title.textContent = 'Unlock this journey goal';
          const msg = document.querySelector('#upgradeModal .modal p');
          if (msg) msg.innerHTML = 'Previewing this goal is available on paid plans.';
          upg.classList.add('show');
          return;
        }
        // Unlocked (Schedule a Meeting) — show raw text only
        toggleMeetingPreview(true, '[meeting.agenda_items]');
      });

      // Choose: unlocked = set goal; locked = upgrade modal
      row.querySelector('.choose')?.addEventListener('click', (e)=>{
        e.stopPropagation();
        if(isLocked){
          const title = document.getElementById('upgTitle');
          if(title) title.textContent = 'Unlock this journey goal';
          const msg = document.querySelector('#upgradeModal .modal p');
          if (msg) msg.innerHTML = 'Choosing this goal is available on paid plans.';
          upg.classList.add('show');
          return;
        }
                        // Save chosen goal and move to the immediate next screen
        chosenGoal = row.getAttribute('data-goal-item'); // e.g., 'meet-1'
        goTo(idx + 1);


      });
    });
  });
}

// Initial render of the Goal accordion on the (renamed) Entry Confirm screen
renderGoalAccordion();
// Wire the locked custom goal link to open the upgrade modal
document.getElementById('goalCustomLink')?.addEventListener('click', (e)=>{
  e.preventDefault();
  const title = document.getElementById('upgTitle');
  if (title) title.textContent = 'Unlock custom journey goals';
  const msg = document.querySelector('#upgradeModal .modal p');
  if (msg) msg.innerHTML = 'Creating a custom journey goal is available on paid plans.';
  upg.classList.add('show');
});


/* Keep custom link behavior (locked link) */
document.getElementById('entryCustomLink')?.addEventListener('click', ()=>{
  const title = document.getElementById('upgTitle');
  if(title) title.textContent = 'Unlock more ways to start your journeys.';
  upg.classList.add('show');
});




/* ========= Automation Step (screen after EPV) ========= */
// Buttons
const autoVisitPreviewBtn = document.getElementById('autoVisitPreview');
const autoVisitAddBtn     = document.getElementById('autoVisitAdd');

const autoRecLabel        = document.getElementById('autoRecLabel');
const autoRecCard         = document.getElementById('autoRecCard');
const autoRecEnableBtn    = document.getElementById('autoRecEnable');
const autoRecPreviewBtn   = document.getElementById('autoRecPreview');
const autoRecAddBtn       = document.getElementById('autoRecAdd');

// EPV Fullscreen Modal (clones the EPV card)
const epvFullModal   = document.getElementById('epvFullModal');
const epvModalHost   = document.getElementById('epvModalHost');
const epvFullClose   = document.getElementById('epvFullClose');

function toggleEpvFull(show){
  if(!epvFullModal) return;
  epvFullModal.classList.toggle('show', !!show);
  epvFullModal.setAttribute('aria-hidden', show ? 'false' : 'true');

  // Always clear the modal host so no items are shown
  if(epvModalHost) epvModalHost.innerHTML = '';
}

epvFullClose?.addEventListener('click', ()=> toggleEpvFull(false));

// Generic Fullscreen Modal (placeholder for "Download File" preview)
const autoGenericModal = document.getElementById('autoGenericModal');
const autoGenericClose = document.getElementById('autoGenericClose');
function toggleAutoGeneric(show){
  if(!autoGenericModal) return;
  autoGenericModal.classList.toggle('show', !!show);
  autoGenericModal.setAttribute('aria-hidden', show ? 'false' : 'true');
}
autoGenericClose?.addEventListener('click', ()=> toggleAutoGeneric(false));

// Wire buttons
autoVisitPreviewBtn?.addEventListener('click', ()=> toggleEpvFull(true));
autoVisitAddBtn?.addEventListener('click', ()=> goTo(idx + 1));

autoRecPreviewBtn?.addEventListener('click', ()=> toggleAutoGeneric(true));
autoRecAddBtn?.addEventListener('click', ()=> goTo(idx + 1));

// Enable the second box (remove gray + hide "Recommended Next Step")
autoRecEnableBtn?.addEventListener('click', ()=>{
  const isEnabled = !autoRecCard.classList.contains('disabled');

  if (isEnabled) {
    // Revert to disabled state
    autoRecCard.classList.add('disabled');
    autoRecCard.setAttribute('aria-disabled', 'true');
    autoRecLabel.style.display = 'block';
    autoRecEnableBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M12 5v14M5 12h14"/></svg>'; // plus icon
  } else {
    // Enable the card
    autoRecCard.classList.remove('disabled');
    autoRecCard.removeAttribute('aria-disabled');
    autoRecLabel.style.display = 'none';
    autoRecEnableBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor"><path d="M5 12h14"/></svg>'; // minus icon
  }
});




/* ========= Form Preview sheet ========= */
const formSheet = document.getElementById('formPreviewSheet');
function toggleFormPreview(show){
  formSheet.classList.toggle('show', !!show);
  formSheet.setAttribute('aria-hidden', show ? 'false' : 'true');
}
document.getElementById('viewDownloadForm')?.addEventListener('click', ()=>toggleFormPreview(true));
document.getElementById('previewVCardBtn')?.addEventListener('click', ()=>togglePeek(true));
document.getElementById('previewVCardBtn2')?.addEventListener('click', ()=>togglePeek(true));

document.getElementById('formPreviewClose')?.addEventListener('click', ()=>toggleFormPreview(false));
window.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && formSheet.classList.contains('show')) toggleFormPreview(false); });



/* ========= Phone-styled Email Preview ========= */
let phoneModalOpen = false;
const phoneModal = document.getElementById('phonePreview');
function togglePhone(show, previewKey = null){
  phoneModal.classList.toggle('show', !!show);
  phoneModal.setAttribute('aria-hidden', show ? 'false' : 'true');
  phoneModalOpen = !!show;
  if(show) { syncPhoneTitle(); renderMail(previewKey); }
}

document.getElementById('phoneClose')?.addEventListener('click', ()=>togglePhone(false));
document.getElementById('peekEmail1')?.addEventListener('click', ()=>togglePhone(true, null));
document.getElementById('peekEmail2')?.addEventListener('click', ()=>togglePhone(true, null));

function syncPhoneTitle(){
  const txt = safe(S.subject?.value, "It’s great to be connected!");
  const t1 = document.getElementById('phoneTitle');
  if(t1) t1.textContent = txt;
  const t2 = document.getElementById('fullPhoneTitle');
  if(t2) t2.textContent = txt;
}



function socialButtons(){
  return socials.filter(s=>s.url).map(s=>{
    const key=socialIconKey(s.platform);
    return `<a href="${s.url}" target="_blank" rel="noopener" aria-label="${key}">${i16(key)}</a>`;
  }).join('');
}

function renderMail(previewKey = null){
  const subj = safe(S.subject?.value, "It’s great to be connected!");
  const logo = logoUrl ? `<div style="text-align:center;margin-bottom:10px"><img src="${logoUrl}" alt="logo" style="max-width:160px;max-height:60px;object-fit:contain"/></div>` : '';

  const signature = `
    <div class="sig">
${photoUrl?`<img src="${photoUrl}" alt="headshot" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">`:''}
      <div class="meta">
        <div class="name">${safe(S.firstName?.value,'[First]')} ${safe(S.lastName?.value,'[Last]')}</div>
        <div>${safe(S.company?.value,'[Company]')}</div>
        ${safe(S.emailBiz?.value,'')?`<div>${S.emailBiz.value}</div>`:''}
        ${safe(S.phoneBiz?.value,'')?`<div>${S.phoneBiz.value}</div>`:''}
        ${socials.length?`<div class="socials">${socialButtons()}</div>`:''}
      </div>
    </div>`;

/* Build CTA once — used in both 👁 modal and Final Check */
const templateKey = previewKey || chosenTemplate;
let ctaHtml = '';
if (templateKey === 'book') {
  const dest = safe(S.ctaDest?.value, '');
  const href = dest || '#';
  ctaHtml = `<p style="margin:18px 0"><a class="cta-btn" href="${href}" target="_blank" rel="noopener">Book a Meeting</a></p>`;
} else if (templateKey === 'email') {
  const mail = safe(S.emailBiz?.value, '');
  const href = mail ? `mailto:${mail}` : '#';
  ctaHtml = `<p style="margin:18px 0"><a class="cta-btn" href="${href}">Send Me an Email</a></p>`;
} else if (templateKey === 'call') {
  const ph = safe(S.phoneBiz?.value, '');
  const href = ph ? `tel:${ph.replace(/[^+\d]/g,'')}` : '#';
  ctaHtml = `<p style="margin:18px 0"><a class="cta-btn" href="${href}">Call Me</a></p>`;
}


/* Phone modal (👁) preview — CTA now included BEFORE the footer */
  const htmlPhone = `
  <div class="mail-body">
    ${logo}
    <p>Hello [firstname], thanks for downloading my digital business card — I’m excited we crossed paths. Let me introduce myself a bit more:</p>

    <p style="font-weight:800;margin-top:12px">About My Business</p>
    <p>${safe(coOverview?.value,'[company_overview]')}</p>

    <p style="font-weight:800;margin-top:12px">What Drives Us</p>
    <p>${safe(coMission?.value,'[mission_statement]')}</p>

    <p style="font-weight:800;margin-top:12px">What Makes Us Different</p>
    <p>${safe(coDiff?.value,'[organization_values]')}</p>

    <p style="font-weight:800;margin-top:12px">Our Core Values</p>
    <p>${safe(coValues?.value,'[differentiating_propositions]')}</p>

    ${ctaHtml}
    ${signature}
  </div>
`;

   
  /* Step 5 (Final Check) full preview — CTA appears BEFORE the footer */
  const htmlFull = `
    <div class="mail-body">
      ${logo}
      <p>Hello [firstname], thanks for downloading my digital business card — I’m excited we crossed paths. Let me introduce myself a bit more:</p>

      <p style="font-weight:800;margin-top:12px">About My Business</p>
      <p>${safe(coOverview?.value,'[company_overview]')}</p>

      <p style="font-weight:800;margin-top:12px">What Drives Us</p>
      <p>${safe(coMission?.value,'[mission_statement]')}</p>

      <p style="font-weight:800;margin-top:12px">What Makes Us Different</p>
      <p>${safe(coDiff?.value,'[organization_values]')}</p>

      <p style="font-weight:800;margin-top:12px">Our Core Values</p>
      <p>${safe(coValues?.value,'[differentiating_propositions]')}</p>

      ${ctaHtml}
      ${signature}
    </div>
  `;

  const hostPhone = document.getElementById('mailPreview');
  if(hostPhone) hostPhone.innerHTML = htmlPhone;

  const hostFull = document.getElementById('mailPreviewFull');
  if(hostFull) hostFull.innerHTML = htmlFull;
}


/* ========= Buttons & Summary Toggle ========= */
document.getElementById('btnPreviewCard')?.addEventListener('click', ()=>alert('Mock: Opening public vCard link'));
document.getElementById('btnFillInfo')?.addEventListener('click', ()=>goTo(1));
document.getElementById('seeExamples')?.addEventListener('click', ()=>{ alert('Mock: shows a gallery of sample vCards.'); });

const toggle = document.getElementById('toggle');
toggle?.addEventListener('click', ()=>{
  const on = toggle.classList.toggle('on');
  toggle.setAttribute('aria-checked', on ? 'true' : 'false');
  alert(on ? 'Journey activated' : 'Journey deactivated');
});

/* ===== Final Check actions ===== */
// — Summary screen actions —
(function(){
  const push = document.getElementById('summaryPush');

  function showPush(msg){
    if(!push) return;
    push.textContent = msg;
    push.classList.add('show');
    setTimeout(()=> push.classList.remove('show'), 2200);
  }

  // Test with a Person: send invite (fake)
  const sendBtn = document.getElementById('sendTestInviteBtn');
  const emailIn = document.getElementById('testInviteEmail');
  sendBtn?.addEventListener('click', ()=>{
    const v = (emailIn?.value || '').trim();
    if(!v){
      emailIn?.focus();
      showPush('Please enter an email address.');
      return;
    }
    showPush(`Test invite sent to ${v}.`);
  });

  // Test with Myself (no-op per spec; keep button for UX)
  document.getElementById('goToMyVcardBtn')?.addEventListener('click', ()=> {
    // intentionally no action
  });

  // Activate Journey — Go Live modal + state lifecycle
  const actBtn = document.getElementById('activateJourneyBtn');
  const modal  = document.getElementById('activateModal');
  const actCancel  = document.getElementById('activateCancel');
  const actConfirm = document.getElementById('activateConfirm');

  function openActivateModal(){ if(modal){ modal.style.display='flex'; modal.classList.add('show'); } }
  function closeActivateModal(){ if(modal){ modal.classList.remove('show'); modal.style.display='none'; } }

  actBtn?.addEventListener('click', openActivateModal);
  actCancel?.addEventListener('click', closeActivateModal);

  actConfirm?.addEventListener('click', ()=>{
    closeActivateModal();
    if(!actBtn) return;
    // Launching...
    actBtn.disabled = true;
    actBtn.classList.remove('orange','green');
    actBtn.classList.add('gray');
    actBtn.setAttribute('aria-busy','true');
    actBtn.textContent = 'Launching....';

    // Fake delay, then Activated
    setTimeout(()=>{
      actBtn.classList.remove('gray');
      actBtn.classList.add('green');
      actBtn.textContent = 'Journey Activated';
      actBtn.removeAttribute('aria-busy');
      actBtn.disabled = true;
    }, 1800);
  });
})();

document.getElementById('sendTestBtn')?.addEventListener('click', ()=>{
  // show push
  const p = document.getElementById('testPush');
  if(p){
    p.textContent = 'Test email sent to your address.';
    p.classList.add('show');
    setTimeout(()=> p.classList.remove('show'), 2200);
  }
  // (No actual send; this is a UI confirmation only.)
});

// "+ Add Another Touchpoint" → open the same modal
document.getElementById('addAnotherTouchpointBtn')?.addEventListener('click', ()=> {
  const title = document.getElementById('upgTitle');
  if (title) title.textContent = 'Requires an Upgrade';
  const msg = document.querySelector('#upgradeModal .modal p');
  if (msg) msg.innerHTML = 'Adding another touchpoint is available on paid plans.';
  document.getElementById('upgradeModal')?.classList.add('show');
});

// Auto-expand textareas while typing
document.addEventListener('input', e => {
  if (e.target.tagName.toLowerCase() === 'textarea') {
    e.target.style.height = 'auto';
    e.target.style.height = (e.target.scrollHeight) + 'px';
  }
});
/* ===== EPV: Inline, editable vCard for the Preview screen ONLY ===== */
(function(){
  const $ = (sel, ctx=document) => ctx.querySelector(sel);
  const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

  // Reuse existing global state if present (do not create/rename globals)
  const has = (o,k)=> Object.prototype.hasOwnProperty.call(o||{}, k);
  const State = (typeof S !== 'undefined') ? S : {};
  const Social = (typeof socials !== 'undefined') ? socials : [];
  // Banner/headshot data URLs from existing globals if available
  let bUrl = (typeof bannerUrl !== 'undefined') ? bannerUrl : '';
  let pUrl = (typeof photoUrl  !== 'undefined') ? photoUrl  : '';

  const sec = $('#epvSection');
  if(!sec) return; // screen might not be rendered yet

  const ui = {
    banner:  $('#epvBanner'),
    photo:   $('#epvPhoto'),
    name:    $('#epvName'),
    company: $('#epvCompany'),
    title:   $('#epvTitle'),
    headline:$('#epvHeadline'),

    emailBiz:        $('#epvEmailBiz'),
    emailPersonal:   $('#epvEmailPersonal'),
    phoneBiz:        $('#epvPhoneBiz'),
    phonePersonal:   $('#epvPhonePersonal'),
    website:         $('#epvWebsite'),

        socialRows:      $('#epvSocialRows'),
    socialAdder:     $('#epvSocialAdder'),

    socialPlatform:  $('#epvSocialPlatform'),
    socialUrl:       $('#epvSocialUrl'),
    fileBanner:      $('#epvBannerFile'),
    filePhoto:       $('#epvPhotoFile'),
  };

  function val(input){ return (input && typeof input.value === 'string') ? input.value.trim() : ''; }
  function set(input, v){ if(input){ input.value = v; input.dispatchEvent(new Event('input')); } }

  function textOr(el, s, ph){ if(el) el.textContent = s || ph; }

  function socialIconKey(platform){
    if(platform && platform.startsWith('linkedin')) return 'linkedin';
    return { facebook:'facebook', instagram:'instagram', pinterest:'pinterest', x:'x', google:'google', youtube:'youtube', tiktok:'tiktok' }[platform] || 'link';
  }
  function i16(name){
    switch (name) {
      case 'phone': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M22 16.9v3a2 2 0 0 1-2.2 2A19.8 19.8 0 0 1 3.1 5.3 2 2 0 0 1 5 3h3a2 2 0 0 1 2 1.7c.1.8.3 1.6.6 2.4a2 2 0 0 1-.5 2L8.1 9.9a16 16 0 0 0 6 6l1.5-1.1a2 2 0 0 1 2.1-.5c.8.3 1.6.5 2.4.6A2 2 0 0 1 22 16.9z"/></svg>`;
      case 'mail': return `<svg width="16" height="16" viewBox="0 0 24 24"><rect x="3" y="5" width="18" height="14" rx="2"/><path d="M3 7l9 6 9-6"/></svg>`;
      case 'link': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M8.5 14.5l-1 1a4.5 4.5 0 1 1-6.4-6.4l1-1a4.5 4.5 0 0 1 6.4 0"/><path d="M15.5 9.5l1-1a4.5 4.5 0 1 1 6.4 6.4l-1 1a4.5 4.5 0 0 1-6.4 0"/><path d="M9 12h6"/></svg>`;
      case 'linkedin': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M4 9h4v11H4z"/><circle cx="6" cy="5" r="2"/><path d="M10 9h4v2a4 4 0 0 1 8 0v9h-4v-8a2 2 0 0 0-4 0v8h-4z"/></svg>`;
      case 'youtube': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M22 12s0-3-.4-4.5A3 3 0 0 0 19.5 5C17.3 4.8 12 4.8 12 4.8s-5.3 0-7.5.2A3 3 0 0 0 2.4 7.5C2 9 2 12 2 12s0 3 .4 4.5A3 3 0 0 0 4.5 19c2.2.2 7.5.2 7.5.2s5.3 0 7.5-.2a3 3 0 0 0 2.1-2.5C22 15 22 12 22 12z"/><path d="M10 9l5 3-5 3z"/></svg>`;
      case 'x': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M4 4l16 16M20 4L4 20"/></svg>`;
      case 'instagram': return `<svg width="16" height="16" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="5"/><circle cx="12" cy="12" r="4"/><circle cx="17" cy="7" r="1"/></svg>`;
      case 'facebook': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M18 2h-3a4 4 0 0 0-4 4v3H8v4h3v9h4v-9h3l1-4h-4V6a1 1 0 0 1 1-1h3z"/></svg>`;
      case 'pinterest': return `<svg width="16" height="16" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M11 19c.5-3.8 1.8-6 1.8-8 0-1.6-1.2-2.7-2.8-2.7S7.2 9.2 7.2 10.8c0 1.1.6 2.1 1.8 2.5"/></svg>`;
      case 'google': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M20 12a8 8 0 1 1-2.34-5.66"/><path d="M12 12h8"/></svg>`;
      case 'tiktok': return `<svg width="16" height="16" viewBox="0 0 24 24"><path d="M14 6a5 5 0 0 0 5 5"/><path d="M10 7v8.5a3.5 3.5 0 1 1-3-3.45"/></svg>`;
    }
    return '';
  }

  function renderEPV(){
    // Banner & photo
    if(ui.banner) ui.banner.style.backgroundImage = bUrl ? `url('${bUrl}')` : '';
    if(ui.photo){
      // Always re-read the latest global headshot (photoUrl) each render; fall back to cached pUrl
      const curPhoto = (typeof photoUrl !== 'undefined' && photoUrl) ? photoUrl : pUrl;

      if(curPhoto){
        // Keep local cache in sync so EPV file uploads still work
        pUrl = curPhoto;

        ui.photo.style.backgroundImage = `url('${curPhoto}')`;
        ui.photo.style.backgroundSize = 'cover';
        ui.photo.style.backgroundPosition = 'center';
        ui.photo.style.backgroundRepeat = 'no-repeat';

        ui.photo.innerHTML = `<button class="epv-pencil-upload epv-small" data-epv-upload="headshot" aria-label="Upload headshot" title="Upload headshot"><svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>
</button>`;
      } else {
        ui.photo.style.backgroundImage = '';
        ui.photo.style.backgroundSize = '';
        ui.photo.style.backgroundPosition = '';
        ui.photo.style.backgroundRepeat = '';

        ui.photo.innerHTML = `
          <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>
          <button class="epv-pencil-upload epv-small" data-epv-upload="headshot" aria-label="Upload headshot" title="Upload headshot"><svg width="12" height="12" viewBox="0 0 24 24" aria-hidden="true">
  <path d="M21.731 2.269a2.625 2.625 0 0 0-3.714 0l-1.018 1.018 3.714 3.714 1.018-1.018a2.625 2.625 0 0 0 0-3.714z"/>
  <path d="M2.25 21.75 6.603 20.45a9 9 0 0 0 3.018-1.948l9.5-9.5-3.714-3.714-9.5 9.5A9 9 0 0 0 4.3 15.897L2.25 21.75z"/>
</svg>
</button>
        `;
      }
    }



    // Name/company/title/headline
    const first = has(State,'firstName') ? val(State.firstName) : '';
    const last  = has(State,'lastName')  ? val(State.lastName)  : '';
    const nameText = `${first || 'Your'} ${last || 'Name'}`.trim();
    textOr(ui.name, nameText, 'Your Name');
    textOr(ui.company, has(State,'company') ? val(State.company) : '', 'Your Company');
    textOr(ui.title,   has(State,'title')   ? val(State.title)   : '', 'Your Title');
    textOr(ui.headline,has(State,'headline')? val(State.headline): '', 'Your Headline');

    // Contacts (show data if present)
    const setOr = (el, src, ph) => textOr(el, src ? src : '', ph);
    setOr(ui.emailBiz,      has(State,'emailBiz')      ? val(State.emailBiz)      : '', 'Your Business Email');
    setOr(ui.emailPersonal, has(State,'emailPersonal') ? val(State.emailPersonal) : '', 'Your Personal Email');
    setOr(ui.phoneBiz,      has(State,'phoneBiz')      ? val(State.phoneBiz)      : '', 'Your Business Phone');
    setOr(ui.phonePersonal, has(State,'phonePersonal') ? val(State.phonePersonal) : '', 'Your Personal Phone');
    setOr(ui.website,       has(State,'website')       ? val(State.website)       : '', 'Your Website');

        // Socials list as normal rows (black icon circle, no borders), ABOVE the "+ Social Media" link
    if(ui.socialRows){
      const valid = Social.filter(s => s && s.url && s.url.trim());
      ui.socialRows.innerHTML = valid.map((s) => {
        const icon = socialIconKey(s.platform);
        return `
          <div class="v-demo-row">
            <span class="icon-pill" aria-hidden="true">${i16(icon)}</span>
            <div class="epv-cell">
              <span class="epv-text">${s.url}</span>
            </div>
          </div>
        `;
      }).join('');
    }

  }

  function startEdit(kind){
    // Prevent multiple inputs at once
    if($('#epvSection .epv-input')) return;

    if(kind==='name'){
      const holder = ui.name;
      if(!holder) return;
      const wrap = document.createElement('div');
      wrap.className = 'epv-name-dual';
      const in1 = document.createElement('input');
      const in2 = document.createElement('input');
      [in1,in2].forEach(inp => { inp.type='text'; inp.className='epv-input'; });
      in1.placeholder = 'First name';
      in2.placeholder = 'Last name';
      in1.value = has(State,'firstName') ? val(State.firstName) : '';
      in2.value = has(State,'lastName')  ? val(State.lastName)  : '';
      holder.replaceChildren(wrap);
      const row = holder.closest('.epv-edit-row');
      if(row) row.classList.add('epv-editing');
      wrap.appendChild(in1); wrap.appendChild(in2);
      setTimeout(()=> in1.focus(), 0);
      const commit = ()=>{
      if(has(State,'firstName')) set(State.firstName, in1.value.trim());
      if(has(State,'lastName'))  set(State.lastName,  in2.value.trim());
      renderEPV(); if(typeof updatePreviews === 'function') updatePreviews();
      if(row) row.classList.remove('epv-editing');
};

      in1.addEventListener('blur', ()=> setTimeout(commit,0));
      in2.addEventListener('blur', ()=> setTimeout(commit,0));
      [in1,in2].forEach(inp => inp.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); commit(); }}));
      return;
    }

    const map = {
      company: {el:ui.company, src: State.company, ph:'Your Company'},
      title:   {el:ui.title,   src: State.title,   ph:'Your Title'},
      headline:{el:ui.headline,src: State.headline,ph:'Your Headline'},
      emailBiz:      {el:ui.emailBiz,      src: State.emailBiz,      ph:'Your Business Email', type:'email'},
      emailPersonal: {el:ui.emailPersonal, src: State.emailPersonal, ph:'Your Personal Email', type:'email'},
      phoneBiz:      {el:ui.phoneBiz,      src: State.phoneBiz,      ph:'Your Business Phone'},
      phonePersonal: {el:ui.phonePersonal, src: State.phonePersonal, ph:'Your Personal Phone'},
      website:       {el:ui.website,       src: State.website,       ph:'Your Website', type:'url'}
    };
    const m = map[kind]; if(!m || !m.el) return;

    const input = document.createElement('input');
    input.type = m.type || 'text';
    input.className = 'epv-input';
    input.placeholder = m.ph;
    input.value = m.src ? val(m.src) : '';
    m.el.replaceChildren(input);
    const row = m.el.closest('.epv-cell') || m.el.closest('.epv-edit-row');
    if(row) row.classList.add('epv-editing');

    setTimeout(()=> input.focus(), 0);

    const commit = ()=>{
  if(m.src) set(m.src, input.value.trim());
  renderEPV(); if(typeof updatePreviews === 'function') updatePreviews();
  if(row) row.classList.remove('epv-editing');
};

    input.addEventListener('blur', commit);
    input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); input.blur(); }});
  }

  function openSocialAdder(){ if(ui.socialAdder) ui.socialAdder.style.display=''; }
  function closeSocialAdder(){
    if(ui.socialAdder) ui.socialAdder.style.display='none';
    if(ui.socialPlatform) ui.socialPlatform.value = 'linkedin_business';
    if(ui.socialUrl) ui.socialUrl.value = '';
  }
  function addSocial(){
    if(!ui.socialPlatform || !ui.socialUrl) return;
    const url = ui.socialUrl.value.trim();
    if(!url){ closeSocialAdder(); return; }
    Social.push({ platform: ui.socialPlatform.value, url });
    closeSocialAdder();
    renderEPV(); if(typeof updatePreviews === 'function') updatePreviews();
  }

  // Read file -> dataURL
  function readFileToDataURL(file, cb){ const r=new FileReader(); r.onload = e => cb(e.target.result); r.readAsDataURL(file); }

  // Event delegation only inside this section
  sec.addEventListener('click', (e)=>{
    const btn = e.target.closest('button');
    if(!btn) return;

    if(btn.matches('[data-epv-edit]')){
      startEdit(btn.getAttribute('data-epv-edit'));
      return;
    }

    if(btn.matches('[data-epv-upload]')){
      const kind = btn.getAttribute('data-epv-upload');
      if(kind==='banner') ui.fileBanner?.click();
      if(kind==='headshot') ui.filePhoto?.click();
      return;
    }

    if(btn.matches('[data-epv-action="social-open"]')){ openSocialAdder(); return; }
    if(btn.matches('[data-epv-action="social-cancel"]')){ closeSocialAdder(); return; }
    if(btn.matches('[data-epv-action="social-add"]')){ addSocial(); return; }
    if(btn.matches('[data-epv-action="social-remove"]')){
      const idx = parseInt(btn.getAttribute('data-idx'),10);
      if(!Number.isNaN(idx)){ Social.splice(idx,1); renderEPV(); if(typeof updatePreviews === 'function') updatePreviews(); }
      return;
    }
  });

  // File inputs (scoped)
  ui.fileBanner?.addEventListener('change', ()=>{
    const f = ui.fileBanner.files?.[0]; if(!f) return;
    readFileToDataURL(f, url=>{
      bUrl = url;
      // Push to existing global var if present so other screens match
      if(typeof bannerUrl !== 'undefined') bannerUrl = url;
      renderEPV(); if(typeof updatePreviews === 'function') updatePreviews();
    });
  });
  ui.filePhoto?.addEventListener('change', ()=>{
    const f = ui.filePhoto.files?.[0]; if(!f) return;
    readFileToDataURL(f, url=>{
      pUrl = url;
      if(typeof photoUrl !== 'undefined') photoUrl = url;
      renderEPV(); if(typeof updatePreviews === 'function') updatePreviews();
    });
  });

  // Initial render on load + expose for external calls
  window.__segwikRenderEPV = renderEPV;
  renderEPV();
})();



/* ========= Init ========= */
renderSocialRows();
/* (replaced) render of new personality UI happens on load above */
goTo(0);
updatePreviews();
syncPhoneTitle();
renderMail();



</script>
</body>
</html>
