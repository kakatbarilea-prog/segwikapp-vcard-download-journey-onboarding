<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Segwik Mobile – vCard Journey Onboarding (Revised)</title>
<style>
  :root {
    --bg:#f6f8fb; --ink:#243048; --muted:#667085; --line:#e6ebf2;
    --accent:#0F2D56; --pill:#eef4ff; --pill-border:#cfe1ff; --ok:#16a34a;
    --phone-w:430px; --phone-h:800px; --footer-h:36px; --status-h:46px;
    --card:#fff; --radius:16px; --shadow:0 14px 38px rgba(0,0,0,.08);
    --slide-ms:320ms; --pager-gap:96px; /* tightened to reduce empty space */
    --banner:#fff7c2; --banner-ink:#4a3b00; --banner-border:#fde68a;

    /* blues for buttons */
    --blue:#2563eb;        /* 600 */
    --blue-700:#1d4ed8;
    --blue-50:#eff6ff;
    --blue-200:#bfdbfe;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;height:100%;background:var(--bg);
    display:flex;align-items:center;justify-content:center;
    font-family:'Segoe UI',system-ui,-apple-system,sans-serif;color:var(--ink)
  }
  .phone{
    width:var(--phone-w);height:var(--phone-h);background:#fff;border-radius:36px;
    border:8px solid #111;box-shadow:0 20px 60px rgba(0,0,0,.12),0 8px 16px rgba(0,0,0,.08);
    position:relative;display:flex;flex-direction:column;overflow:hidden
  }
  .notch{position:absolute;top:8px;left:50%;transform:translateX(-50%);
    width:180px;height:30px;background:#111;border-radius:20px 20px 28px 28px;z-index:10}
  .status{
    height:var(--status-h);display:flex;align-items:center;justify-content:center;
    border-bottom:1px solid var(--line);font-weight:700;letter-spacing:.4px;color:#0F2D56
  }
  .screen{flex:1;background:#f6f8fb;overflow:hidden;position:relative}

  /* Intro (standalone, no dots/nav/swipe) */
  .intro{
    position:absolute; inset:0; padding:14px; display:flex; flex-direction:column; gap:12px;
  }
  .head{padding:10px 12px 0}
  .h1{font-size:20px;font-weight:800;color:var(--accent)}
  .p{font-size:13px;color:#667085;line-height:1.5;margin-top:4px}
  .hero{
    background:#fff;border:1px solid var(--line);border-radius:20px;padding:16px;
    box-shadow:var(--shadow);display:grid;place-items:center;min-height:300px
  }
  .hero svg{width:220px;height:220px;opacity:.9}

  .btn{
    appearance:none;border:1px solid var(--line);background:#fff;color:var(--accent);
    padding:10px 14px;border-radius:12px;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:8px
  }
  .btn svg{width:16px;height:16px}
  .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
  .btn.ghost{background:#f8fafc}
  .btn.small{padding:8px 10px;border-radius:10px;font-size:12px}
  .btn.full{width:100%}

  /* new blue styles */
  .btn.blue{background:var(--blue);border-color:var(--blue);color:#fff}
  .btn.blue:hover{background:var(--blue-700);border-color:var(--blue-700)}
  .btn.outline-blue{background:#fff;color:var(--blue);border-color:var(--blue-200)}
  .btn.outline-blue:hover{background:#eff6ff;border-color:var(--blue)}

  /* Carousel (steps after Start) */
  .carousel{height:100%;display:flex;width:100%;touch-action:pan-y;
    transition:transform var(--slide-ms) cubic-bezier(.22,.61,.36,1)}
  .slide{min-width:100%;height:100%;padding:14px;display:flex;flex-direction:column}
  .scroll{
    background:transparent; overflow:auto; padding:12px 0;
    margin-bottom:var(--pager-gap);
    display:flex; flex-direction:column; gap:12px;
  }
  .card{
    background:var(--card);border:1px solid var(--line);border-radius:var(--radius);
    box-shadow:var(--shadow);padding:14px
  }
  .row{display:flex;gap:10px}
  .row.actions{margin-bottom:16px;}
  .row.wrap{flex-wrap:wrap}
  .col{flex:1}
  .chips{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .chip{
    border:1px solid var(--pill-border);background:var(--pill);border-radius:12px;
    padding:10px;cursor:pointer;font-weight:700;display:flex;justify-content:space-between;align-items:center
  }

  textarea,input[type="text"],input[type="url"],input[type="email"],input[type="file"],select{
    width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:12px;
    background:#f8fafc;font-family:inherit;font-size:13px;outline:none
  }
  textarea{min-height:110px;resize:vertical}
  .split{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .label{font-size:12px;color:#667085;font-weight:700;margin-bottom:6px}
  .mini{font-size:12px;color:#7a849a}
  .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px}

  /* vCard & email preview (used earlier steps) */
  .preview-mail{border:1px solid #e6ebf2;border-radius:12px;padding:12px;background:#fff}
  .preview-mail .subj{font-weight:800;margin-bottom:6px}
  .preview-mail .body{white-space:pre-wrap}

  /* Fake AI loader */
  .ai-status{
    display:none;align-items:center;gap:8px;margin-bottom:10px;padding:8px 10px;
    border:1px dashed var(--pill-border);background:#f8fbff;border-radius:10px;font-size:12px;color:#43506a
  }
  .ai-status.show{display:flex}
  .spinner{width:16px;height:16px;border-radius:50%;
    border:2px solid #cfe1ff;border-top-color:#0F2D56;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Pager & nav */
  .nav{
    position:absolute;left:0;right:0;bottom:calc(var(--footer-h) - 2px);
    display:flex;gap:8px;justify-content:space-between;padding:0 14px
  }
  .pager{
    position:absolute;left:0;right:0;bottom:calc(var(--footer-h) - 2px);
    display:flex;justify-content:center;gap:6px
  }
  .dot{width:8px;height:8px;border-radius:50%;background:#c9d2e4;opacity:.8}
  .dot.active{background:#0F2D56;opacity:1}

  /* Bottom Sheet (upgrade / config) */
  .sheet-wrap{position:absolute;inset:0;display:none;align-items:flex-end;background:rgba(15,45,86,.28);z-index:60}
  .sheet-wrap.show{display:flex}
  .sheet{
    width:100%;background:#fff;border-top:1px solid var(--pill-border);
    border-radius:16px 16px 0 0;box-shadow:0 18px 40px rgba(15,45,86,.18);
    padding:14px;transform:translateY(100%);transition:transform .25s ease
  }
  .sheet-wrap.show .sheet{transform:translateY(0)}
  .sheet .title{font-weight:800;color:#0F2D56;margin-bottom:6px}
  .sheet .text{font-size:13px;color:#667085;line-height:1.5;margin-bottom:12px}

  /* Toggle */
  .toggle{display:flex;align-items:center;gap:10px}
  .switch{
    width:44px;height:26px;border-radius:999px;background:#e5eaf4;position:relative;cursor:pointer;border:1px solid var(--line)
  }
  .knob{position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#fff;transition:left .2s ease}
  .switch.active{background:#16a34a;border-color:#16a34a}
  .switch.active .knob{left:22px}

  /* Tray */
  .tray{
    display:grid;grid-template-columns:repeat(5,1fr);gap:8px;padding:8px;border-top:1px solid var(--line);
    background:#fff;position:sticky;bottom:0
  }
  .ibtn{padding:8px;border:1px solid var(--line);border-radius:10px;background:#f8fafc;display:grid;place-items:center;cursor:pointer}
  svg{stroke:currentColor;fill:none;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;width:17px;height:17px}

  /* --- Autoresponder Preview --- */
  .after-dl-banner{background:var(--banner); color:var(--banner-ink); border:1px solid var(--banner-border); border-radius:12px; padding:10px 12px; display:flex; gap:10px; align-items:flex-start; font-size:13px; font-weight:700}
  .after-dl-banner .icon{flex:0 0 auto; width:18px; height:18px; border-radius:4px; background:#f59e0b; display:grid; place-items:center; color:#fff; font-size:12px; font-weight:900}

  /* Stretch preview box and keep inner scroll (Step 5) */
  #step-preview{padding-bottom:calc(var(--footer-h) + 48px);}
  #step-preview .scroll{display:flex;flex-direction:column;gap:12px;overflow:hidden; margin-bottom:0; padding-bottom:0;}
  #step-preview .card{display:flex;flex-direction:column; flex:1; min-height:0;}
  .mail-frame{
    border:1px solid #e6ebf2; border-radius:16px; overflow:hidden; background:#fff;
    display:flex; flex-direction:column; flex:1; min-height:0;
  }
  .mail-topbar{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #eef1f6}
  .mail-topbar .subject{font-weight:800; font-size:14px; line-height:1.2; padding-right:8px}
  .mail-topbar .actions{display:flex; gap:8px; align-items:center}
  .actions.dots .dotc{width:10px;height:10px;border-radius:50%;}
  .actions.dots .dotc.r{background:#ef4444}
  .actions.dots .dotc.o{background:#f59e0b}
  .actions.dots .dotc.g{background:#22c55e}

  .mail-from{display:flex; align-items:center; gap:10px; padding:10px 12px; border-bottom:1px solid #eef1f6}
  .from-avatar{width:28px; height:28px; border-radius:50%; background:#dfe9ff; display:grid; place-items:center; font-size:12px; color:#0F2D56; font-weight:800}
  .from-meta{line-height:1.1}
  .from-name{font-weight:800; font-size:13px}
  .from-details{font-size:12px; color:#6b7280}

  .mail-body{flex:1; overflow:auto; padding:14px 14px 18px 14px; line-height:1.55; -webkit-overflow-scrolling:touch;}
  .mail-body h3{margin:0 0 6px 0; font-size:15px}
  .mail-body p{margin:0 0 10px 0; font-size:13px; color:#243048}
  .sig{display:flex; gap:12px; margin-top:14px; align-items:flex-start}
  .sig .headshot{width:56px; height:56px; border-radius:12px; background:#dfe9ff; display:grid; place-items:center; font-size:11px; color:#667085; flex:0 0 auto}
  .sig .meta{font-size:13px}
  .sig .meta a{color:#0F2D56; text-decoration:none}
  .sig .meta a:hover{text-decoration:underline}

  /* Email header logo */
  .mail-logo-wrap{margin:6px 0 8px 0; text-align:center}
  .mail-logo{max-width:180px; max-height:56px; width:auto; height:auto}

  /* Full-screen preview overlay */
  .full-overlay{position:absolute; inset:0; background:#fff; z-index:70; display:none; flex-direction:column;}
  .full-overlay.show{display:flex}
  .full-topbar{display:flex; align-items:center; justify-content:space-between; padding:10px 12px; border-bottom:1px solid #eef1f6; font-weight:800; color:#0F2D56;}
  .full-close{appearance:none; background:transparent; border:0; font-size:22px; line-height:1; cursor:pointer; padding:4px 8px;}
  .full-content{flex:1; display:flex; padding:12px; overflow:hidden;}
  .full-content .mail-frame{height:100%; width:100%; display:flex; flex-direction:column;}

  /* ---- CTA Insert styles ---- */
  .cta-insert{
    border:2px dashed var(--blue); background:var(--blue-50);
    border-radius:14px; padding:12px; margin:14px 0 4px 0; position:relative;
  }
  .cta-insert .cta-head{font-weight:900; color:#0F2D56; margin-bottom:8px; font-size:13px; letter-spacing:.2px;}
  .cta-carousel{overflow:hidden; position:relative;}
  .cta-track{display:flex; transition:transform .28s ease;}
  .cta-slide{min-width:100%; padding:4px;}
  .cta-card{
    background:#fff; border:1px solid var(--blue-200); border-radius:12px; padding:12px;
    box-shadow:0 6px 14px rgba(37,99,235,.08);
  }
  .cta-card h4{margin:0 0 6px 0; font-size:14px; color:#0F2D56}
  .cta-card p{margin:0 10px 10px 0; font-size:13px; color:#243048}

  /* NEW: arrows instead of dots */
  .cta-arrows{display:flex; gap:8px; justify-content:space-between; align-items:center; margin-top:8px}
  .icon-btn{appearance:none; background:#fff; border:1px solid var(--blue-200); border-radius:10px; padding:8px; display:inline-grid; place-items:center; cursor:pointer}
  .icon-btn:hover{background:#eff6ff; border-color:var(--blue)}
  .icon-btn svg{width:18px; height:18px}
  .cta-action-row{display:flex; gap:8px; align-items:center; margin-top:8px}

  /* NEW: applied CTA box */
  .cta-saved{
    border:1px solid var(--blue-200); background:#fff; border-radius:12px; padding:12px; margin:14px 0 4px 0; display:flex; gap:8px; align-items:flex-start; box-shadow:0 6px 14px rgba(37,99,235,.06);
  }
  .cta-saved .meta{flex:1}
  .cta-saved h4{margin:0 0 6px 0; font-size:14px; color:#0F2D56}
  .cta-saved p{margin:0 0 10px 0; font-size:13px}
  .cta-saved .edit-right{flex:0 0 auto; display:grid; place-items:center; margin-left:6px}

  /* NEW: flash animation when auto-scrolling */
  @keyframes cta-flash{
    0%{box-shadow:0 0 0 0 rgba(37,99,235,.0)}
    40%{box-shadow:0 0 0 6px rgba(37,99,235,.18)}
    100%{box-shadow:0 0 0 0 rgba(37,99,235,0)}
  }
  .flash{animation:cta-flash 1.1s ease}

  /* Step 6 layout: stretch preview to use space (fix empty gap) */
  .slide[data-step="cta"] .scroll{display:flex; flex-direction:column; gap:12px; overflow:hidden; margin-bottom:0; padding-bottom:0;}
  .slide[data-step="cta"] .card{display:flex; flex-direction:column; flex:1; min-height:0;}
  .slide[data-step="cta"] .mail-frame{flex:1; min-height:0;}

  /* NEW: Centered CTA editor modal (replaces bottom-sheet style) */
  .modal-wrap{position:absolute; inset:0; display:none; align-items:center; justify-content:center; background:rgba(15,45,86,.28); z-index:80}
  .modal-wrap.show{display:flex}
  .modal{
    width:88%; max-width:380px; background:#fff; border:1px solid var(--pill-border);
    border-radius:14px; box-shadow:0 18px 40px rgba(15,45,86,.18);
    padding:14px; position:relative;
  }
  .modal .title{font-weight:800; color:#0F2D56; margin-bottom:6px}
  .modal .text{font-size:13px; color:#667085; line-height:1.5; margin-bottom:12px}
  .modal .x{position:absolute; top:8px; right:10px; appearance:none; border:0; background:transparent; font-size:20px; cursor:pointer; line-height:1}

</style>
</head>
<body>
  <div class="phone">
    <div class="notch"></div>
    <div class="status">SEGWiK</div>

    <div class="screen">
      <!-- INTRO (no dots/nav/swipe) -->
      <section id="intro" class="intro">
        <div class="head">
          <div class="h1">Set-Up Your vCard Download Journey</div>
          <div class="p">When someone downloads your vCard, Segwik can automatically send an autoresponder, alert you, and guide that person to their next step.</div>
        </div>
        <div class="hero" aria-hidden="true">
          <svg viewBox="0 0 360 360">
            <rect x="40" y="60" rx="20" ry="20" width="280" height="180" fill="#eef4ff" stroke="#cfe1ff"/>
            <rect x="68" y="90" width="90" height="90" rx="12" fill="#dfe9ff"/>
            <rect x="168" y="90" width="132" height="16" rx="8" fill="#cfe1ff"/>
            <rect x="168" y="114" width="120" height="10" rx="6" fill="#d7e6ff"/>
            <rect x="168" y="134" width="140" height="10" rx="6" fill="#e3edff"/>
            <rect x="168" y="156" width="110" height="10" rx="6" fill="#e3edff"/>
            <circle cx="260" cy="270" r="38" fill="none" stroke="#a9c6ff" stroke-width="10"/>
            <path d="M240 270h40" stroke="#0F2D56" stroke-width="10" stroke-linecap="round"/>
          </svg>
        </div>
        <button class="btn primary full" id="startBtn">Start</button>
      </section>

      <!-- STEPS CAROUSEL (appears after Start) -->
      <div id="flow" style="display:none; height:100%; position:relative;">
        <div id="carousel" class="carousel">
          <!-- Step 1: Company Details -->
          <section class="slide">
            <div class="head">
              <div class="h1">Review Company Details</div>
              <div class="p">These details populate your email headers/footers and help personalize your autoresponder.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <div class="label">Company Name</div>
                <input type="text" id="acct_name" />
                <div class="gap12"></div>

                <div class="split">
                  <div>
                    <div class="label">Company Phone</div>
                    <input type="text" id="acct_phone" />
                  </div>
                  <div>
                    <div class="label">Company Email</div>
                    <input type="email" id="acct_email" />
                  </div>
                </div>
                <div class="gap12"></div>

                <div class="label">Company Website</div>
                <input type="url" id="acct_site" />
                <div class="gap12"></div>

                <div class="label">Company Location</div>
                <div class="split">
                  <input type="text" id="addr1" placeholder="Address line 1" />
                  <input type="text" id="addr2" placeholder="Address line 2 (optional)" />
                </div>
                <div class="split" style="margin-top:10px">
                  <input type="text" id="city" placeholder="City" />
                  <input type="text" id="state" placeholder="State" />
                </div>
                <div class="split" style="margin-top:10px">
                  <input type="text" id="zip" placeholder="ZIP" />
                  <input type="text" id="country" placeholder="Country" />
                </div>
              </div>
            </div>
          </section>

          <!-- Step 2: Upload Logo -->
          <section class="slide">
            <div class="head">
              <div class="h1">Add Your Company Logo</div>
              <div class="p">We’ll use this in your autoresponder and previews.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <input type="file" id="logoInput" accept="image/*" />
                <div class="gap12"></div>
                <div class="label">Preview (Email Header)</div>
                <div class="preview-mail">
                  <div class="body" id="logoEmailPreview" style="text-align:center;">
                    <!-- centered logo image goes here -->
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 3: Brand Personality -->
          <section class="slide">
            <div class="head">
              <div class="h1">Pick Your Brand Personality</div>
              <div class="p">This guides AI when composing your overview, mission, values, and differentiator.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <div class="chips" id="personalityChips"></div>
              </div>
              <div class="card">
                <div class="label">Tone preview</div>
                <div id="tonePreview" class="p">Select a personality to preview tone.</div>
              </div>
            </div>
          </section>

          <!-- Step 4: AI Compose -->
          <section class="slide">
            <div class="head">
              <div class="h1">Tell Your Story</div>
              <div class="p">I’ll introduce your brand in a clear, human voice. You can edit anything before sending.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <div id="aiStatus" class="ai-status"><div class="spinner"></div><div id="aiStatusText">Generating your copy…</div></div>

                <div class="row actions">
                  <button class="btn primary" id="btnGenerate">Generate with AI</button>
                  <button class="btn ghost" id="btnRegenerate">Regenerate</button>
                </div>
                <div class="label">Company Overview</div>
                <textarea id="overview" placeholder="Here’s who we serve, what we do, and the outcomes we deliver."></textarea>
                <div class="gap12"></div>
                <div class="label">Mission Statement</div>
                <textarea id="mission" placeholder="Here’s the promise that guides our work every day."></textarea>
                <div class="gap12"></div>
                <div class="label">Organization Values</div>
                <textarea id="values" placeholder="Here are the principles we live by (comma or line-separated)."></textarea>
                <div class="gap12"></div>
                <div class="label">Differentiating Proposition</div>
                <textarea id="diffprop" placeholder="Here’s what makes us meaningfully different."></textarea>
              </div>
            </div>
          </section>

          <!-- Step 5: Preview – Autoresponder -->
          <section class="slide" id="step-preview">
            <div class="head">
              <div class="h1">Autoresponder Preview</div>
            </div>
            <div class="scroll">
              <div class="after-dl-banner" role="note" aria-label="Sends right after vCard download">
                <div class="icon">!</div>
                <div>Instant Send: This autoresponder goes out <u>immediately after someone downloads your vCard</u>.</div>
              </div>

              <div class="card">
                <div class="row wrap">
                  <button class="btn" id="btnEditTemplate" title="Edit email template">
                    <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
                  </button>
                  <button class="btn" id="btnFullPreview" title="View full preview">
                    <svg viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                  </button>
                  <button class="btn blue" id="btnSendPreview" style="margin-left:auto; margin-bottom:6px;">Send Me a Preview</button>
                </div>

                <div class="mail-frame" id="mailFrame">
                  <div class="mail-topbar">
                    <div class="subject" id="mailSubject">It’s Great to Be Connected!</div>
                    <div class="actions dots" aria-label="More options">
                      <span class="dotc r"></span><span class="dotc o"></span><span class="dotc g"></span>
                    </div>
                  </div>
                  <div class="mail-from">
                    <div class="from-avatar">P</div>
                    <div class="from-meta">
                      <div class="from-name" id="fromName">Pete Romano</div>
                      <div class="from-details" id="fromDetails">pete@segwik.com • to katrina@segwik.com</div>
                    </div>
                  </div>
                  <div class="mail-body" id="mailBody"></div>
                </div>

                <div class="row wrap" style="margin-top:12px">
                  <button class="btn outline-blue" id="btnAddFollowUp" title="Add another follow-up email" style="margin-left:auto;">
                    <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
                    Add Another Follow-Up Email
                  </button>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 6: Additional CTA (email preview + CTA editor) -->
          <section class="slide" data-step="cta" id="step-cta">
            <div class="head">
              <div class="h1">Add an Extra Call-to-Action</div>
              <div class="p">Include an additional button in the autoresponder that nudges contacts toward a next step.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <!-- SAME email preview as previous screen, but WITHOUT edit/view/send buttons -->
                <div class="mail-frame" id="mailFrameCTA">
                  <div class="mail-topbar">
                    <div class="subject">It’s Great to Be Connected!</div>
                    <div class="actions dots" aria-label="More options">
                      <span class="dotc r"></span><span class="dotc o"></span><span class="dotc g"></span>
                    </div>
                  </div>
                  <div class="mail-from">
                    <div class="from-avatar">P</div>
                    <div class="from-meta">
                      <div class="from-name">Pete Romano</div>
                      <div class="from-details">pete@segwik.com • to katrina@segwik.com</div>
                    </div>
                  </div>
                  <div class="mail-body" id="mailBodyCTA">
                    <!-- injected via JS: email body + CTA insert/saved + signature -->
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Step 7: Auto-add to Journey -->
          <section class="slide">
            <div class="head">
              <div class="h1">Auto-Add to a Journey</div>
              <div class="p">Automatically place new contacts into a journey when they download your vCard.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <div class="label">Select a journey</div>
                <select id="journeySelect">
                  <option value="">— Choose a journey —</option>
                  <option>Event New Contact Follow-Up</option>
                  <option>Warm Reconnect</option>
                  <option>Cold/General Meeting Request</option>
                  <option>Demo Request</option>
                </select>
                <div class="mini" style="margin-top:8px">You can change this anytime from your automation settings.</div>
              </div>
            </div>
          </section>

          <!-- Step 8: You're All Set (final) -->
          <section class="slide">
            <div class="head">
              <div class="h1">You’re All Set!</div>
              <div class="p">You can further personalize your automation by attaching more emails to the sequence or creating custom journeys.</div>
            </div>
            <div class="scroll">
              <div class="card">
                <div class="row">
                  <button class="btn ghost full" id="seeUpgrade">See upgrade options</button>
                </div>
              </div>
              <div class="card">
                <div class="toggle">
                  <div class="switch" id="activateSwitch"><div class="knob"></div></div>
                  <div class="label">Activate this journey</div>
                </div>
              </div>
              <button class="btn primary full" id="finishBtn">Finish & Save Automation</button>
            </div>
          </section>
        </div>

        <!-- pager & nav for steps only -->
        <div class="nav">
          <button class="btn small ghost" id="backBtn">Back</button>
          <button class="btn small" id="nextBtn">Next</button>
        </div>
        <div class="pager" id="pager"></div>
      </div>

      <!-- Upgrade sheet (kept for future use) -->
      <div id="upgradeSheet" class="sheet-wrap" onclick="if(event.target.id==='upgradeSheet'){toggleSheet(false)}">
        <div class="sheet" onclick="event.stopPropagation()">
          <div class="title">Requires an Upgrade</div>
          <div class="text">Adding an extra CTA to the autoresponder is available on paid plans.</div>
          <div class="row">
            <button class="btn full" id="notNow">Not now</button>
            <button class="btn primary full" id="upgradeNow">Upgrade now</button>
          </div>
        </div>
      </div>

      <!-- Edit Template sheet -->
      <div id="editSheet" class="sheet-wrap" onclick="if(event.target.id==='editSheet'){toggleEditSheet(false)}">
        <div class="sheet" onclick="event.stopPropagation()">
          <div class="title">Requires an Upgrade</div>
          <div class="text">Customizing your email content is available on paid plans.</div>
          <div class="row">
            <button class="btn full" id="editNotNow">Not now</button>
            <button class="btn primary full" id="editUpgradeNow">Upgrade now</button>
          </div>
        </div>
      </div>

      <!-- Follow-Up Emails sheet -->
      <div id="followupSheet" class="sheet-wrap" onclick="if(event.target.id==='followupSheet'){toggleFollowupSheet(false)}">
        <div class="sheet" onclick="event.stopPropagation()">
          <div class="title">Requires an Upgrade</div>
          <div class="text">Multiple follow-up emails are available on paid plans.</div>
          <div class="row">
            <button class="btn full" id="followupNotNow">Not now</button>
            <button class="btn primary full" id="followupUpgradeNow">Upgrade now</button>
          </div>
        </div>
      </div>

      <!-- NEW: CTA Editor MODAL (centered) -->
      <div id="ctaModalWrap" class="modal-wrap" onclick="if(event.target.id==='ctaModalWrap'){toggleCtaModal(false)}">
        <div class="modal" onclick="event.stopPropagation()">
          <button class="x" id="ctaModalClose" aria-label="Close">×</button>
          <div class="title" id="ctaCfgTitle">Configure CTA</div>
          <div class="text" id="ctaCfgNote">Set your button label and destination.</div>
          <div class="label">Button label</div>
          <input type="text" id="ctaCfgLabel" placeholder="Book a Time" />
          <div class="gap8"></div>
          <div id="ctaCfgDestWrap">
            <div class="label" id="ctaCfgDestLabel">Destination</div>
            <input type="url" id="ctaCfgDest" placeholder="https://cal.com/your-link" />
            <div class="mini" id="ctaCfgMini" style="margin-top:6px; display:none"></div>
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn full" id="ctaCfgSave">Save CTA</button>
          </div>
        </div>
      </div>

      <!-- Full-screen email preview overlay -->
      <div id="fullPreview" class="full-overlay" aria-hidden="true">
        <div class="full-topbar">
          <div>Full Preview</div>
          <button class="full-close" id="closeFullPreview" aria-label="Close full preview">×</button>
        </div>
        <div class="full-content">
          <div class="mail-frame" id="mailFrameFull"></div>
        </div>
      </div>
    </div>

    <!-- Fixed tray (unchanged) -->
    <div class="tray" id="footer-tray">
      <div class="ibtn" data-icon="phone"></div>
      <div class="ibtn" data-icon="mail"></div>
      <div class="ibtn" data-icon="chat"></div>
      <div class="ibtn" data-icon="calendar"></div>
      <div class="ibtn" data-icon="note"></div>
    </div>
  </div>

<script>
/* ==== Footer icons (unchanged) ==== */
function icon(name){
  switch(name){
    case 'mail': return `<svg viewBox="0 0 24 24"><path d="M4 6h16v12H4z"/><path d="M4 7l8 6 8-6"/></svg>`;
    case 'phone': return `<svg viewBox="0 0 24 24"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0  0 1-8.63-3.07 19.5 19.5 0  0  1-6-6 19.79 19.79 0  0 1-3.07-8.67A2 2 0  0 1 4.11 2h3a2 2 0  0 1 2 1.72c.12 .9.3 1.77.57 2.61a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0  0 0 6 6l1.47-1.11a2 2 0 0 1 2.11-.45c.84 .27 1.71 .45 2.61 .57A2 2 0  0 1 22 16.92z"/></svg>`;
    case 'chat': return `<svg viewBox="0 0 24 24"><path d="M21 15a4 4 0  0 1-4 4H8l-5 3V7a4 4 0  0 1 4-4h10a4 4 0  0 1 4 4z"/></svg>`;
    case 'calendar': return `<svg viewBox="0 0 24 24"><path d="M3 8h18M5 4h14v16H5z"/><path d="M16 2v4M8 2v4"/></svg>`;
    case 'note': return `<svg viewBox="0 0 24 24"><path d="M4 3h14l2 2v16H4z"/><path d="M9 13h6M9 9h6M9 17h3"/></svg>`;
  }
}
document.querySelectorAll('#footer-tray [data-icon]').forEach(el=>{
  el.innerHTML = icon(el.getAttribute('data-icon')) || '';
});

/* ==== Intro -> Steps reveal ==== */
const intro = document.getElementById('intro');
const flow = document.getElementById('flow');
document.getElementById('startBtn').addEventListener('click', ()=>{
  intro.style.display = 'none';
  flow.style.display = 'block';
  goTo(0);
});

/* ==== Carousel core ==== */
const carousel = document.getElementById('carousel');
const slides = Array.from(carousel.children);
const pager = document.getElementById('pager');
let idx = 0;
const maxIdx = slides.length - 1;
let startX = 0, currentX = 0, isDragging = false;

function renderDots(){
  pager.innerHTML = '';
  for(let i=0;i<slides.length;i++){
    const d = document.createElement('div');
    d.className = 'dot' + (i===idx?' active':'');
    d.dataset.i = i;
    d.onclick = ()=>goTo(i);
    pager.appendChild(d);
  }
}
function goTo(i){
  idx = Math.max(0, Math.min(maxIdx, i));
  carousel.style.transform = `translateX(-${idx*100}%)`;
  renderDots();
  updateNav();
  syncCompanyPreview();
  renderEmail();
  const stepEl = slides[idx];
  renderEmailCTA();
  // Auto-scroll when entering the CTA screen
  if(stepEl && stepEl.getAttribute('data-step') === 'cta'){
    setTimeout(()=>scrollMailBodyToCTA(), 250);
  }
}
function updateNav(){
  document.getElementById('backBtn').style.visibility = idx===0 ? 'hidden' : 'visible';
  document.getElementById('nextBtn').textContent = idx===maxIdx ? 'Done' : 'Next';
}
renderDots(); updateNav();

/* Touch swipe between steps */
carousel.addEventListener('touchstart', (e)=>{
  startX = e.touches[0].clientX; currentX = startX; isDragging = true; carousel.style.transition='none';
});
carousel.addEventListener('touchmove', (e)=>{
  if(!isDragging) return;
  currentX = e.touches[0].clientX;
  const dx = currentX - startX;
  const pct = -idx*100 + (dx / carousel.clientWidth) * 100;
  carousel.style.transform = `translateX(${pct}%)`;
});
carousel.addEventListener('touchend', ()=>{
  if(!isDragging) return; isDragging=false; carousel.style.transition='';
  const dx = currentX - startX;
  if(Math.abs(dx)>60){ if(dx<0) goTo(idx+1); else goTo(idx-1); } else { goTo(idx); }
});

/* Nav buttons */
document.getElementById('backBtn').addEventListener('click', ()=>goTo(idx-1));
document.getElementById('nextBtn').addEventListener('click', ()=>{
  if(idx<maxIdx) goTo(idx+1); else goTo(maxIdx);
});

/* ==== Company details -> live into previews ==== */
const acct = {
  name:   document.getElementById('acct_name'),
  phone:  document.getElementById('acct_phone'),
  email:  document.getElementById('acct_email'),
  site:   document.getElementById('acct_site'),
  addr1:  document.getElementById('addr1'),
  addr2:  document.getElementById('addr2'),
  city:   document.getElementById('city'),
  state:  document.getElementById('state'),
  zip:    document.getElementById('zip'),
  country:document.getElementById('country'),
};
Object.values(acct).forEach(el=>el.addEventListener('input', ()=>{
  syncCompanyPreview(); renderEmail(); renderEmailCTA();
}));
function syncCompanyPreview(){
  document.getElementById('prevCompanyName') && (document.getElementById('prevCompanyName').textContent = acct.name.value || '[account_name]');
  document.getElementById('prevCompanySite') && (document.getElementById('prevCompanySite').textContent = acct.site.value || '[account_website]');
}

/* ==== Logo upload ==== */
const logoInput   = document.getElementById('logoInput');
const logoPreviewEmail = document.getElementById('logoEmailPreview');
let logoDataUrl = '';
logoInput && logoInput.addEventListener('change', ()=>{
  const f = logoInput.files?.[0];
  if(!f) return;
  const reader = new FileReader();
  reader.onload = (e)=>{
    logoDataUrl = e.target.result;
    logoPreviewEmail.innerHTML = `<img alt="logo" src="${logoDataUrl}" style="max-width:160px;display:block;margin:0 auto 8px;border-radius:10px">`;
    renderEmail(); renderEmailCTA();
  };
  reader.readAsDataURL(f);
});

/* ==== Personality & AI compose ==== */
const personalities = [
  {key:'bold', label:'Bold & Direct', preview:'I’ll get to the point and focus on outcomes.'},
  {key:'warm', label:'Warm & Approachable', preview:'I’ll sound friendly, helpful, and human.'},
  {key:'analytical', label:'Analytical & Precise', preview:'I’ll be clear, concise, and data-driven.'},
  {key:'playful', label:'Playful & Energetic', preview:'I’ll keep the tone upbeat and engaging.'},
  {key:'luxury', label:'Refined & Premium', preview:'I’ll write with polish and restraint.'},
  {key:'mentor', label:'Mentor & Advisory', preview:'I’ll guide with pragmatism and clarity.'}
];
let chosenPersonality = null;
const chipHost = document.getElementById('personalityChips');
const tonePreview = document.getElementById('tonePreview');
chipHost && personalities.forEach(p=>{
  const el = document.createElement('label');
  el.className = 'chip';
  el.innerHTML = `<span>${p.label}</span><span class="tick"></span>`;
  el.onclick = ()=>{
    chosenPersonality = p.key;
    document.querySelectorAll('#personalityChips .chip').forEach(c=>c.classList.remove('active'));
    el.classList.add('active');
    tonePreview.textContent = p.preview;
    currentVariantIndex = -1;
  };
  chipHost.appendChild(el);
});

const O = {
  overview: document.getElementById('overview'),
  mission:  document.getElementById('mission'),
  values:   document.getElementById('values'),
  diff:     document.getElementById('diffprop'),
};
['overview','mission','values','diffprop'].forEach(id=>{
  const el = document.getElementById(id);
  el && el.addEventListener('input', ()=>{ renderEmail(); renderEmailCTA(); });
});

/* Voice + variants */
function voice(style){
  switch(style){
    case 'bold':
      return {
        overview: `I help busy professionals move faster by transforming follow-ups into real conversations that actually win work.`,
        mission: `My mission is to shorten the path from first contact to “yes” by keeping every step direct, purposeful, and results-driven.`,
        values: `I believe in ownership, speed, clarity, and accountability—because progress only happens when we take action with focus.`,
        diff: `I don’t just track your pipeline—I give you a clear feed that shows exactly what to do next, removing all guesswork and hesitation.`
      };
    case 'warm':
      return {
        overview: `I support small teams with simple, human tools that make every relationship feel close and cared for, even as you grow.`,
        mission: `I want every client and partner to feel seen, supported, and remembered—never just another name on a list.`,
        values: `I value empathy, reliability, transparency, and care. These principles shape how I build and maintain lasting connections.`,
        diff: `I design automations that sound like you and speak from the heart—so your messages feel real, not robotic.`
      };
    case 'analytical':
      return {
        overview: `I streamline your entire pipeline with data-backed workflows that reduce cycle time, remove friction, and raise conversion.`,
        mission: `My mission is to operationalize your best practices through measurable systems that constantly improve through iteration.`,
        values: `I believe in rigor, precision, iteration, and results—because consistent improvement starts with clear measurement.`,
        diff: `I focus on actionable insights, milestone tracking, and metrics you can quantify, so progress is always visible and provable.`
      };
    case 'playful':
      return {
        overview: `I turn follow-ups into quick, feel-good wins with swipe-friendly tasks that keep your energy high and your conversations moving.`,
        mission: `I make staying in touch feel easy, light, and even fun—because progress doesn’t have to feel like work.`,
        values: `I bring energy, curiosity, creativity, and momentum to everything I do.`,
        diff: `I create small, clever nudges that inspire action and spark replies without pressure or pushiness.`
      };
    case 'luxury':
      return {
        overview: `I design refined client journeys that feel elegant, seamless, and deeply personal from the very first interaction.`,
        mission: `My mission is to elevate every touchpoint with clarity, care, and quiet confidence—creating experiences that build lasting trust.`,
        values: `I uphold excellence, discretion, trust, and consistency in every detail.`,
        diff: `I craft white-glove automations tailored for premium brands that want to deliver a high-touch experience at every stage.`
      };
    case 'mentor':
    default:
      return {
        overview: `I help teams build repeatable, healthy relationship habits that strengthen trust and grow long-term revenue.`,
        mission: `I guide leaders to stay consistent and thoughtful, blending structure with the personal touch that relationships deserve.`,
        values: `I believe in integrity, service, stewardship, and continuous learning as the foundation for sustainable growth.`,
        diff: `I provide an advisory-led setup with adaptable templates that evolve as your business and team grow.`
      };
  }
}
function variants(style){
  const b = voice(style);
  return [
    b,
    {
      overview: b.overview + ' I remove busywork so you can focus on conversations that matter.',
      mission:  b.mission + ' Every touch has a clear purpose and outcome.',
      values:   b.values,
      diff:     b.diff + ' You’ll always know the highest-leverage action to take.'
    },
    {
      overview: 'Here’s the simple truth: ' + b.overview,
      mission:  'In short: ' + b.mission,
      values:   'Core values: ' + b.values,
      diff:     'Practically speaking, ' + b.diff
    }
  ];
}

/* Fake AI loader + variant cycling */
const aiStatus = document.getElementById('aiStatus');
const aiStatusText = document.getElementById('aiStatusText');
const btnGenerate = document.getElementById('btnGenerate');
const btnRegenerate = document.getElementById('btnRegenerate');
let currentVariantIndex = -1;
function setFields(v){ O.overview.value=v.overview; O.mission.value=v.mission; O.values.value=v.values; O.diff.value=v.diff; renderEmail(); renderEmailCTA(); }
function startLoading(text){ aiStatusText.textContent=text||'Generating your copy…'; aiStatus.classList.add('show'); btnGenerate.disabled=btnRegenerate.disabled=true; }
function stopLoading(){ aiStatus.classList.remove('show'); btnGenerate.disabled=btnRegenerate.disabled=false; }
function doGenerate(useNext=false){
  const style = chosenPersonality || 'mentor';
  const v = variants(style);
  let next = useNext ? (currentVariantIndex+1)%v.length : 0;
  startLoading(useNext?'Regenerating alternate version…':'Generating your copy…');
  setTimeout(()=>{ setFields(v[next]); currentVariantIndex=next; stopLoading(); }, 700);
}
btnGenerate && btnGenerate.addEventListener('click', ()=>doGenerate(false));
btnRegenerate && btnRegenerate.addEventListener('click', ()=>doGenerate(true));

/* ==== Build base email body (shared) ==== */
function getHeaderLogo(){
  return (window.logoDataUrl && window.logoDataUrl.length)
    ? window.logoDataUrl
    : 'https://d34hmiuaex7c0.cloudfront.net/2952/uploads/cmaspages/gallery/galleryitem_1696179347579.png';
}
function getEmailIntroHtml(){
  const logoHtml = `<p class="mail-logo-wrap"><img class="mail-logo" alt="Segwik logo" src="${getHeaderLogo()}"></p>`;
  return `
    ${logoHtml}
    <h3>It’s Great to Be Connected!</h3>
    <p>Hello Katrina, Thanks for downloading my digital business card — I’m excited we crossed paths. Let me introduce myself a bit more:</p>

    <p><strong>About My Business</strong><br/>Segwik is a human-centered Relationship Operating System (ROS) built for entrepreneurs, solopreneurs, and small teams who want to grow real relationships without the chaos of traditional CRMs. It brings contacts, communication, and workflows together in one intuitive platform with tools for automation, multi-channel communication, and AI-powered insights. Segwik replaces tech clutter with clarity and helps business owners, sales agents, and leaders stay connected and consistent.</p>

    <p><strong>What Drives Us</strong><br/>Segwik exists to help small businesses and individuals build meaningful relationships at scale—without the bloat or burnout of complex software. We make it easy for entrepreneurs and teams to show up, follow up, and grow in ways that feel simple, human, and sustainable.</p>

    <p><strong>What Makes Us Different</strong><br/>Segwik isn’t just another CRM—it’s a Relationship OS focused on real connection and authentic automation. Its flexible token-based system gives users access to AI, communication tools, and support without rigid pricing. By combining email, text, calendar, forms, and workflows in one place, Segwik keeps business simple and scalable for real people, from solopreneurs to growing teams.</p>

    <p><strong>Our Core Values</strong><br/>Segwik values human connection, simplicity, and transparency. We’re built for the underdog, listen first, and grow through action, not perfection. Our automations are made with heart, our tools are scalable by design, and our community grows stronger together through purpose, integrity, and trust.</p>
  `.trim();
}
function getSignatureHtml(){
  return `
    <div class="sig">
      <div class="headshot" aria-hidden="true">Headshot</div>
      <div class="meta">
        <div style="font-weight:700; margin-bottom:2px;">Pete Romano</div>
        <div><a href="https://www.segwik.com" target="_blank" rel="noopener">Segwik</a></div>
        <div>pete@segwik.com</div>
        <div>914-715-2058</div>
      </div>
    </div>
  `.trim();
}

/* ==== Render the autoresponder preview (Step 5) ==== */
function renderEmail(){
  const bodyEl = document.getElementById('mailBody');
  if(!bodyEl) return;
  bodyEl.innerHTML = `${getEmailIntroHtml()}${getSignatureHtml()}`;
  // From line
  const fromName = document.getElementById('fromName');
  const fromDetails = document.getElementById('fromDetails');
  if(fromName) fromName.textContent = 'Pete Romano';
  if(fromDetails) fromDetails.textContent = 'pete@segwik.com • to katrina@segwik.com';

  // mirror to full overlay if open
  const mailFrame = document.getElementById('mailFrame');
  const mailFrameFull = document.getElementById('mailFrameFull');
  if(mailFrame && mailFrameFull && document.getElementById('fullPreview').classList.contains('show')){
    mailFrameFull.innerHTML = mailFrame.innerHTML;
  }
}

/* ==== Step 6: CTA editor/apply state ==== */
let ctaIndex = 0;            // which slide is shown (0..2)
let ctaEditingType = null;   // 'book' | 'free' | 'email'
let ctaApplied = null;       // { type, label, href, title, desc }

function ctaSlidesHtml(){
  return `
    <div class="cta-slide">
      <div class="cta-card">
        <h4 data-ctatitle>Let’s Book a Quick Intro</h4>
        <p data-ctadesc>Let’s schedule a quick 15-minute intro directly on my calendar. Just pick a time that works best for you — no back-and-forth needed.</p>
        <div class="cta-action-row">
          <button class="btn blue" data-ctatype="book">Book a Time</button>
          <button class="icon-btn" data-edit="book" title="Edit CTA">
            <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
          </button>
        </div>
      </div>
    </div>
    <div class="cta-slide">
      <div class="cta-card">
        <h4 data-ctatitle>Grab Your Free Resource</h4>
        <p data-ctadesc>Here’s something that might help you get started — no strings attached. Feel free to download it, explore, and reach out anytime if you’d like to chat further.</p>
        <div class="cta-action-row">
          <button class="btn blue" data-ctatype="free">Get the Free Resource</button>
          <button class="icon-btn" data-edit="free" title="Edit CTA">
            <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
          </button>
        </div>
      </div>
    </div>
    <div class="cta-slide">
      <div class="cta-card">
        <h4 data-ctatitle>Let’s Schedule a Quick Intro</h4>
        <p data-ctadesc>Let’s set up a quick 15-minute intro. Feel free to share your availability (or request mine), and we’ll get it scheduled. In the meantime, if you ever need help, advice, or a trusted referral, I’d be glad to be a resource.</p>
        <div class="cta-action-row">
          <button class="btn blue" data-ctatype="email">Share or Request Availability</button>
          <button class="icon-btn" data-edit="email" title="Edit CTA">
            <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
          </button>
        </div>
      </div>
    </div>
  `;
}
function ctaArrowsHtml(){
  return `
    <div class="cta-arrows">
      <button class="icon-btn" id="ctaPrev" title="Previous option">
        <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
      </button>
      <div class="mini" id="ctaIndexNote">Option ${ctaIndex+1} of 3</div>
      <button class="icon-btn" id="ctaNext" title="Next option">
        <svg viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>
      </button>
    </div>
  `;
}
function ctaInsertHtml(){
  return `
    <div class="cta-insert" id="ctaInsert">
      <div class="cta-head">Add a Call-to-Action</div>
      <div class="cta-carousel" id="ctaCarousel">
        <div class="cta-track" id="ctaTrack">${ctaSlidesHtml()}</div>
      </div>
      ${ctaArrowsHtml()}
    </div>
  `;
}
function ctaSavedHtml(a){
  const button = `<a class="btn blue" href="${a.href}" target="${a.type==='email' ? '_self' : '_blank'}" rel="noopener">${a.label}</a>`;
  return `
    <div class="cta-saved" id="ctaSaved">
      <div class="meta">
        <h4>${a.title}</h4>
        <p>${a.desc}</p>
        ${button}
      </div>
      <div class="edit-right">
        <button class="icon-btn" id="editApplied" title="Edit CTA">
          <svg viewBox="0 0 24 24"><path d="M12 20h9"/><path d="M16.5 3.5a2.12 2.12 0 1 1 3 3L7 19l-4 1 1-4Z"/></svg>
        </button>
      </div>
    </div>
  `;
}

/* Render email body + CTA block for Step 6 */
function renderEmailCTA(){
  const host = document.getElementById('mailBodyCTA');
  if(!host) return;

  const intro = getEmailIntroHtml();
  const sig   = getSignatureHtml();

  if(ctaApplied){
    host.innerHTML = `${intro}${ctaSavedHtml(ctaApplied)}${sig}`;
    // pencil on saved CTA -> revert to dashed insert
    const editApplied = document.getElementById('editApplied');
    editApplied && editApplied.addEventListener('click', ()=>{
      ctaApplied = null;
      renderEmailCTA();
      setTimeout(()=>scrollMailBodyToCTA(true),50);
    });
    return;
  }

  host.innerHTML = `${intro}${ctaInsertHtml()}${sig}`;

  // Bind CTA buttons (either main button OR pencil both open editor)
  host.querySelectorAll('[data-ctatype]').forEach(btn=>{
    btn.addEventListener('click', ()=>openCtaModal(btn.getAttribute('data-ctatype')));
  });
  host.querySelectorAll('[data-edit]').forEach(btn=>{
    btn.addEventListener('click', ()=>openCtaModal(btn.getAttribute('data-edit')));
  });

  // Swipe handling + arrows for slides
  const track = document.getElementById('ctaTrack');
  const idxNote = document.getElementById('ctaIndexNote');
  let sx = 0, cx = 0, dragging = false;

  function updateTrack(){
    track.style.transform = `translateX(-${ctaIndex*100}%)`;
    if(idxNote) idxNote.textContent = `Option ${ctaIndex+1} of 3`;
  }

  track.addEventListener('touchstart',(e)=>{ dragging=true; sx=e.touches[0].clientX; cx=sx; });
  track.addEventListener('touchmove',(e)=>{
    if(!dragging) return; cx=e.touches[0].clientX;
    const dx = cx - sx;
    const pct = -ctaIndex*100 + (dx / track.clientWidth) * 100;
    track.style.transition='none';
    track.style.transform = `translateX(${pct}%)`;
  });
  track.addEventListener('touchend',()=>{
    if(!dragging) return; dragging=false; track.style.transition='';
    const dx = cx - sx;
    if(Math.abs(dx) > 40){ if(dx<0) ctaIndex = Math.min(2, ctaIndex+1); else ctaIndex = Math.max(0, ctaIndex-1); }
    updateTrack();
  });

  document.getElementById('ctaPrev').addEventListener('click', ()=>{ ctaIndex = Math.max(0, ctaIndex-1); updateTrack(); });
  document.getElementById('ctaNext').addEventListener('click', ()=>{ ctaIndex = Math.min(2, ctaIndex+1); updateTrack(); });

  updateTrack();
}

/* Smoothly scroll the email preview to CTA and flash it */
function scrollMailBodyToCTA(forceFlash=false){
  const body = document.getElementById('mailBodyCTA');
  if(!body) return;
  const target = body.querySelector('#ctaInsert, #ctaSaved');
  if(!target) return;
  body.scrollTo({ top: target.offsetTop - 8, behavior: 'smooth' });
  if(forceFlash){
    target.classList.add('flash');
    setTimeout(()=>target.classList.remove('flash'), 1200);
  }else{
    // small delayed flash to draw attention
    setTimeout(()=>{ target.classList.add('flash'); setTimeout(()=>target.classList.remove('flash'), 1100); }, 320);
  }
}

/* ==== CTA Modal logic ==== */
const ctaModalWrap = document.getElementById('ctaModalWrap');
const ctaCfgTitle = document.getElementById('ctaCfgTitle');
const ctaCfgNote  = document.getElementById('ctaCfgNote');
const ctaCfgLabel = document.getElementById('ctaCfgLabel');
const ctaCfgDestWrap = document.getElementById('ctaCfgDestWrap');
const ctaCfgDestLabel = document.getElementById('ctaCfgDestLabel');
const ctaCfgDest = document.getElementById('ctaCfgDest');
const ctaCfgMini = document.getElementById('ctaCfgMini');

function toggleCtaModal(show){ ctaModalWrap.classList.toggle('show', !!show); }
document.getElementById('ctaModalClose').addEventListener('click', ()=>toggleCtaModal(false));

function openCtaModal(type){
  ctaEditingType = type;
  ctaCfgMini.style.display = 'none';
  if(type === 'book'){
    ctaCfgTitle.textContent = 'Book a time';
    ctaCfgLabel.value = 'Book a Time';
    ctaCfgDestLabel.textContent = 'Destination';
    ctaCfgDest.type = 'url';
    ctaCfgDest.placeholder = 'https://your-booking-link.com';
    ctaCfgDest.value = '';
    ctaCfgNote.textContent = 'Set your calendar link and label.';
  }else if(type === 'free'){
    ctaCfgTitle.textContent = 'Get the free resource';
    ctaCfgLabel.value = 'Get the Free Resource';
    ctaCfgDestLabel.textContent = 'Destination';
    ctaCfgDest.type = 'url';
    ctaCfgDest.placeholder = 'https://your-asset-link.com/guide.pdf';
    ctaCfgDest.value = '';
    ctaCfgNote.textContent = 'Set your download URL and label.';
  }else{
    ctaCfgTitle.textContent = "Let's schedule a quick intro";
    ctaCfgLabel.value = 'Share or Request Availability';
    ctaCfgDestLabel.textContent = 'Email to (mailto)';
    ctaCfgDest.type = 'email';
    ctaCfgDest.placeholder = 'you@company.com';
    ctaCfgDest.value = '';
    ctaCfgMini.textContent = 'This will use a mailto: link. Enter the recipient email.';
    ctaCfgMini.style.display = 'block';
    ctaCfgNote.textContent = 'Set your button label and recipient email.';
  }
  toggleCtaModal(true);
}

/* Save CTA -> apply into email and remove dashed box. Keep pencil to edit */
document.getElementById('ctaCfgSave').addEventListener('click', ()=>{
  const label = (ctaCfgLabel.value || '').trim() || 'Learn More';
  let href = '#';
  if(ctaEditingType === 'book' || ctaEditingType === 'free'){
    href = (ctaCfgDest.value || '').trim() || '#';
  }else{
    const to = (ctaCfgDest.value || '').trim() || 'you@company.com';
    href = `mailto:${encodeURIComponent(to)}?subject=${encodeURIComponent('Let’s connect')}`;
  }

  // Pull the currently visible slide's title/desc to apply matching content
  const body = document.getElementById('mailBodyCTA');
  const slides = body.querySelectorAll('.cta-slide');
  const activeSlide = slides[ctaIndex];
  const title = activeSlide.querySelector('[data-ctatitle]').textContent.trim();
  const desc  = activeSlide.querySelector('[data-ctadesc]').textContent.trim();

  ctaApplied = {
    type: ctaEditingType || 'book',
    label, href, title, desc
  };
  toggleCtaModal(false);
  renderEmailCTA();
  setTimeout(()=>scrollMailBodyToCTA(true), 80);
});

/* Full-screen Preview controls */
const btnFull = document.getElementById('btnFullPreview');
const overlay = document.getElementById('fullPreview');
const closeFull = document.getElementById('closeFullPreview');
btnFull && btnFull.addEventListener('click', ()=>{
  const mailFrame = document.getElementById('mailFrame');
  const mailFrameFull = document.getElementById('mailFrameFull');
  mailFrameFull.innerHTML = mailFrame.innerHTML;
  overlay.classList.add('show');
  overlay.setAttribute('aria-hidden','false');
});
closeFull && closeFull.addEventListener('click', ()=>{
  overlay.classList.remove('show');
  overlay.setAttribute('aria-hidden','true');
});

/* Send Me a Preview (mock) */
const sendBtn = document.getElementById('btnSendPreview');
sendBtn && sendBtn.addEventListener('click', ()=>alert('A preview has been sent to your email. (Mock)'));

/* Bottom sheet helpers (kept) */
const sheet = document.getElementById('upgradeSheet');
function toggleSheet(show){ sheet.classList.toggle('show', !!show); }
document.getElementById('notNow')?.addEventListener('click', ()=>{ toggleSheet(false); goTo(idx+1); });
document.getElementById('upgradeNow')?.addEventListener('click', ()=>{ toggleSheet(false); alert('Upgrade flow (mock)'); });

const editSheet = document.getElementById('editSheet');
function toggleEditSheet(show){ editSheet.classList.toggle('show', !!show); }
document.getElementById('btnEditTemplate')?.addEventListener('click', ()=>toggleEditSheet(true));
document.getElementById('editNotNow')?.addEventListener('click', ()=>toggleEditSheet(false));
document.getElementById('editUpgradeNow')?.addEventListener('click', ()=>{ toggleEditSheet(false); alert('Upgrade flow (mock)'); });

const followupSheet = document.getElementById('followupSheet');
function toggleFollowupSheet(show){ followupSheet.classList.toggle('show', !!show); }
document.getElementById('btnAddFollowUp')?.addEventListener('click', ()=>toggleFollowupSheet(true));
document.getElementById('followupNotNow')?.addEventListener('click', ()=>toggleFollowupSheet(false));
document.getElementById('followupUpgradeNow')?.addEventListener('click', ()=>{ toggleFollowupSheet(false); alert('Upgrade flow (mock)'); });

/* Final screen */
const activateSwitch = document.getElementById('activateSwitch');
activateSwitch && activateSwitch.addEventListener('click', ()=>activateSwitch.classList.toggle('active'));
document.getElementById('seeUpgrade')?.addEventListener('click', ()=>alert('Upgrade options (mock)'));
document.getElementById('finishBtn')?.addEventListener('click', ()=>{
  const active = activateSwitch?.classList.contains('active');
  alert(`Saved! (Mock)\nJourney ${active ? 'activated' : 'saved as draft'}.`);
});

/* Keep company preview live (no-op placeholders kept) */
['input','change'].forEach(ev=>{
  document.getElementById('acct_name')?.addEventListener(ev, syncCompanyPreview);
  document.getElementById('acct_site')?.addEventListener(ev, syncCompanyPreview);
});

/* Accessibility: keyboard navigation between steps */
window.addEventListener('keydown', (e)=>{
  if(e.key==='ArrowLeft') goTo(idx-1);
  if(e.key==='ArrowRight') goTo(idx+1);
});

/* ===== Initial renders ===== */
renderEmail();
renderEmailCTA();
</script>
</body>
</html>
